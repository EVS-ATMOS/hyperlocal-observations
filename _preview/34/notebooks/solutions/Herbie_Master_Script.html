
<!DOCTYPE html>


<html lang="en" data-content_root="../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>&lt;no title&gt; &#8212; Summer 2024 DOE SULI Project - Hyperlocal Precipitation Observations</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-design.min.css?v=87e54e7c" />
    <link rel="stylesheet" type="text/css" href="../../_static/custom.css?v=d0efeab3" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'notebooks/solutions/Herbie_Master_Script';</script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
    <meta name="docbuild:last-update" content="21 July 2024"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
        
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
     
  

<a class="navbar-brand logo" href="https://www.anl.gov/">
  
  
  
  
  
    
    
      
    
    
    <img src="../../_static/ANL_RGB-01.png" class="logo__image only-light" alt="Summer 2024 DOE SULI Project - Hyperlocal Precipitation Observations - Home"/>
    <script>document.write(`<img src="../../_static/ANL_RGB-01.png" class="logo__image only-dark" alt="Summer 2024 DOE SULI Project - Hyperlocal Precipitation Observations - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/EVS-ATMOS/hyperlocal-observations" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-square-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
</ul></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../README.html">
                    Hyperlocal Precipitation Observations Cookbook
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Logistics + Information</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../schedule.html">Schedule</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Exploration</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../Exploration/Herbie_HRRR_Custom.html">Overview</a></li>








</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Assignments</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../assignments/pyart-blog.html">Assignment 1 : Py-ART Blog Post</a></li>
<li class="toctree-l1"><a class="reference internal" href="../assignments/insitu-comparison.html">Assignment 2 : Radar / In-Situ Observation Comparison</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Solutions</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="PPI_Notebook.html">NEXRAD Level 2 Radar Data Animated GIFs</a></li>







<li class="toctree-l1"><a class="reference internal" href="FeatDetection.html">Radar Reflectivity Feature Detection and Classification</a></li>





<li class="toctree-l1"><a class="reference internal" href="VertCol.html">Vertical Reflectivity Columns</a></li>





</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Final Project</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../project/hyperlocal-final-project.html">Final Project - Hyperlocal Preciptiation Analysis</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/EVS-ATMOS/hyperlocal-observations" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/EVS-ATMOS/hyperlocal-observations/edit/main/notebooks/solutions/Herbie_Master_Script.ipynb" target="_blank"
   class="btn btn-sm btn-source-edit-button dropdown-item"
   title="Suggest edit"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="btn__text-container">Suggest edit</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/EVS-ATMOS/hyperlocal-observations/issues/new?title=Issue%20on%20page%20%2Fnotebooks/solutions/Herbie_Master_Script.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../_sources/notebooks/solutions/Herbie_Master_Script.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1><no title></h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="simple visible nav section-nav flex-column">
</ul>

            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">cartopy.crs</span> <span class="k">as</span> <span class="nn">ccrs</span>
<span class="kn">import</span> <span class="nn">cartopy.feature</span> <span class="k">as</span> <span class="nn">cfeature</span>
<span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span>
<span class="kn">import</span> <span class="nn">xarray</span> <span class="k">as</span> <span class="nn">xr</span>
<span class="kn">from</span> <span class="nn">herbie</span> <span class="kn">import</span> <span class="n">Herbie</span>
<span class="kn">from</span> <span class="nn">matplotlib.ticker</span> <span class="kn">import</span> <span class="n">MaxNLocator</span>
<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">display</span><span class="p">,</span> <span class="n">Image</span> <span class="k">as</span> <span class="n">IPImage</span>
<span class="kn">from</span> <span class="nn">metpy.plots</span> <span class="kn">import</span> <span class="n">USCOUNTIES</span>
<span class="kn">from</span> <span class="nn">matplotlib.colors</span> <span class="kn">import</span> <span class="n">LinearSegmentedColormap</span><span class="p">,</span> <span class="n">TwoSlopeNorm</span>
<span class="kn">from</span> <span class="nn">scipy.ndimage</span> <span class="kn">import</span> <span class="n">gaussian_filter</span>
<span class="kn">from</span> <span class="nn">metpy.calc</span> <span class="kn">import</span> <span class="n">equivalent_potential_temperature</span><span class="p">,</span> <span class="n">lcl</span><span class="p">,</span> <span class="n">significant_tornado</span><span class="p">,</span> <span class="n">wind_components</span>
<span class="kn">from</span> <span class="nn">metpy.units</span> <span class="kn">import</span> <span class="n">units</span>

<span class="n">MS_TO_KNOTS</span> <span class="o">=</span> <span class="mf">1.94384</span>

<span class="n">regions</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;north_central&quot;</span><span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="mf">105.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">90.0</span><span class="p">,</span> <span class="mf">40.0</span><span class="p">,</span> <span class="mf">49.0</span><span class="p">),</span>
    <span class="s2">&quot;central&quot;</span><span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="mf">100.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">85.0</span><span class="p">,</span> <span class="mf">35.0</span><span class="p">,</span> <span class="mf">45.0</span><span class="p">),</span>
    <span class="s2">&quot;south_central&quot;</span><span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="mf">100.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">85.0</span><span class="p">,</span> <span class="mf">30.0</span><span class="p">,</span> <span class="mf">40.0</span><span class="p">),</span>
    <span class="s2">&quot;midwestern&quot;</span><span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="mf">95.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">80.0</span><span class="p">,</span> <span class="mf">35.0</span><span class="p">,</span> <span class="mf">45.0</span><span class="p">),</span>
    <span class="s2">&quot;ohio_valley&quot;</span><span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="mf">90.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">75.0</span><span class="p">,</span> <span class="mf">35.0</span><span class="p">,</span> <span class="mf">45.0</span><span class="p">),</span>
    <span class="s2">&quot;mid_atlantic&quot;</span><span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="mf">85.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">70.0</span><span class="p">,</span> <span class="mf">35.0</span><span class="p">,</span> <span class="mf">45.0</span><span class="p">),</span>
    <span class="s2">&quot;northeastern&quot;</span><span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="mf">80.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">65.0</span><span class="p">,</span> <span class="mf">40.0</span><span class="p">,</span> <span class="mf">50.0</span><span class="p">),</span>
    <span class="s2">&quot;southeastern&quot;</span><span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="mf">90.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">75.0</span><span class="p">,</span> <span class="mf">25.0</span><span class="p">,</span> <span class="mf">35.0</span><span class="p">),</span>
    <span class="s2">&quot;northwestern&quot;</span><span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="mf">125.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">110.0</span><span class="p">,</span> <span class="mf">40.0</span><span class="p">,</span> <span class="mf">50.0</span><span class="p">),</span>
    <span class="s2">&quot;southwestern&quot;</span><span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="mf">125.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">110.0</span><span class="p">,</span> <span class="mf">30.0</span><span class="p">,</span> <span class="mf">40.0</span><span class="p">),</span>
    <span class="s2">&quot;rocky_mountain&quot;</span><span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="mf">115.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">100.0</span><span class="p">,</span> <span class="mf">35.0</span><span class="p">,</span> <span class="mf">45.0</span><span class="p">),</span>
    <span class="s2">&quot;upper_great_lakes&quot;</span><span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="mf">95.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">80.0</span><span class="p">,</span> <span class="mf">40.0</span><span class="p">,</span> <span class="mf">50.0</span><span class="p">),</span>
    <span class="s2">&quot;plains&quot;</span><span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="mf">105.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">90.0</span><span class="p">,</span> <span class="mf">35.0</span><span class="p">,</span> <span class="mf">45.0</span><span class="p">),</span>
    <span class="s2">&quot;conus&quot;</span><span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="mi">125</span><span class="p">,</span> <span class="o">-</span><span class="mi">67</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>
<span class="p">}</span>

<span class="k">def</span> <span class="nf">get_pressure_level</span><span class="p">(</span><span class="n">keyword</span><span class="p">):</span>
    <span class="n">keyword_mapping</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;ML&quot;</span><span class="p">:</span> <span class="s2">&quot;255-0 mb above ground&quot;</span><span class="p">,</span>
        <span class="s2">&quot;MU&quot;</span><span class="p">:</span> <span class="s2">&quot;180-0 mb above ground&quot;</span><span class="p">,</span>
        <span class="s2">&quot;SB&quot;</span><span class="p">:</span> <span class="s2">&quot;90-0 mb above ground&quot;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">keyword_mapping</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">keyword</span><span class="p">,</span> <span class="s2">&quot;180-0 mb above ground&quot;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">get_variable_name</span><span class="p">(</span><span class="n">keyword</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">variable_mapping</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;MLCAPE&quot;</span><span class="p">:</span> <span class="s2">&quot;CAPE&quot;</span><span class="p">,</span>
        <span class="s2">&quot;MUCAPE&quot;</span><span class="p">:</span> <span class="s2">&quot;CAPE&quot;</span><span class="p">,</span>
        <span class="s2">&quot;SBCAPE&quot;</span><span class="p">:</span> <span class="s2">&quot;CAPE&quot;</span><span class="p">,</span>
        <span class="s2">&quot;hlcy_ml&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;:3000-0 m above ground&quot;</span><span class="p">,</span> <span class="s2">&quot;CAPE:255-0 mb above ground&quot;</span><span class="p">),</span>
        <span class="s2">&quot;hlcy_mu&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;:3000-0 m above ground&quot;</span><span class="p">,</span> <span class="s2">&quot;CAPE:180-0 mb above ground&quot;</span><span class="p">),</span>
        <span class="s2">&quot;hlcy_sb&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;:3000-0 m above ground&quot;</span><span class="p">,</span> <span class="s2">&quot;CAPE:90-0 mb above ground&quot;</span><span class="p">),</span>
        <span class="s2">&quot;UVV&quot;</span><span class="p">:</span> <span class="p">(</span><span class="sa">f</span><span class="s2">&quot;:</span><span class="si">{</span><span class="n">level</span><span class="si">}</span><span class="s2"> mb&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;:</span><span class="si">{</span><span class="n">level</span><span class="si">}</span><span class="s2"> mb&quot;</span><span class="p">),</span>
        <span class="s2">&quot;ABSV&quot;</span><span class="p">:</span> <span class="p">(</span><span class="sa">f</span><span class="s2">&quot;:</span><span class="si">{</span><span class="n">level</span><span class="si">}</span><span class="s2"> mb&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;:</span><span class="si">{</span><span class="n">level</span><span class="si">}</span><span class="s2"> mb&quot;</span><span class="p">),</span>
        <span class="s2">&quot;QPF&quot;</span><span class="p">:</span> <span class="s2">&quot;APCP:surface&quot;</span><span class="p">,</span>
        <span class="s2">&quot;uphl&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;MXUPHL:5000-2000 m above ground&quot;</span><span class="p">,</span> <span class="s2">&quot;REFC:entire atmosphere&quot;</span><span class="p">),</span>
        <span class="s2">&quot;sfc&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;2 m above ground&quot;</span><span class="p">,</span> <span class="s2">&quot;2 m above ground&quot;</span><span class="p">,</span> <span class="s2">&quot;10 m above ground&quot;</span><span class="p">,</span> <span class="s2">&quot;10 m above ground&quot;</span><span class="p">),</span>
        <span class="s2">&quot;TE&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;2 m above ground&quot;</span><span class="p">,</span> <span class="s2">&quot;2 m above ground&quot;</span><span class="p">,</span> <span class="s2">&quot;10 m above ground&quot;</span><span class="p">,</span> <span class="s2">&quot;10 m above ground&quot;</span><span class="p">,</span> <span class="s2">&quot;:mean sea level&quot;</span><span class="p">),</span>
        <span class="s2">&quot;gh&quot;</span><span class="p">:</span> <span class="p">(</span><span class="sa">f</span><span class="s2">&quot;:</span><span class="si">{</span><span class="n">level</span><span class="si">}</span><span class="s2"> mb&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;:</span><span class="si">{</span><span class="n">level</span><span class="si">}</span><span class="s2"> mb&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;:</span><span class="si">{</span><span class="n">level</span><span class="si">}</span><span class="s2"> mb&quot;</span><span class="p">),</span>
        <span class="s2">&quot;helcy3&quot;</span><span class="p">:</span> <span class="s2">&quot;:3000-0 m above ground&quot;</span><span class="p">,</span>
        <span class="s2">&quot;LI&quot;</span><span class="p">:</span> <span class="s2">&quot;:500-1000 mb&quot;</span><span class="p">,</span>
        <span class="s2">&quot;LCL&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;:2 m above ground&quot;</span><span class="p">,</span> <span class="s2">&quot;:2 m above ground&quot;</span><span class="p">,</span> <span class="s2">&quot;:surface&quot;</span><span class="p">),</span>
        <span class="s2">&quot;STP&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;:2 m above ground&quot;</span><span class="p">,</span> <span class="s2">&quot;:2 m above ground&quot;</span><span class="p">,</span> <span class="s2">&quot;:surface&quot;</span><span class="p">,</span> <span class="s2">&quot;:1000-0 m above ground&quot;</span><span class="p">,</span><span class="s2">&quot;:90-0 mb above ground&quot;</span><span class="p">,</span> <span class="s2">&quot;:0-6000 m above ground&quot;</span><span class="p">,</span> <span class="s2">&quot;:0-6000 m above ground&quot;</span><span class="p">),</span>
        <span class="s2">&quot;PBL&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;:surface&quot;</span><span class="p">),</span>
        <span class="s2">&quot;THESHR&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;2 m above ground&quot;</span><span class="p">,</span> <span class="s2">&quot;2 m above ground&quot;</span><span class="p">,</span> <span class="s2">&quot;:mean sea level&quot;</span><span class="p">,</span><span class="s2">&quot;:0-6000 m above ground&quot;</span><span class="p">,</span> <span class="s2">&quot;:0-6000 m above ground&quot;</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">variable_mapping</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">keyword</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">downsample_data</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">step</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">data</span><span class="p">[::</span><span class="n">step</span><span class="p">,</span> <span class="p">::</span><span class="n">step</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">download_files</span><span class="p">(</span><span class="n">date</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">max_fxx</span><span class="p">,</span> <span class="n">extent</span><span class="p">,</span> <span class="n">keyword</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">base_dir</span> <span class="o">=</span> <span class="s2">&quot;downloaded_files&quot;</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">base_dir</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">file_paths</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;cape&#39;</span><span class="p">:</span> <span class="p">[],</span> <span class="s1">&#39;cin&#39;</span><span class="p">:</span> <span class="p">[],</span> <span class="s1">&#39;hlcy&#39;</span><span class="p">:</span> <span class="p">[],</span> <span class="s1">&#39;gh&#39;</span><span class="p">:</span> <span class="p">[],</span> <span class="s1">&#39;uvv&#39;</span><span class="p">:</span> <span class="p">[],</span> <span class="s1">&#39;absv&#39;</span><span class="p">:</span> <span class="p">[],</span> 
        <span class="s1">&#39;precip&#39;</span><span class="p">:</span> <span class="p">[],</span> <span class="s1">&#39;uphl&#39;</span><span class="p">:</span> <span class="p">[],</span> <span class="s1">&#39;refc&#39;</span><span class="p">:</span> <span class="p">[],</span> <span class="s1">&#39;temp&#39;</span><span class="p">:</span> <span class="p">[],</span> <span class="s1">&#39;dpt&#39;</span><span class="p">:</span> <span class="p">[],</span> <span class="s1">&#39;pres&#39;</span><span class="p">:</span> <span class="p">[],</span> 
        <span class="s1">&#39;winds&#39;</span><span class="p">:</span> <span class="p">[],</span> <span class="s1">&#39;winds2&#39;</span><span class="p">:</span> <span class="p">[],</span> <span class="s1">&#39;helcy&#39;</span><span class="p">:[],</span> <span class="s1">&#39;lift&#39;</span><span class="p">:[],</span> <span class="s1">&#39;vvcsh&#39;</span><span class="p">:[],</span> <span class="s1">&#39;vucsh&#39;</span><span class="p">:[],</span> <span class="s1">&#39;pbl&#39;</span><span class="p">:[]</span>
    <span class="p">}</span>
    
    <span class="n">variables</span> <span class="o">=</span> <span class="n">get_variable_name</span><span class="p">(</span><span class="n">keyword</span><span class="p">,</span> <span class="n">level</span><span class="p">)</span>
    <span class="n">cape_var</span><span class="p">,</span> <span class="n">cin_var</span><span class="p">,</span> <span class="n">helcy_var</span><span class="p">,</span> <span class="n">hlcy_var</span><span class="p">,</span> <span class="n">gh_var</span><span class="p">,</span> <span class="n">uvv_var</span><span class="p">,</span> <span class="n">absv_var</span><span class="p">,</span> <span class="n">precip_var</span><span class="p">,</span> <span class="n">uphl_var</span><span class="p">,</span> <span class="n">refc_var</span><span class="p">,</span> <span class="n">lif_var</span><span class="p">,</span> <span class="n">pbl_var</span><span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
    <span class="n">temp_var</span><span class="p">,</span> <span class="n">dpt_var</span><span class="p">,</span> <span class="n">pres_var</span><span class="p">,</span> <span class="n">winds_var</span><span class="p">,</span> <span class="n">winds2_var</span><span class="p">,</span> <span class="n">vvcsh_var</span><span class="p">,</span> <span class="n">vucsh_var</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">variables</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
        <span class="k">if</span> <span class="s2">&quot;hlcy&quot;</span> <span class="ow">in</span> <span class="n">keyword</span><span class="p">:</span>
            <span class="n">hlcy_var</span><span class="p">,</span> <span class="n">cape_var</span> <span class="o">=</span> <span class="n">variables</span>
            <span class="n">cin_var</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;CIN:</span><span class="si">{</span><span class="n">cape_var</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>  <span class="c1"># CIN variable</span>
            <span class="n">product</span> <span class="o">=</span> <span class="s1">&#39;prs&#39;</span>
        <span class="k">elif</span> <span class="s2">&quot;uphl&quot;</span> <span class="ow">in</span> <span class="n">keyword</span><span class="p">:</span>
            <span class="n">uphl_var</span><span class="p">,</span> <span class="n">refc_var</span> <span class="o">=</span> <span class="n">variables</span>
            <span class="n">product</span> <span class="o">=</span> <span class="s1">&#39;prs&#39;</span>
        <span class="k">elif</span> <span class="s2">&quot;sfc&quot;</span> <span class="ow">in</span> <span class="n">keyword</span> <span class="ow">or</span> <span class="s2">&quot;TE&quot;</span> <span class="ow">in</span> <span class="n">keyword</span><span class="p">:</span>
            <span class="n">temp_var</span><span class="p">,</span> <span class="n">dpt_var</span><span class="p">,</span> <span class="n">winds_var</span><span class="p">,</span> <span class="n">winds2_var</span> <span class="o">=</span> <span class="n">variables</span><span class="p">[:</span><span class="mi">4</span><span class="p">]</span>
            <span class="k">if</span> <span class="s2">&quot;TE&quot;</span> <span class="ow">in</span> <span class="n">keyword</span><span class="p">:</span>
                <span class="n">pres_var</span> <span class="o">=</span> <span class="n">variables</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
            <span class="n">product</span> <span class="o">=</span> <span class="s1">&#39;sfc&#39;</span>
        <span class="k">elif</span> <span class="s2">&quot;gh&quot;</span> <span class="ow">in</span> <span class="n">keyword</span><span class="p">:</span>
            <span class="n">gh_var</span><span class="p">,</span> <span class="n">winds_var</span><span class="p">,</span> <span class="n">winds2_var</span> <span class="o">=</span> <span class="n">variables</span>
            <span class="n">product</span> <span class="o">=</span> <span class="s1">&#39;prs&#39;</span>
        <span class="k">elif</span> <span class="s2">&quot;LCL&quot;</span> <span class="ow">in</span> <span class="n">keyword</span><span class="p">:</span>
            <span class="n">temp_var</span><span class="p">,</span> <span class="n">dpt_var</span><span class="p">,</span> <span class="n">pres_var</span> <span class="o">=</span> <span class="n">variables</span>
            <span class="n">product</span> <span class="o">=</span> <span class="s1">&#39;sfc&#39;</span>
        <span class="k">elif</span> <span class="s2">&quot;STP&quot;</span> <span class="ow">in</span> <span class="n">keyword</span><span class="p">:</span>
            <span class="n">temp_var</span><span class="p">,</span> <span class="n">dpt_var</span><span class="p">,</span> <span class="n">pres_var</span><span class="p">,</span> <span class="n">hlcy_var</span><span class="p">,</span> <span class="n">cape_var</span><span class="p">,</span> <span class="n">vvcsh_var</span><span class="p">,</span> <span class="n">vucsh_var</span> <span class="o">=</span> <span class="n">variables</span>
            <span class="n">product</span> <span class="o">=</span> <span class="s1">&#39;prs&#39;</span>
        <span class="k">elif</span> <span class="s2">&quot;THESHR&quot;</span> <span class="ow">in</span> <span class="n">keyword</span><span class="p">:</span>
            <span class="n">temp_var</span><span class="p">,</span> <span class="n">dpt_var</span><span class="p">,</span> <span class="n">pres_var</span><span class="p">,</span> <span class="n">vvcsh_var</span><span class="p">,</span> <span class="n">vucsh_var</span> <span class="o">=</span> <span class="n">variables</span>
            <span class="n">product</span> <span class="o">=</span> <span class="s1">&#39;sfc&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">gh_var</span><span class="p">,</span> <span class="n">second_var</span> <span class="o">=</span> <span class="n">variables</span>
            <span class="k">if</span> <span class="s2">&quot;ABSV&quot;</span> <span class="ow">in</span> <span class="n">keyword</span><span class="p">:</span>
                <span class="n">absv_var</span> <span class="o">=</span> <span class="n">second_var</span>
                <span class="n">product</span> <span class="o">=</span> <span class="s1">&#39;prs&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">uvv_var</span> <span class="o">=</span> <span class="n">second_var</span>
                <span class="n">product</span> <span class="o">=</span> <span class="s1">&#39;prs&#39;</span>
    <span class="k">elif</span> <span class="n">keyword</span> <span class="o">==</span> <span class="s2">&quot;QPF&quot;</span><span class="p">:</span>
        <span class="n">precip_var</span> <span class="o">=</span> <span class="n">variables</span>
        <span class="n">product</span> <span class="o">=</span> <span class="s1">&#39;sfc&#39;</span>
    <span class="k">elif</span> <span class="n">keyword</span> <span class="o">==</span> <span class="s2">&quot;helcy3&quot;</span><span class="p">:</span>
        <span class="n">helcy_var</span> <span class="o">=</span> <span class="n">variables</span>
        <span class="n">product</span> <span class="o">=</span> <span class="s1">&#39;sfc&#39;</span>
    <span class="k">elif</span> <span class="n">keyword</span> <span class="o">==</span> <span class="s1">&#39;PBL&#39;</span><span class="p">:</span>
        <span class="n">pbl_var</span> <span class="o">=</span> <span class="n">variables</span>
        <span class="n">product</span> <span class="o">=</span> <span class="s1">&#39;sfc&#39;</span>
    <span class="k">elif</span> <span class="n">keyword</span> <span class="o">==</span> <span class="s2">&quot;LI&quot;</span><span class="p">:</span>
        <span class="n">lif_var</span> <span class="o">=</span> <span class="n">variables</span>
        <span class="n">product</span> <span class="o">=</span> <span class="s1">&#39;sfc&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">cape_var</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;CAPE:</span><span class="si">{</span><span class="n">get_pressure_level</span><span class="p">(</span><span class="n">keyword</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">cin_var</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;CIN:</span><span class="si">{</span><span class="n">get_pressure_level</span><span class="p">(</span><span class="n">keyword</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">product</span> <span class="o">=</span> <span class="s1">&#39;prs&#39;</span>

    <span class="k">for</span> <span class="n">fxx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_fxx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">H</span> <span class="o">=</span> <span class="n">Herbie</span><span class="p">(</span><span class="n">date</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span> <span class="n">product</span><span class="o">=</span><span class="n">product</span><span class="p">,</span> <span class="n">fxx</span><span class="o">=</span><span class="n">fxx</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">cape_var</span><span class="p">:</span>
            <span class="n">H</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="n">cape_var</span><span class="p">)</span>
            <span class="n">file_path_cape</span> <span class="o">=</span> <span class="n">H</span><span class="o">.</span><span class="n">get_localFilePath</span><span class="p">(</span><span class="n">cape_var</span><span class="p">)</span>
            <span class="n">file_paths</span><span class="p">[</span><span class="s1">&#39;cape&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">file_path_cape</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Downloaded cape file for fxx=</span><span class="si">{</span><span class="n">fxx</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">file_path_cape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">cin_var</span> <span class="ow">and</span> <span class="s1">&#39;hlcy&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">keyword</span><span class="p">:</span>
            <span class="n">H</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="n">cin_var</span><span class="p">)</span>
            <span class="n">file_path_cin</span> <span class="o">=</span> <span class="n">H</span><span class="o">.</span><span class="n">get_localFilePath</span><span class="p">(</span><span class="n">cin_var</span><span class="p">)</span>
            <span class="n">file_paths</span><span class="p">[</span><span class="s1">&#39;cin&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">file_path_cin</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Downloaded cin file for fxx=</span><span class="si">{</span><span class="n">fxx</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">file_path_cin</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">hlcy_var</span><span class="p">:</span>
            <span class="n">H</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="n">hlcy_var</span><span class="p">)</span>
            <span class="n">file_path_hlcy</span> <span class="o">=</span> <span class="n">H</span><span class="o">.</span><span class="n">get_localFilePath</span><span class="p">(</span><span class="n">hlcy_var</span><span class="p">)</span>
            <span class="n">file_paths</span><span class="p">[</span><span class="s1">&#39;hlcy&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">file_path_hlcy</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Downloaded hlcy file for fxx=</span><span class="si">{</span><span class="n">fxx</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">file_path_hlcy</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">helcy_var</span><span class="p">:</span>
            <span class="n">H</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="n">helcy_var</span><span class="p">)</span>
            <span class="n">file_path_helcy</span> <span class="o">=</span> <span class="n">H</span><span class="o">.</span><span class="n">get_localFilePath</span><span class="p">(</span><span class="n">helcy_var</span><span class="p">)</span>
            <span class="n">file_paths</span><span class="p">[</span><span class="s1">&#39;helcy&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">file_path_helcy</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Downloaded helcy file for fxx=</span><span class="si">{</span><span class="n">fxx</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">file_path_helcy</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">gh_var</span><span class="p">:</span>
            <span class="n">H</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="n">gh_var</span><span class="p">)</span>
            <span class="n">file_path_gh</span> <span class="o">=</span> <span class="n">H</span><span class="o">.</span><span class="n">get_localFilePath</span><span class="p">(</span><span class="n">gh_var</span><span class="p">)</span>
            <span class="n">file_paths</span><span class="p">[</span><span class="s1">&#39;gh&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">file_path_gh</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Downloaded gh file for fxx=</span><span class="si">{</span><span class="n">fxx</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">file_path_gh</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">uvv_var</span><span class="p">:</span>
            <span class="n">H</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="n">uvv_var</span><span class="p">)</span>
            <span class="n">file_path_uvv</span> <span class="o">=</span> <span class="n">H</span><span class="o">.</span><span class="n">get_localFilePath</span><span class="p">(</span><span class="n">uvv_var</span><span class="p">)</span>
            <span class="n">file_paths</span><span class="p">[</span><span class="s1">&#39;uvv&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">file_path_uvv</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Downloaded uvv file for fxx=</span><span class="si">{</span><span class="n">fxx</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">file_path_uvv</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">absv_var</span><span class="p">:</span>
            <span class="n">H</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="n">absv_var</span><span class="p">)</span>
            <span class="n">file_path_absv</span> <span class="o">=</span> <span class="n">H</span><span class="o">.</span><span class="n">get_localFilePath</span><span class="p">(</span><span class="n">absv_var</span><span class="p">)</span>
            <span class="n">file_paths</span><span class="p">[</span><span class="s1">&#39;absv&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">file_path_absv</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Downloaded absv file for fxx=</span><span class="si">{</span><span class="n">fxx</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">file_path_absv</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">precip_var</span><span class="p">:</span>
            <span class="n">H</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="n">precip_var</span><span class="p">)</span>
            <span class="n">file_path_precip</span> <span class="o">=</span> <span class="n">H</span><span class="o">.</span><span class="n">get_localFilePath</span><span class="p">(</span><span class="n">precip_var</span><span class="p">)</span>
            <span class="n">file_paths</span><span class="p">[</span><span class="s1">&#39;precip&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">file_path_precip</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Downloaded precip file for fxx=</span><span class="si">{</span><span class="n">fxx</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">file_path_precip</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            
        <span class="k">if</span> <span class="n">uphl_var</span><span class="p">:</span>
            <span class="n">H</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="n">uphl_var</span><span class="p">)</span>
            <span class="n">file_path_uphl</span> <span class="o">=</span> <span class="n">H</span><span class="o">.</span><span class="n">get_localFilePath</span><span class="p">(</span><span class="n">uphl_var</span><span class="p">)</span>
            <span class="n">file_paths</span><span class="p">[</span><span class="s1">&#39;uphl&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">file_path_uphl</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Downloaded uphl file for fxx=</span><span class="si">{</span><span class="n">fxx</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">file_path_uphl</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">refc_var</span><span class="p">:</span>
            <span class="n">H</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="n">refc_var</span><span class="p">)</span>
            <span class="n">file_path_refc</span> <span class="o">=</span> <span class="n">H</span><span class="o">.</span><span class="n">get_localFilePath</span><span class="p">(</span><span class="n">refc_var</span><span class="p">)</span>
            <span class="n">file_paths</span><span class="p">[</span><span class="s1">&#39;refc&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">file_path_refc</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Downloaded refc file for fxx=</span><span class="si">{</span><span class="n">fxx</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">file_path_refc</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            
        <span class="k">if</span> <span class="n">temp_var</span><span class="p">:</span>
            <span class="n">H</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="n">temp_var</span><span class="p">)</span>
            <span class="n">file_path_temp</span> <span class="o">=</span> <span class="n">H</span><span class="o">.</span><span class="n">get_localFilePath</span><span class="p">(</span><span class="n">temp_var</span><span class="p">)</span>
            <span class="n">file_paths</span><span class="p">[</span><span class="s1">&#39;temp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">file_path_temp</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Downloaded temp (lcl) file for fxx=</span><span class="si">{</span><span class="n">fxx</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">file_path_temp</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            
        <span class="k">if</span> <span class="n">dpt_var</span><span class="p">:</span>
            <span class="n">H</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="n">dpt_var</span><span class="p">)</span>
            <span class="n">file_path_dpt</span> <span class="o">=</span> <span class="n">H</span><span class="o">.</span><span class="n">get_localFilePath</span><span class="p">(</span><span class="n">dpt_var</span><span class="p">)</span>
            <span class="n">file_paths</span><span class="p">[</span><span class="s1">&#39;dpt&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">file_path_dpt</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Downloaded dpt (lcl) file for fxx=</span><span class="si">{</span><span class="n">fxx</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">file_path_dpt</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            
        <span class="k">if</span> <span class="n">pres_var</span><span class="p">:</span>
            <span class="n">H</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="n">pres_var</span><span class="p">)</span>
            <span class="n">file_path_pres</span> <span class="o">=</span> <span class="n">H</span><span class="o">.</span><span class="n">get_localFilePath</span><span class="p">(</span><span class="n">pres_var</span><span class="p">)</span>
            <span class="n">file_paths</span><span class="p">[</span><span class="s1">&#39;pres&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">file_path_pres</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Downloaded pres (lcl) file for fxx=</span><span class="si">{</span><span class="n">fxx</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">file_path_pres</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            
        <span class="k">if</span> <span class="n">winds_var</span><span class="p">:</span>
            <span class="n">H</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="n">winds_var</span><span class="p">)</span>
            <span class="n">file_path_winds</span> <span class="o">=</span> <span class="n">H</span><span class="o">.</span><span class="n">get_localFilePath</span><span class="p">(</span><span class="n">winds_var</span><span class="p">)</span>
            <span class="n">file_paths</span><span class="p">[</span><span class="s1">&#39;winds&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">file_path_winds</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Downloaded winds file for fxx=</span><span class="si">{</span><span class="n">fxx</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">file_path_winds</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">winds2_var</span><span class="p">:</span>
            <span class="n">H</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="n">winds2_var</span><span class="p">)</span>
            <span class="n">file_path_winds2</span> <span class="o">=</span> <span class="n">H</span><span class="o">.</span><span class="n">get_localFilePath</span><span class="p">(</span><span class="n">winds2_var</span><span class="p">)</span>
            <span class="n">file_paths</span><span class="p">[</span><span class="s1">&#39;winds2&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">file_path_winds2</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Downloaded winds2 file for fxx=</span><span class="si">{</span><span class="n">fxx</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">file_path_winds2</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            
        <span class="k">if</span> <span class="n">vvcsh_var</span><span class="p">:</span>
            <span class="n">H</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="n">vvcsh_var</span><span class="p">)</span>
            <span class="n">file_path_vvcsh</span> <span class="o">=</span> <span class="n">H</span><span class="o">.</span><span class="n">get_localFilePath</span><span class="p">(</span><span class="n">vvcsh_var</span><span class="p">)</span>
            <span class="n">file_paths</span><span class="p">[</span><span class="s1">&#39;vvcsh&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">file_path_vvcsh</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Downloaded vvcsh file for fxx=</span><span class="si">{</span><span class="n">fxx</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">file_path_vvcsh</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">vucsh_var</span><span class="p">:</span>
            <span class="n">H</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="n">vucsh_var</span><span class="p">)</span>
            <span class="n">file_path_vucsh</span> <span class="o">=</span> <span class="n">H</span><span class="o">.</span><span class="n">get_localFilePath</span><span class="p">(</span><span class="n">vucsh_var</span><span class="p">)</span>
            <span class="n">file_paths</span><span class="p">[</span><span class="s1">&#39;vucsh&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">file_path_vucsh</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Downloaded vucsh file for fxx=</span><span class="si">{</span><span class="n">fxx</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">file_path_vucsh</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">lif_var</span><span class="p">:</span>
            <span class="n">H</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="n">lif_var</span><span class="p">)</span>
            <span class="n">file_path_lif</span> <span class="o">=</span> <span class="n">H</span><span class="o">.</span><span class="n">get_localFilePath</span><span class="p">(</span><span class="n">lif_var</span><span class="p">)</span>
            <span class="n">file_paths</span><span class="p">[</span><span class="s1">&#39;lift&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">file_path_lif</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Downloaded lif file for fxx=</span><span class="si">{</span><span class="n">fxx</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">file_path_lif</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">pbl_var</span><span class="p">:</span>
            <span class="n">H</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="n">pbl_var</span><span class="p">)</span>
            <span class="n">file_path_pbl</span> <span class="o">=</span> <span class="n">H</span><span class="o">.</span><span class="n">get_localFilePath</span><span class="p">(</span><span class="n">pbl_var</span><span class="p">)</span>
            <span class="n">file_paths</span><span class="p">[</span><span class="s1">&#39;pbl&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">file_path_pbl</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Downloaded pbl file for fxx=</span><span class="si">{</span><span class="n">fxx</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">file_path_pbl</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">file_paths</span>

<span class="k">def</span> <span class="nf">create_custom_colormap</span><span class="p">():</span>
    <span class="n">colors</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;blue&#39;</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="s1">&#39;white&#39;</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;red&#39;</span><span class="p">)]</span>
    <span class="n">cmap_name</span> <span class="o">=</span> <span class="s1">&#39;custom_bwr&#39;</span>
    <span class="k">return</span> <span class="n">LinearSegmentedColormap</span><span class="o">.</span><span class="n">from_list</span><span class="p">(</span><span class="n">cmap_name</span><span class="p">,</span> <span class="n">colors</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="mi">256</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">create_gray_colormap</span><span class="p">():</span>
    <span class="n">colors</span> <span class="o">=</span> <span class="p">[(</span><span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">)]</span> <span class="o">*</span> <span class="mi">256</span>
    <span class="k">return</span> <span class="n">LinearSegmentedColormap</span><span class="o">.</span><span class="n">from_list</span><span class="p">(</span><span class="s1">&#39;gray_cmap&#39;</span><span class="p">,</span> <span class="n">colors</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="mi">256</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">round_to_multiple</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">multiple</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">multiple</span> <span class="o">*</span> <span class="nb">round</span><span class="p">(</span><span class="n">value</span> <span class="o">/</span> <span class="n">multiple</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">pressure_to_height</span><span class="p">(</span><span class="n">pressure_hPa</span><span class="p">):</span>
    <span class="c1"># Constants for the barometric formula</span>
    <span class="n">T0</span> <span class="o">=</span> <span class="mf">288.15</span>  <span class="c1"># Standard temperature at sea level in K</span>
    <span class="n">L</span> <span class="o">=</span> <span class="mf">0.0065</span>   <span class="c1"># Temperature lapse rate in K/m</span>
    <span class="n">P0</span> <span class="o">=</span> <span class="mf">1013.25</span>  <span class="c1"># Standard pressure at sea level in hPa</span>
    <span class="n">g</span> <span class="o">=</span> <span class="mf">9.80665</span>  <span class="c1"># Gravitational acceleration in m/s^2</span>
    <span class="n">R</span> <span class="o">=</span> <span class="mf">287.05</span>   <span class="c1"># Specific gas constant for dry air in J/(kgK)</span>

    <span class="n">height_m</span> <span class="o">=</span> <span class="p">(</span><span class="n">T0</span> <span class="o">/</span> <span class="n">L</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="n">pressure_hPa</span> <span class="o">/</span> <span class="n">P0</span><span class="p">)</span> <span class="o">**</span> <span class="p">(</span><span class="n">R</span> <span class="o">*</span> <span class="n">L</span> <span class="o">/</span> <span class="n">g</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">height_m</span>

<span class="k">def</span> <span class="nf">create_frame</span><span class="p">(</span><span class="n">file_paths</span><span class="p">,</span> <span class="n">fxx</span><span class="p">,</span> <span class="n">output_dir</span><span class="p">,</span> <span class="n">extent</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">init_time</span><span class="p">,</span> <span class="n">model_name</span><span class="p">,</span> <span class="n">cape_min</span><span class="p">,</span> <span class="n">cape_max</span><span class="p">,</span> <span class="n">cin_min</span><span class="p">,</span> <span class="n">cin_max</span><span class="p">,</span> <span class="n">keyword</span><span class="p">,</span> <span class="n">uvv_min</span><span class="p">,</span> <span class="n">uvv_max</span><span class="p">,</span> <span class="n">absv_min</span><span class="p">,</span> <span class="n">absv_max</span><span class="p">,</span> <span class="n">tp_min</span><span class="p">,</span> <span class="n">tp_max</span><span class="p">,</span> <span class="n">tempf_min</span><span class="p">,</span> <span class="n">tempf_max</span><span class="p">,</span> <span class="n">barb_step</span><span class="p">,</span> <span class="n">theta_e_min</span><span class="p">,</span> <span class="n">theta_e_max</span><span class="p">,</span> <span class="n">wind_speed_max</span><span class="p">,</span> <span class="n">hlcy_min</span><span class="p">,</span> <span class="n">hlcy_max</span><span class="p">,</span> <span class="n">lift_min</span><span class="p">,</span> <span class="n">lift_max</span><span class="p">,</span> <span class="n">lcl_min</span><span class="p">,</span> <span class="n">lcl_max</span><span class="p">,</span> <span class="n">pbl_min</span><span class="p">,</span> <span class="n">pbl_max</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">12</span><span class="p">,</span> <span class="mi">8</span><span class="p">],</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">(</span><span class="n">projection</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">())</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">set_extent</span><span class="p">(</span><span class="n">extent</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">())</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">cfeature</span><span class="o">.</span><span class="n">STATES</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">cfeature</span><span class="o">.</span><span class="n">COASTLINE</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">cfeature</span><span class="o">.</span><span class="n">BORDERS</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">USCOUNTIES</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Creating frame for fxx=</span><span class="si">{</span><span class="n">fxx</span><span class="si">}</span><span class="s2"> with keyword=</span><span class="si">{</span><span class="n">keyword</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="s1">&#39;hlcy&#39;</span> <span class="ow">in</span> <span class="n">keyword</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Processing hlcy data&quot;</span><span class="p">)</span>
            <span class="n">file_hlcy</span> <span class="o">=</span> <span class="n">file_paths</span><span class="p">[</span><span class="s1">&#39;hlcy&#39;</span><span class="p">][</span><span class="n">fxx</span><span class="p">]</span>
            <span class="n">ds_hlcy</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">file_hlcy</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s1">&#39;cfgrib&#39;</span><span class="p">,</span> <span class="n">filter_by_keys</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;stepType&#39;</span><span class="p">:</span> <span class="s1">&#39;instant&#39;</span><span class="p">})</span>
            <span class="n">hlcy</span> <span class="o">=</span> <span class="n">ds_hlcy</span><span class="o">.</span><span class="n">hlcy</span><span class="o">.</span><span class="n">values</span>
            <span class="n">lon</span> <span class="o">=</span> <span class="n">ds_hlcy</span><span class="o">.</span><span class="n">longitude</span><span class="o">.</span><span class="n">values</span>
            <span class="n">lat</span> <span class="o">=</span> <span class="n">ds_hlcy</span><span class="o">.</span><span class="n">latitude</span><span class="o">.</span><span class="n">values</span>

            <span class="k">if</span> <span class="n">hlcy</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">hlcy</span> <span class="o">=</span> <span class="n">hlcy</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span>  <span class="c1"># Selecting the first level/time step</span>

            <span class="n">lon_ds</span> <span class="o">=</span> <span class="n">downsample_data</span><span class="p">(</span><span class="n">lon</span><span class="p">,</span> <span class="n">step</span><span class="p">)</span>
            <span class="n">lat_ds</span> <span class="o">=</span> <span class="n">downsample_data</span><span class="p">(</span><span class="n">lat</span><span class="p">,</span> <span class="n">step</span><span class="p">)</span>
            <span class="n">hlcy_ds</span> <span class="o">=</span> <span class="n">downsample_data</span><span class="p">(</span><span class="n">hlcy</span><span class="p">,</span> <span class="n">step</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="s1">&#39;helcy3&#39;</span> <span class="ow">in</span> <span class="n">keyword</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Processing helcy3 data&quot;</span><span class="p">)</span>
            <span class="n">file_hlcy</span> <span class="o">=</span> <span class="n">file_paths</span><span class="p">[</span><span class="s1">&#39;helcy&#39;</span><span class="p">][</span><span class="n">fxx</span><span class="p">]</span>
            <span class="n">ds_hlcy</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">file_hlcy</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s1">&#39;cfgrib&#39;</span><span class="p">,</span> <span class="n">filter_by_keys</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;stepType&#39;</span><span class="p">:</span> <span class="s1">&#39;instant&#39;</span><span class="p">})</span>
            <span class="n">hlcy</span> <span class="o">=</span> <span class="n">ds_hlcy</span><span class="p">[</span><span class="s1">&#39;hlcy&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
            <span class="n">lon</span> <span class="o">=</span> <span class="n">ds_hlcy</span><span class="o">.</span><span class="n">longitude</span><span class="o">.</span><span class="n">values</span>
            <span class="n">lat</span> <span class="o">=</span> <span class="n">ds_hlcy</span><span class="o">.</span><span class="n">latitude</span><span class="o">.</span><span class="n">values</span>

            <span class="k">if</span> <span class="n">hlcy</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">hlcy</span> <span class="o">=</span> <span class="n">hlcy</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span>  <span class="c1"># Selecting the first level/time step</span>

            <span class="n">lon_ds</span> <span class="o">=</span> <span class="n">downsample_data</span><span class="p">(</span><span class="n">lon</span><span class="p">,</span> <span class="n">step</span><span class="p">)</span>
            <span class="n">lat_ds</span> <span class="o">=</span> <span class="n">downsample_data</span><span class="p">(</span><span class="n">lat</span><span class="p">,</span> <span class="n">step</span><span class="p">)</span>
            <span class="n">hlcy_ds</span> <span class="o">=</span> <span class="n">downsample_data</span><span class="p">(</span><span class="n">hlcy</span><span class="p">,</span> <span class="n">step</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;hlcy_ds shape: </span><span class="si">{</span><span class="n">hlcy_ds</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">, lon_ds shape: </span><span class="si">{</span><span class="n">lon_ds</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">, lat_ds shape: </span><span class="si">{</span><span class="n">lat_ds</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="s1">&#39;LI&#39;</span> <span class="ow">in</span> <span class="n">keyword</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Processing LI data&quot;</span><span class="p">)</span>
            <span class="n">file_lif</span> <span class="o">=</span> <span class="n">file_paths</span><span class="p">[</span><span class="s1">&#39;lift&#39;</span><span class="p">][</span><span class="n">fxx</span><span class="p">]</span>
            <span class="n">ds_lift</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">file_lif</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s1">&#39;cfgrib&#39;</span><span class="p">,</span> <span class="n">filter_by_keys</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;stepType&#39;</span><span class="p">:</span> <span class="s1">&#39;instant&#39;</span><span class="p">})</span>
            <span class="n">lift_ds</span> <span class="o">=</span> <span class="n">ds_lift</span><span class="p">[</span><span class="s1">&#39;lftx&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span> 
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Values for LI are </span><span class="si">{</span><span class="n">lift_ds</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
            <span class="n">lon_ds</span> <span class="o">=</span> <span class="n">ds_lift</span><span class="o">.</span><span class="n">longitude</span><span class="o">.</span><span class="n">values</span>
            <span class="n">lat_ds</span> <span class="o">=</span> <span class="n">ds_lift</span><span class="o">.</span><span class="n">latitude</span><span class="o">.</span><span class="n">values</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;lift_ds shape: </span><span class="si">{</span><span class="n">lift_ds</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">, lon_ds shape: </span><span class="si">{</span><span class="n">lon_ds</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">, lat_ds shape: </span><span class="si">{</span><span class="n">lat_ds</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;PBL&#39;</span> <span class="ow">in</span> <span class="n">keyword</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Processing PBL data&quot;</span><span class="p">)</span>
            <span class="n">file_pbl</span> <span class="o">=</span> <span class="n">file_paths</span><span class="p">[</span><span class="s1">&#39;pbl&#39;</span><span class="p">][</span><span class="n">fxx</span><span class="p">]</span>
            <span class="n">ds_pbl</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">file_pbl</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s1">&#39;cfgrib&#39;</span><span class="p">,</span> <span class="n">filter_by_keys</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;stepType&#39;</span><span class="p">:</span> <span class="s1">&#39;instant&#39;</span><span class="p">})</span>
            <span class="n">pbl_ds</span> <span class="o">=</span> <span class="n">ds_pbl</span><span class="p">[</span><span class="s1">&#39;blh&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span> 
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Values for blh are </span><span class="si">{</span><span class="n">pbl_ds</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
            <span class="n">lon_ds</span> <span class="o">=</span> <span class="n">ds_pbl</span><span class="o">.</span><span class="n">longitude</span><span class="o">.</span><span class="n">values</span>
            <span class="n">lat_ds</span> <span class="o">=</span> <span class="n">ds_pbl</span><span class="o">.</span><span class="n">latitude</span><span class="o">.</span><span class="n">values</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;pbl_;ds shape: </span><span class="si">{</span><span class="n">pbl_ds</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">, lon_ds shape: </span><span class="si">{</span><span class="n">lon_ds</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">, lat_ds shape: </span><span class="si">{</span><span class="n">lat_ds</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="s1">&#39;CAPE&#39;</span> <span class="ow">in</span> <span class="n">keyword</span> <span class="ow">and</span> <span class="s1">&#39;STP&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">keyword</span> <span class="ow">or</span> <span class="p">(</span><span class="s1">&#39;cape&#39;</span> <span class="ow">in</span> <span class="n">file_paths</span> <span class="ow">and</span> <span class="n">file_paths</span><span class="p">[</span><span class="s1">&#39;cape&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="s1">&#39;STP&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">keyword</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Processing CAPE data&quot;</span><span class="p">)</span>
            <span class="n">file_cape</span> <span class="o">=</span> <span class="n">file_paths</span><span class="p">[</span><span class="s1">&#39;cape&#39;</span><span class="p">][</span><span class="n">fxx</span><span class="p">]</span>
            <span class="n">ds_cape</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">file_cape</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s1">&#39;cfgrib&#39;</span><span class="p">,</span> <span class="n">filter_by_keys</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;stepType&#39;</span><span class="p">:</span> <span class="s1">&#39;instant&#39;</span><span class="p">})</span>
            <span class="k">if</span> <span class="s1">&#39;cape&#39;</span> <span class="ow">in</span> <span class="n">ds_cape</span><span class="p">:</span>
                <span class="n">cape</span> <span class="o">=</span> <span class="n">ds_cape</span><span class="o">.</span><span class="n">cape</span><span class="o">.</span><span class="n">values</span>
                <span class="n">lon</span> <span class="o">=</span> <span class="n">ds_cape</span><span class="o">.</span><span class="n">longitude</span><span class="o">.</span><span class="n">values</span>
                <span class="n">lat</span> <span class="o">=</span> <span class="n">ds_cape</span><span class="o">.</span><span class="n">latitude</span><span class="o">.</span><span class="n">values</span>

                <span class="n">lon_ds</span> <span class="o">=</span> <span class="n">downsample_data</span><span class="p">(</span><span class="n">lon</span><span class="p">,</span> <span class="n">step</span><span class="p">)</span>
                <span class="n">lat_ds</span> <span class="o">=</span> <span class="n">downsample_data</span><span class="p">(</span><span class="n">lat</span><span class="p">,</span> <span class="n">step</span><span class="p">)</span>
                <span class="n">cape_ds</span> <span class="o">=</span> <span class="n">downsample_data</span><span class="p">(</span><span class="n">cape</span><span class="p">,</span> <span class="n">step</span><span class="p">)</span>

                <span class="k">if</span> <span class="s1">&#39;cin&#39;</span> <span class="ow">in</span> <span class="n">file_paths</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">file_paths</span><span class="p">[</span><span class="s1">&#39;cin&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Processing CIN data&quot;</span><span class="p">)</span>
                    <span class="n">file_cin</span> <span class="o">=</span> <span class="n">file_paths</span><span class="p">[</span><span class="s1">&#39;cin&#39;</span><span class="p">][</span><span class="n">fxx</span><span class="p">]</span>
                    <span class="n">ds_cin</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">file_cin</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s1">&#39;cfgrib&#39;</span><span class="p">,</span> <span class="n">filter_by_keys</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;stepType&#39;</span><span class="p">:</span> <span class="s1">&#39;instant&#39;</span><span class="p">})</span>
                    <span class="n">cin</span> <span class="o">=</span> <span class="n">ds_cin</span><span class="o">.</span><span class="n">cin</span><span class="o">.</span><span class="n">values</span>

                    <span class="n">cin_ds</span> <span class="o">=</span> <span class="n">downsample_data</span><span class="p">(</span><span class="n">cin</span><span class="p">,</span> <span class="n">step</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="s1">&#39;UVV&#39;</span> <span class="ow">in</span> <span class="n">keyword</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Processing UVV data&quot;</span><span class="p">)</span>
            <span class="n">file_gh</span> <span class="o">=</span> <span class="n">file_paths</span><span class="p">[</span><span class="s1">&#39;gh&#39;</span><span class="p">][</span><span class="n">fxx</span><span class="p">]</span>
            <span class="n">ds_gh</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">file_gh</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s1">&#39;cfgrib&#39;</span><span class="p">,</span> <span class="n">filter_by_keys</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;stepType&#39;</span><span class="p">:</span> <span class="s1">&#39;instant&#39;</span><span class="p">})</span>
            <span class="n">gh</span> <span class="o">=</span> <span class="n">ds_gh</span><span class="o">.</span><span class="n">gh</span><span class="o">.</span><span class="n">values</span>
            <span class="n">lon</span> <span class="o">=</span> <span class="n">ds_gh</span><span class="o">.</span><span class="n">longitude</span><span class="o">.</span><span class="n">values</span>
            <span class="n">lat</span> <span class="o">=</span> <span class="n">ds_gh</span><span class="o">.</span><span class="n">latitude</span><span class="o">.</span><span class="n">values</span>

            <span class="n">lon_ds</span> <span class="o">=</span> <span class="n">downsample_data</span><span class="p">(</span><span class="n">lon</span><span class="p">,</span> <span class="n">step</span><span class="p">)</span>
            <span class="n">lat_ds</span> <span class="o">=</span> <span class="n">downsample_data</span><span class="p">(</span><span class="n">lat</span><span class="p">,</span> <span class="n">step</span><span class="p">)</span>
            <span class="n">gh_ds</span> <span class="o">=</span> <span class="n">downsample_data</span><span class="p">(</span><span class="n">gh</span><span class="p">,</span> <span class="n">step</span><span class="p">)</span>

            <span class="n">file_uvv</span> <span class="o">=</span> <span class="n">file_paths</span><span class="p">[</span><span class="s1">&#39;uvv&#39;</span><span class="p">][</span><span class="n">fxx</span><span class="p">]</span>
            <span class="n">ds_uvv</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">file_uvv</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s1">&#39;cfgrib&#39;</span><span class="p">,</span> <span class="n">filter_by_keys</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;stepType&#39;</span><span class="p">:</span> <span class="s1">&#39;instant&#39;</span><span class="p">})</span>
            <span class="n">uvv</span> <span class="o">=</span> <span class="n">ds_uvv</span><span class="o">.</span><span class="n">w</span><span class="o">.</span><span class="n">values</span>  <span class="c1"># Assuming &#39;w&#39; is the variable name for vertical velocity</span>

            <span class="n">uvv_ds</span> <span class="o">=</span> <span class="n">downsample_data</span><span class="p">(</span><span class="n">uvv</span><span class="p">,</span> <span class="n">step</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="s1">&#39;ABSV&#39;</span> <span class="ow">in</span> <span class="n">keyword</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Processing ABSV data&quot;</span><span class="p">)</span>
            <span class="n">file_gh</span> <span class="o">=</span> <span class="n">file_paths</span><span class="p">[</span><span class="s1">&#39;gh&#39;</span><span class="p">][</span><span class="n">fxx</span><span class="p">]</span>
            <span class="n">ds_gh</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">file_gh</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s1">&#39;cfgrib&#39;</span><span class="p">,</span> <span class="n">filter_by_keys</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;stepType&#39;</span><span class="p">:</span> <span class="s1">&#39;instant&#39;</span><span class="p">})</span>
            <span class="n">gh</span> <span class="o">=</span> <span class="n">ds_gh</span><span class="o">.</span><span class="n">gh</span><span class="o">.</span><span class="n">values</span>
            <span class="n">lon</span> <span class="o">=</span> <span class="n">ds_gh</span><span class="o">.</span><span class="n">longitude</span><span class="o">.</span><span class="n">values</span>
            <span class="n">lat</span> <span class="o">=</span> <span class="n">ds_gh</span><span class="o">.</span><span class="n">latitude</span><span class="o">.</span><span class="n">values</span>

            <span class="n">lon_ds</span> <span class="o">=</span> <span class="n">downsample_data</span><span class="p">(</span><span class="n">lon</span><span class="p">,</span> <span class="n">step</span><span class="p">)</span>
            <span class="n">lat_ds</span> <span class="o">=</span> <span class="n">downsample_data</span><span class="p">(</span><span class="n">lat</span><span class="p">,</span> <span class="n">step</span><span class="p">)</span>
            <span class="n">gh_ds</span> <span class="o">=</span> <span class="n">downsample_data</span><span class="p">(</span><span class="n">gh</span><span class="p">,</span> <span class="n">step</span><span class="p">)</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">file_absv</span> <span class="o">=</span> <span class="n">file_paths</span><span class="p">[</span><span class="s1">&#39;absv&#39;</span><span class="p">][</span><span class="n">fxx</span><span class="p">]</span>
                <span class="n">ds_absv</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">file_absv</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s1">&#39;cfgrib&#39;</span><span class="p">,</span> <span class="n">filter_by_keys</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;stepType&#39;</span><span class="p">:</span> <span class="s1">&#39;instant&#39;</span><span class="p">})</span>
                <span class="k">if</span> <span class="s1">&#39;absv&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ds_absv</span><span class="o">.</span><span class="n">variables</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;absv variable not found in dataset for fxx=</span><span class="si">{</span><span class="n">fxx</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">absv</span> <span class="o">=</span> <span class="n">ds_absv</span><span class="o">.</span><span class="n">absv</span><span class="o">.</span><span class="n">values</span>  <span class="c1"># Assuming &#39;absv&#39; is the variable name for absolute vorticity</span>
            <span class="k">except</span> <span class="p">(</span><span class="ne">IndexError</span><span class="p">,</span> <span class="ne">KeyError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error processing ABSV data for fxx=</span><span class="si">{</span><span class="n">fxx</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">None</span>

            <span class="n">absv_ds</span> <span class="o">=</span> <span class="n">downsample_data</span><span class="p">(</span><span class="n">absv</span><span class="p">,</span> <span class="n">step</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="s1">&#39;QPF&#39;</span> <span class="ow">in</span> <span class="n">keyword</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Processing QPF data&quot;</span><span class="p">)</span>
            <span class="n">file_precip</span> <span class="o">=</span> <span class="n">file_paths</span><span class="p">[</span><span class="s1">&#39;precip&#39;</span><span class="p">][</span><span class="n">fxx</span><span class="p">]</span>
            <span class="n">ds_precip</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">file_precip</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s1">&#39;cfgrib&#39;</span><span class="p">,</span> <span class="n">filter_by_keys</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;stepType&#39;</span><span class="p">:</span> <span class="s1">&#39;accum&#39;</span><span class="p">})</span>
            <span class="n">tp</span> <span class="o">=</span> <span class="n">ds_precip</span><span class="o">.</span><span class="n">tp</span><span class="o">.</span><span class="n">values</span> <span class="o">*</span> <span class="mf">0.0393701</span>  <span class="c1"># Convert from kg m**-2 to inches</span>
            <span class="n">lon</span> <span class="o">=</span> <span class="n">ds_precip</span><span class="o">.</span><span class="n">longitude</span><span class="o">.</span><span class="n">values</span>
            <span class="n">lat</span> <span class="o">=</span> <span class="n">ds_precip</span><span class="o">.</span><span class="n">latitude</span><span class="o">.</span><span class="n">values</span>

            <span class="n">lon_ds</span> <span class="o">=</span> <span class="n">downsample_data</span><span class="p">(</span><span class="n">lon</span><span class="p">,</span> <span class="n">step</span><span class="p">)</span>
            <span class="n">lat_ds</span> <span class="o">=</span> <span class="n">downsample_data</span><span class="p">(</span><span class="n">lat</span><span class="p">,</span> <span class="n">step</span><span class="p">)</span>
            <span class="n">tp_ds</span> <span class="o">=</span> <span class="n">downsample_data</span><span class="p">(</span><span class="n">tp</span><span class="p">,</span> <span class="n">step</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="s1">&#39;uphl&#39;</span> <span class="ow">in</span> <span class="n">keyword</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Processing uphl data&quot;</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">file_uphl</span> <span class="o">=</span> <span class="n">file_paths</span><span class="p">[</span><span class="s1">&#39;uphl&#39;</span><span class="p">][</span><span class="n">fxx</span><span class="p">]</span>
                <span class="n">ds_uphl</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">file_uphl</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s1">&#39;cfgrib&#39;</span><span class="p">,</span> <span class="n">filter_by_keys</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;stepType&#39;</span><span class="p">:</span> <span class="s1">&#39;max&#39;</span><span class="p">})</span>
                <span class="k">if</span> <span class="s1">&#39;unknown&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ds_uphl</span><span class="o">.</span><span class="n">variables</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;uphl variable not found in dataset for fxx=</span><span class="si">{</span><span class="n">fxx</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">uphl</span> <span class="o">=</span> <span class="n">ds_uphl</span><span class="o">.</span><span class="n">unknown</span><span class="o">.</span><span class="n">values</span>
            <span class="k">except</span> <span class="p">(</span><span class="ne">IndexError</span><span class="p">,</span> <span class="ne">KeyError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error processing uphl data for fxx=</span><span class="si">{</span><span class="n">fxx</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">None</span>

            <span class="n">lon_ds</span> <span class="o">=</span> <span class="n">ds_uphl</span><span class="o">.</span><span class="n">longitude</span><span class="o">.</span><span class="n">values</span>  <span class="c1"># No downsampling for uphl</span>
            <span class="n">lat_ds</span> <span class="o">=</span> <span class="n">ds_uphl</span><span class="o">.</span><span class="n">latitude</span><span class="o">.</span><span class="n">values</span>  <span class="c1"># No downsampling for uphl</span>
            <span class="n">uphl_ds</span> <span class="o">=</span> <span class="n">uphl</span>  <span class="c1"># No downsampling for uphl</span>

            <span class="n">file_refc</span> <span class="o">=</span> <span class="n">file_paths</span><span class="p">[</span><span class="s1">&#39;refc&#39;</span><span class="p">][</span><span class="n">fxx</span><span class="p">]</span>
            <span class="n">ds_refc</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">file_refc</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s1">&#39;cfgrib&#39;</span><span class="p">,</span> <span class="n">filter_by_keys</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;stepType&#39;</span><span class="p">:</span> <span class="s1">&#39;instant&#39;</span><span class="p">})</span>
            <span class="n">refc</span> <span class="o">=</span> <span class="n">ds_refc</span><span class="o">.</span><span class="n">refc</span><span class="o">.</span><span class="n">values</span>

            <span class="n">refc_ds</span> <span class="o">=</span> <span class="n">refc</span>  <span class="c1"># No downsampling for refc</span>
        
        <span class="k">if</span> <span class="s1">&#39;sfc&#39;</span> <span class="ow">in</span> <span class="n">keyword</span> <span class="ow">or</span> <span class="s1">&#39;TE&#39;</span> <span class="ow">in</span> <span class="n">keyword</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Processing sfc or TE data&quot;</span><span class="p">)</span>
            <span class="n">file_temp</span> <span class="o">=</span> <span class="n">file_paths</span><span class="p">[</span><span class="s1">&#39;temp&#39;</span><span class="p">][</span><span class="n">fxx</span><span class="p">]</span>
            <span class="n">ds_temp</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">file_temp</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s1">&#39;cfgrib&#39;</span><span class="p">,</span> <span class="n">filter_by_keys</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;stepType&#39;</span><span class="p">:</span> <span class="s1">&#39;instant&#39;</span><span class="p">})</span>
            <span class="n">temp</span> <span class="o">=</span> <span class="n">ds_temp</span><span class="o">.</span><span class="n">t2m</span><span class="o">.</span><span class="n">values</span> 
            <span class="n">tempf</span> <span class="o">=</span> <span class="p">(</span><span class="n">temp</span> <span class="o">-</span> <span class="mf">273.15</span><span class="p">)</span> <span class="o">*</span> <span class="mi">9</span><span class="o">/</span><span class="mi">5</span> <span class="o">+</span> <span class="mi">32</span>  <span class="c1"># Convert from Kelvin to Fahrenheit</span>
            <span class="n">lon_ds</span> <span class="o">=</span> <span class="n">ds_temp</span><span class="o">.</span><span class="n">longitude</span><span class="o">.</span><span class="n">values</span>  <span class="c1"># No downsampling for temperature</span>
            <span class="n">lat_ds</span> <span class="o">=</span> <span class="n">ds_temp</span><span class="o">.</span><span class="n">latitude</span><span class="o">.</span><span class="n">values</span>
            
            <span class="n">file_dpt</span> <span class="o">=</span> <span class="n">file_paths</span><span class="p">[</span><span class="s1">&#39;dpt&#39;</span><span class="p">][</span><span class="n">fxx</span><span class="p">]</span>
            <span class="n">ds_dpt</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">file_dpt</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s1">&#39;cfgrib&#39;</span><span class="p">,</span> <span class="n">filter_by_keys</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;stepType&#39;</span><span class="p">:</span> <span class="s1">&#39;instant&#39;</span><span class="p">})</span>
            <span class="n">dpt</span> <span class="o">=</span> <span class="n">ds_dpt</span><span class="o">.</span><span class="n">d2m</span><span class="o">.</span><span class="n">values</span>
            <span class="n">dptf</span> <span class="o">=</span> <span class="p">(</span><span class="n">dpt</span> <span class="o">-</span> <span class="mf">273.15</span><span class="p">)</span> <span class="o">*</span> <span class="mi">9</span><span class="o">/</span><span class="mi">5</span> <span class="o">+</span> <span class="mi">32</span>  <span class="c1"># Convert from Kelvin to Fahrenheit</span>
            <span class="n">dptf_smooth</span> <span class="o">=</span> <span class="n">gaussian_filter</span><span class="p">(</span><span class="n">dptf</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>  <span class="c1"># Gaussian smoothing</span>
            
            <span class="n">file_wind</span> <span class="o">=</span> <span class="n">file_paths</span><span class="p">[</span><span class="s1">&#39;winds&#39;</span><span class="p">][</span><span class="n">fxx</span><span class="p">]</span>
            <span class="n">file_wind2</span> <span class="o">=</span> <span class="n">file_paths</span><span class="p">[</span><span class="s1">&#39;winds2&#39;</span><span class="p">][</span><span class="n">fxx</span><span class="p">]</span>
            <span class="n">ds_winds</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">file_wind</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s1">&#39;cfgrib&#39;</span><span class="p">,</span> <span class="n">filter_by_keys</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;stepType&#39;</span><span class="p">:</span> <span class="s1">&#39;instant&#39;</span><span class="p">})</span>
            <span class="n">ds_winds2</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">file_wind2</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s1">&#39;cfgrib&#39;</span><span class="p">,</span> <span class="n">filter_by_keys</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;stepType&#39;</span><span class="p">:</span> <span class="s1">&#39;instant&#39;</span><span class="p">})</span>
            <span class="n">u10</span> <span class="o">=</span> <span class="n">ds_winds</span><span class="o">.</span><span class="n">u10</span><span class="o">.</span><span class="n">values</span> <span class="o">*</span> <span class="n">MS_TO_KNOTS</span>
            <span class="n">v10</span> <span class="o">=</span> <span class="n">ds_winds2</span><span class="o">.</span><span class="n">v10</span><span class="o">.</span><span class="n">values</span> <span class="o">*</span> <span class="n">MS_TO_KNOTS</span>
            <span class="n">wind_speed</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">u10</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">v10</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

            <span class="n">tempf_ds</span> <span class="o">=</span> <span class="n">downsample_data</span><span class="p">(</span><span class="n">tempf</span><span class="p">,</span> <span class="n">step</span><span class="p">)</span>
            <span class="n">dptf_ds</span> <span class="o">=</span> <span class="n">downsample_data</span><span class="p">(</span><span class="n">dptf_smooth</span><span class="p">,</span> <span class="n">step</span><span class="p">)</span>
            <span class="n">u10_ds</span> <span class="o">=</span> <span class="n">downsample_data</span><span class="p">(</span><span class="n">u10</span><span class="p">,</span> <span class="n">step</span><span class="p">)</span>
            <span class="n">v10_ds</span> <span class="o">=</span> <span class="n">downsample_data</span><span class="p">(</span><span class="n">v10</span><span class="p">,</span> <span class="n">step</span><span class="p">)</span>

            <span class="n">lon_ds</span> <span class="o">=</span> <span class="n">lon_ds</span><span class="p">[::</span><span class="n">step</span><span class="p">,</span> <span class="p">::</span><span class="n">step</span><span class="p">]</span>
            <span class="n">lat_ds</span> <span class="o">=</span> <span class="n">lat_ds</span><span class="p">[::</span><span class="n">step</span><span class="p">,</span> <span class="p">::</span><span class="n">step</span><span class="p">]</span>
            
            <span class="k">if</span> <span class="s1">&#39;TE&#39;</span> <span class="ow">in</span> <span class="n">keyword</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Processing TE data&quot;</span><span class="p">)</span>
                <span class="n">file_pres</span> <span class="o">=</span> <span class="n">file_paths</span><span class="p">[</span><span class="s1">&#39;pres&#39;</span><span class="p">][</span><span class="n">fxx</span><span class="p">]</span>
                <span class="n">ds_pres</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">file_pres</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s1">&#39;cfgrib&#39;</span><span class="p">,</span> <span class="n">filter_by_keys</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;stepType&#39;</span><span class="p">:</span> <span class="s1">&#39;instant&#39;</span><span class="p">})</span>
                <span class="n">pres</span> <span class="o">=</span> <span class="n">ds_pres</span><span class="o">.</span><span class="n">mslma</span><span class="o">.</span><span class="n">values</span> <span class="o">/</span> <span class="mi">100</span>  <span class="c1"># Convert to hPa</span>
                <span class="n">pres_ds</span> <span class="o">=</span> <span class="n">downsample_data</span><span class="p">(</span><span class="n">pres</span><span class="p">,</span> <span class="n">step</span><span class="p">)</span>

                <span class="c1"># Adjust units for equivalent_potential_temperature calculation</span>
                <span class="n">tempf_units</span> <span class="o">=</span> <span class="p">(</span><span class="n">tempf_ds</span> <span class="o">-</span> <span class="mi">32</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">5</span><span class="o">/</span><span class="mi">9</span><span class="p">)</span> <span class="o">+</span> <span class="mf">273.15</span>  <span class="c1"># Convert from Fahrenheit to Kelvin</span>
                <span class="n">dptf_units</span> <span class="o">=</span> <span class="p">(</span><span class="n">dptf_ds</span> <span class="o">-</span> <span class="mi">32</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">5</span><span class="o">/</span><span class="mi">9</span><span class="p">)</span> <span class="o">+</span> <span class="mf">273.15</span>  <span class="c1"># Convert from Fahrenheit to Kelvin</span>
                
                <span class="n">theta_e</span> <span class="o">=</span> <span class="n">equivalent_potential_temperature</span><span class="p">(</span><span class="n">pres_ds</span> <span class="o">*</span> <span class="n">units</span><span class="o">.</span><span class="n">hPa</span><span class="p">,</span> <span class="n">tempf_units</span> <span class="o">*</span> <span class="n">units</span><span class="o">.</span><span class="n">kelvin</span><span class="p">,</span> <span class="n">dptf_units</span> <span class="o">*</span> <span class="n">units</span><span class="o">.</span><span class="n">kelvin</span><span class="p">)</span>
                <span class="n">theta_e_ds</span> <span class="o">=</span> <span class="n">theta_e</span><span class="o">.</span><span class="n">magnitude</span>
        <span class="k">if</span> <span class="s1">&#39;LCL&#39;</span> <span class="ow">in</span> <span class="n">keyword</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Processing LCL for fxx=</span><span class="si">{</span><span class="n">fxx</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">file_temp</span> <span class="o">=</span> <span class="n">file_paths</span><span class="p">[</span><span class="s1">&#39;temp&#39;</span><span class="p">][</span><span class="n">fxx</span><span class="p">]</span>
            <span class="n">ds_temp</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">file_temp</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s1">&#39;cfgrib&#39;</span><span class="p">,</span> <span class="n">filter_by_keys</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;stepType&#39;</span><span class="p">:</span> <span class="s1">&#39;instant&#39;</span><span class="p">})</span>
            <span class="n">temp</span> <span class="o">=</span> <span class="n">ds_temp</span><span class="o">.</span><span class="n">t2m</span><span class="o">.</span><span class="n">values</span> 
            <span class="n">tempC</span> <span class="o">=</span> <span class="p">(</span><span class="n">temp</span> <span class="o">-</span> <span class="mf">273.15</span><span class="p">)</span>  <span class="c1"># Convert from Kelvin to Celsius</span>
            <span class="n">lon</span> <span class="o">=</span> <span class="n">ds_temp</span><span class="o">.</span><span class="n">longitude</span><span class="o">.</span><span class="n">values</span>  <span class="c1"># No downsampling for temperature</span>
            <span class="n">lat</span> <span class="o">=</span> <span class="n">ds_temp</span><span class="o">.</span><span class="n">latitude</span><span class="o">.</span><span class="n">values</span>

            <span class="n">file_dpt</span> <span class="o">=</span> <span class="n">file_paths</span><span class="p">[</span><span class="s1">&#39;dpt&#39;</span><span class="p">][</span><span class="n">fxx</span><span class="p">]</span>
            <span class="n">ds_dpt</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">file_dpt</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s1">&#39;cfgrib&#39;</span><span class="p">,</span> <span class="n">filter_by_keys</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;stepType&#39;</span><span class="p">:</span> <span class="s1">&#39;instant&#39;</span><span class="p">})</span>
            <span class="n">dpt</span> <span class="o">=</span> <span class="n">ds_dpt</span><span class="o">.</span><span class="n">d2m</span><span class="o">.</span><span class="n">values</span>
            <span class="n">dptC</span> <span class="o">=</span> <span class="p">(</span><span class="n">dpt</span> <span class="o">-</span> <span class="mf">273.15</span><span class="p">)</span>  <span class="c1"># Convert from Kelvin to Celsius</span>
            
            <span class="n">file_pres</span> <span class="o">=</span> <span class="n">file_paths</span><span class="p">[</span><span class="s1">&#39;pres&#39;</span><span class="p">][</span><span class="n">fxx</span><span class="p">]</span>
            <span class="n">ds_pres</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">file_pres</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s1">&#39;cfgrib&#39;</span><span class="p">,</span> <span class="n">filter_by_keys</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;stepType&#39;</span><span class="p">:</span> <span class="s1">&#39;instant&#39;</span><span class="p">})</span>
            <span class="n">pres</span> <span class="o">=</span> <span class="n">ds_pres</span><span class="o">.</span><span class="n">sp</span><span class="o">.</span><span class="n">values</span> <span class="o">/</span> <span class="mi">100</span>  <span class="c1"># Convert to hP</span>
            
            <span class="n">lclc</span> <span class="o">=</span> <span class="n">lcl</span><span class="p">(</span><span class="n">pres</span> <span class="o">*</span> <span class="n">units</span><span class="o">.</span><span class="n">hPa</span><span class="p">,</span> <span class="n">tempC</span> <span class="o">*</span> <span class="n">units</span><span class="o">.</span><span class="n">degC</span><span class="p">,</span> <span class="n">dptC</span> <span class="o">*</span> <span class="n">units</span><span class="o">.</span><span class="n">degC</span><span class="p">)</span>
            <span class="n">lcl_pressure</span> <span class="o">=</span> <span class="n">lclc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">magnitude</span>
            <span class="n">lcl_height</span> <span class="o">=</span> <span class="n">pressure_to_height</span><span class="p">(</span><span class="n">lcl_pressure</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Maximum lcl height for </span><span class="si">{</span><span class="n">fxx</span><span class="si">}</span><span class="s1"> is </span><span class="si">{</span><span class="n">lcl_height</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;lcl_ds shape: </span><span class="si">{</span><span class="n">lcl_height</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">, lon_ds shape: </span><span class="si">{</span><span class="n">lon</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">, lat_ds shape: </span><span class="si">{</span><span class="n">lat</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            
        <span class="k">if</span> <span class="s1">&#39;gh&#39;</span> <span class="ow">in</span> <span class="n">keyword</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Processing gh data&quot;</span><span class="p">)</span>
            <span class="n">file_gh</span> <span class="o">=</span> <span class="n">file_paths</span><span class="p">[</span><span class="s1">&#39;gh&#39;</span><span class="p">][</span><span class="n">fxx</span><span class="p">]</span>
            <span class="n">ds_gh</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">file_gh</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s1">&#39;cfgrib&#39;</span><span class="p">,</span> <span class="n">filter_by_keys</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;stepType&#39;</span><span class="p">:</span> <span class="s1">&#39;instant&#39;</span><span class="p">})</span>
            <span class="n">gh</span> <span class="o">=</span> <span class="n">ds_gh</span><span class="o">.</span><span class="n">gh</span><span class="o">.</span><span class="n">values</span>
            <span class="n">lon</span> <span class="o">=</span> <span class="n">ds_gh</span><span class="o">.</span><span class="n">longitude</span><span class="o">.</span><span class="n">values</span>
            <span class="n">lat</span> <span class="o">=</span> <span class="n">ds_gh</span><span class="o">.</span><span class="n">latitude</span><span class="o">.</span><span class="n">values</span>

            <span class="n">file_wind</span> <span class="o">=</span> <span class="n">file_paths</span><span class="p">[</span><span class="s1">&#39;winds&#39;</span><span class="p">][</span><span class="n">fxx</span><span class="p">]</span>
            <span class="n">file_wind2</span> <span class="o">=</span> <span class="n">file_paths</span><span class="p">[</span><span class="s1">&#39;winds2&#39;</span><span class="p">][</span><span class="n">fxx</span><span class="p">]</span>
            <span class="n">ds_winds</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">file_wind</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s1">&#39;cfgrib&#39;</span><span class="p">,</span> <span class="n">filter_by_keys</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;stepType&#39;</span><span class="p">:</span> <span class="s1">&#39;instant&#39;</span><span class="p">})</span>
            <span class="n">ds_winds2</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">file_wind2</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s1">&#39;cfgrib&#39;</span><span class="p">,</span> <span class="n">filter_by_keys</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;stepType&#39;</span><span class="p">:</span> <span class="s1">&#39;instant&#39;</span><span class="p">})</span>
            <span class="n">u</span> <span class="o">=</span> <span class="n">ds_winds</span><span class="o">.</span><span class="n">u</span><span class="o">.</span><span class="n">values</span> <span class="o">*</span> <span class="n">MS_TO_KNOTS</span>
            <span class="n">v</span> <span class="o">=</span> <span class="n">ds_winds2</span><span class="o">.</span><span class="n">v</span><span class="o">.</span><span class="n">values</span> <span class="o">*</span> <span class="n">MS_TO_KNOTS</span>

            <span class="n">lon_ds</span> <span class="o">=</span> <span class="n">downsample_data</span><span class="p">(</span><span class="n">lon</span><span class="p">,</span> <span class="n">step</span><span class="p">)</span>
            <span class="n">lat_ds</span> <span class="o">=</span> <span class="n">downsample_data</span><span class="p">(</span><span class="n">lat</span><span class="p">,</span> <span class="n">step</span><span class="p">)</span>
            <span class="n">gh_ds</span> <span class="o">=</span> <span class="n">downsample_data</span><span class="p">(</span><span class="n">gh</span><span class="p">,</span> <span class="n">step</span><span class="p">)</span>
            <span class="n">u_ds</span> <span class="o">=</span> <span class="n">downsample_data</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">step</span><span class="p">)</span>
            <span class="n">v_ds</span> <span class="o">=</span> <span class="n">downsample_data</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">step</span><span class="p">)</span>

            <span class="n">wind_speed_500</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">u_ds</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">v_ds</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">wind_speed_500_50kt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">wind_speed_500</span> <span class="o">&gt;=</span> <span class="mi">25</span><span class="p">,</span> <span class="n">wind_speed_500</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="s1">&#39;STP&#39;</span> <span class="ow">in</span> <span class="n">keyword</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Processing STP for fxx=</span><span class="si">{</span><span class="n">fxx</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="n">file_temp</span> <span class="o">=</span> <span class="n">file_paths</span><span class="p">[</span><span class="s1">&#39;temp&#39;</span><span class="p">][</span><span class="n">fxx</span><span class="p">]</span>
            <span class="n">ds_temp</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">file_temp</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s1">&#39;cfgrib&#39;</span><span class="p">,</span> <span class="n">filter_by_keys</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;stepType&#39;</span><span class="p">:</span> <span class="s1">&#39;instant&#39;</span><span class="p">})</span>
            <span class="n">temp</span> <span class="o">=</span> <span class="n">ds_temp</span><span class="o">.</span><span class="n">t2m</span><span class="o">.</span><span class="n">values</span> 
            <span class="n">tempC</span> <span class="o">=</span> <span class="p">(</span><span class="n">temp</span> <span class="o">-</span> <span class="mf">273.15</span><span class="p">)</span>  <span class="c1"># Convert from Kelvin to Celsius</span>
            <span class="n">lon</span> <span class="o">=</span> <span class="n">ds_temp</span><span class="o">.</span><span class="n">longitude</span><span class="o">.</span><span class="n">values</span>
            <span class="n">lat</span> <span class="o">=</span> <span class="n">ds_temp</span><span class="o">.</span><span class="n">latitude</span><span class="o">.</span><span class="n">values</span>

            <span class="n">file_dpt</span> <span class="o">=</span> <span class="n">file_paths</span><span class="p">[</span><span class="s1">&#39;dpt&#39;</span><span class="p">][</span><span class="n">fxx</span><span class="p">]</span>
            <span class="n">ds_dpt</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">file_dpt</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s1">&#39;cfgrib&#39;</span><span class="p">,</span> <span class="n">filter_by_keys</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;stepType&#39;</span><span class="p">:</span> <span class="s1">&#39;instant&#39;</span><span class="p">})</span>
            <span class="n">dpt</span> <span class="o">=</span> <span class="n">ds_dpt</span><span class="o">.</span><span class="n">d2m</span><span class="o">.</span><span class="n">values</span>
            <span class="n">dptC</span> <span class="o">=</span> <span class="p">(</span><span class="n">dpt</span> <span class="o">-</span> <span class="mf">273.15</span><span class="p">)</span>  <span class="c1"># Convert from Kelvin to Celsius</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">file_pres</span> <span class="o">=</span> <span class="n">file_paths</span><span class="p">[</span><span class="s1">&#39;pres&#39;</span><span class="p">][</span><span class="n">fxx</span><span class="p">]</span>
                <span class="n">ds_pres</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">file_pres</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s1">&#39;cfgrib&#39;</span><span class="p">,</span> <span class="n">filter_by_keys</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;stepType&#39;</span><span class="p">:</span> <span class="s1">&#39;instant&#39;</span><span class="p">})</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Variables in ds_pres for fxx=</span><span class="si">{</span><span class="n">fxx</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="n">ds_pres</span><span class="o">.</span><span class="n">variables</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="s1">&#39;sp&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ds_pres</span><span class="o">.</span><span class="n">variables</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;pres variable not found in dataset for fxx=</span><span class="si">{</span><span class="n">fxx</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">pres</span> <span class="o">=</span> <span class="n">ds_pres</span><span class="o">.</span><span class="n">sp</span><span class="o">.</span><span class="n">values</span> <span class="o">/</span> <span class="mi">100</span> <span class="c1"># Convert to hPa</span>
            <span class="k">except</span> <span class="p">(</span><span class="ne">IndexError</span><span class="p">,</span> <span class="ne">KeyError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span>

            <span class="n">lclc</span> <span class="o">=</span> <span class="n">lcl</span><span class="p">(</span><span class="n">pres</span> <span class="o">*</span> <span class="n">units</span><span class="o">.</span><span class="n">hPa</span><span class="p">,</span> <span class="n">tempC</span> <span class="o">*</span> <span class="n">units</span><span class="o">.</span><span class="n">degC</span><span class="p">,</span> <span class="n">dptC</span> <span class="o">*</span> <span class="n">units</span><span class="o">.</span><span class="n">degC</span><span class="p">)</span>
            <span class="n">lcl_pressure</span> <span class="o">=</span> <span class="n">lclc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">magnitude</span>
            <span class="n">lcl_height</span> <span class="o">=</span> <span class="n">pressure_to_height</span><span class="p">(</span><span class="n">lcl_pressure</span><span class="p">)</span>

            <span class="n">file_hlcy</span> <span class="o">=</span> <span class="n">file_paths</span><span class="p">[</span><span class="s1">&#39;hlcy&#39;</span><span class="p">][</span><span class="n">fxx</span><span class="p">]</span>
            <span class="n">ds_hlcy</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">file_hlcy</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s1">&#39;cfgrib&#39;</span><span class="p">,</span> <span class="n">filter_by_keys</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;stepType&#39;</span><span class="p">:</span> <span class="s1">&#39;instant&#39;</span><span class="p">})</span>
            <span class="n">hlcy</span> <span class="o">=</span> <span class="n">ds_hlcy</span><span class="o">.</span><span class="n">hlcy</span><span class="o">.</span><span class="n">values</span>

            <span class="n">file_cape</span> <span class="o">=</span> <span class="n">file_paths</span><span class="p">[</span><span class="s1">&#39;cape&#39;</span><span class="p">][</span><span class="n">fxx</span><span class="p">]</span>
            <span class="n">ds_cape</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">file_cape</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s1">&#39;cfgrib&#39;</span><span class="p">,</span> <span class="n">filter_by_keys</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;stepType&#39;</span><span class="p">:</span> <span class="s1">&#39;instant&#39;</span><span class="p">})</span>
            <span class="n">cape</span> <span class="o">=</span> <span class="n">ds_cape</span><span class="o">.</span><span class="n">cape</span><span class="o">.</span><span class="n">values</span>

            <span class="n">file_vvcsh</span> <span class="o">=</span> <span class="n">file_paths</span><span class="p">[</span><span class="s1">&#39;vvcsh&#39;</span><span class="p">][</span><span class="n">fxx</span><span class="p">]</span>
            <span class="n">ds_vvcsh</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">file_vvcsh</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s1">&#39;cfgrib&#39;</span><span class="p">,</span> <span class="n">filter_by_keys</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;stepType&#39;</span><span class="p">:</span> <span class="s1">&#39;instant&#39;</span><span class="p">})</span>
            <span class="n">vvcsh</span> <span class="o">=</span> <span class="n">ds_vvcsh</span><span class="o">.</span><span class="n">vvcsh</span><span class="o">.</span><span class="n">values</span><span class="o">*</span><span class="n">MS_TO_KNOTS</span>

            <span class="n">file_vucsh</span> <span class="o">=</span> <span class="n">file_paths</span><span class="p">[</span><span class="s1">&#39;vucsh&#39;</span><span class="p">][</span><span class="n">fxx</span><span class="p">]</span>
            <span class="n">ds_vucsh</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">file_vucsh</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s1">&#39;cfgrib&#39;</span><span class="p">,</span> <span class="n">filter_by_keys</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;stepType&#39;</span><span class="p">:</span> <span class="s1">&#39;instant&#39;</span><span class="p">})</span>
            <span class="n">vucsh</span> <span class="o">=</span> <span class="n">ds_vucsh</span><span class="o">.</span><span class="n">vucsh</span><span class="o">.</span><span class="n">values</span> <span class="o">*</span> <span class="n">MS_TO_KNOTS</span>

            <span class="n">wind_shear</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">vucsh</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">vvcsh</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> 

            <span class="n">stp</span> <span class="o">=</span> <span class="n">significant_tornado</span><span class="p">(</span><span class="n">cape</span> <span class="o">*</span> <span class="n">units</span><span class="p">(</span><span class="s1">&#39;J/kg&#39;</span><span class="p">),</span> <span class="n">lcl_height</span> <span class="o">*</span> <span class="n">units</span><span class="o">.</span><span class="n">meter</span><span class="p">,</span> <span class="n">hlcy</span> <span class="o">*</span> <span class="n">units</span><span class="p">(</span><span class="s1">&#39;m^2/s^2&#39;</span><span class="p">),</span> <span class="n">wind_shear</span><span class="o">*</span><span class="n">units</span><span class="o">.</span><span class="n">knot</span><span class="p">)</span><span class="o">.</span><span class="n">to_base_units</span><span class="p">()</span>
            <span class="n">stp</span> <span class="o">=</span> <span class="n">stp</span><span class="o">.</span><span class="n">magnitude</span>

            <span class="n">lon_ds</span> <span class="o">=</span> <span class="n">downsample_data</span><span class="p">(</span><span class="n">lon</span><span class="p">,</span> <span class="n">step</span><span class="p">)</span>
            <span class="n">lat_ds</span> <span class="o">=</span> <span class="n">downsample_data</span><span class="p">(</span><span class="n">lat</span><span class="p">,</span> <span class="n">step</span><span class="p">)</span>
            <span class="n">stp_ds</span> <span class="o">=</span> <span class="n">downsample_data</span><span class="p">(</span><span class="n">stp</span><span class="p">,</span> <span class="n">step</span><span class="p">)</span>

            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;stp_ds shape: </span><span class="si">{</span><span class="n">stp_ds</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">, lon_ds shape: </span><span class="si">{</span><span class="n">lon_ds</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">, lat_ds shape: </span><span class="si">{</span><span class="n">lat_ds</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;THESHR&#39;</span> <span class="ow">in</span> <span class="n">keyword</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Processing THESHR for fxx=</span><span class="si">{</span><span class="n">fxx</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="n">file_temp</span> <span class="o">=</span> <span class="n">file_paths</span><span class="p">[</span><span class="s1">&#39;temp&#39;</span><span class="p">][</span><span class="n">fxx</span><span class="p">]</span>
            <span class="n">ds_temp</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">file_temp</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s1">&#39;cfgrib&#39;</span><span class="p">,</span> <span class="n">filter_by_keys</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;stepType&#39;</span><span class="p">:</span> <span class="s1">&#39;instant&#39;</span><span class="p">})</span>
            <span class="n">temp</span> <span class="o">=</span> <span class="n">ds_temp</span><span class="o">.</span><span class="n">t2m</span><span class="o">.</span><span class="n">values</span>   <span class="c1"># Convert from Kelvin to Celsius</span>
            <span class="n">lon</span> <span class="o">=</span> <span class="n">ds_temp</span><span class="o">.</span><span class="n">longitude</span><span class="o">.</span><span class="n">values</span>
            <span class="n">lat</span> <span class="o">=</span> <span class="n">ds_temp</span><span class="o">.</span><span class="n">latitude</span><span class="o">.</span><span class="n">values</span>

            <span class="n">file_dpt</span> <span class="o">=</span> <span class="n">file_paths</span><span class="p">[</span><span class="s1">&#39;dpt&#39;</span><span class="p">][</span><span class="n">fxx</span><span class="p">]</span>
            <span class="n">ds_dpt</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">file_dpt</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s1">&#39;cfgrib&#39;</span><span class="p">,</span> <span class="n">filter_by_keys</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;stepType&#39;</span><span class="p">:</span> <span class="s1">&#39;instant&#39;</span><span class="p">})</span>
            <span class="n">dpt</span> <span class="o">=</span> <span class="n">ds_dpt</span><span class="o">.</span><span class="n">d2m</span><span class="o">.</span><span class="n">values</span>  <span class="c1"># Convert from Kelvin to Celsius</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">file_pres</span> <span class="o">=</span> <span class="n">file_paths</span><span class="p">[</span><span class="s1">&#39;pres&#39;</span><span class="p">][</span><span class="n">fxx</span><span class="p">]</span>
                <span class="n">ds_pres</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">file_pres</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s1">&#39;cfgrib&#39;</span><span class="p">,</span> <span class="n">filter_by_keys</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;stepType&#39;</span><span class="p">:</span> <span class="s1">&#39;instant&#39;</span><span class="p">})</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Variables in ds_pres for fxx=</span><span class="si">{</span><span class="n">fxx</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="n">ds_pres</span><span class="o">.</span><span class="n">variables</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="s1">&#39;mslma&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ds_pres</span><span class="o">.</span><span class="n">variables</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;pres variable not found in dataset for fxx=</span><span class="si">{</span><span class="n">fxx</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">pres</span> <span class="o">=</span> <span class="n">ds_pres</span><span class="o">.</span><span class="n">mslma</span><span class="o">.</span><span class="n">values</span> <span class="o">/</span> <span class="mi">100</span> <span class="c1"># Convert to hPa</span>
            <span class="k">except</span> <span class="p">(</span><span class="ne">IndexError</span><span class="p">,</span> <span class="ne">KeyError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span>
            <span class="n">file_vvcsh</span> <span class="o">=</span> <span class="n">file_paths</span><span class="p">[</span><span class="s1">&#39;vvcsh&#39;</span><span class="p">][</span><span class="n">fxx</span><span class="p">]</span>
            <span class="n">ds_vvcsh</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">file_vvcsh</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s1">&#39;cfgrib&#39;</span><span class="p">,</span> <span class="n">filter_by_keys</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;stepType&#39;</span><span class="p">:</span> <span class="s1">&#39;instant&#39;</span><span class="p">})</span>
            <span class="n">vvcsh</span> <span class="o">=</span> <span class="n">ds_vvcsh</span><span class="o">.</span><span class="n">vvcsh</span><span class="o">.</span><span class="n">values</span><span class="o">*</span><span class="n">MS_TO_KNOTS</span>

            <span class="n">file_vucsh</span> <span class="o">=</span> <span class="n">file_paths</span><span class="p">[</span><span class="s1">&#39;vucsh&#39;</span><span class="p">][</span><span class="n">fxx</span><span class="p">]</span>
            <span class="n">ds_vucsh</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">file_vucsh</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s1">&#39;cfgrib&#39;</span><span class="p">,</span> <span class="n">filter_by_keys</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;stepType&#39;</span><span class="p">:</span> <span class="s1">&#39;instant&#39;</span><span class="p">})</span>
            <span class="n">vucsh</span> <span class="o">=</span> <span class="n">ds_vucsh</span><span class="o">.</span><span class="n">vucsh</span><span class="o">.</span><span class="n">values</span> <span class="o">*</span> <span class="n">MS_TO_KNOTS</span>
            
            <span class="n">temp_ds</span> <span class="o">=</span> <span class="n">downsample_data</span><span class="p">(</span><span class="n">temp</span><span class="p">,</span> <span class="n">step</span><span class="p">)</span>
            <span class="n">dpt_ds</span> <span class="o">=</span> <span class="n">downsample_data</span><span class="p">(</span><span class="n">dpt</span><span class="p">,</span> <span class="n">step</span><span class="p">)</span>
            <span class="n">pres_ds</span> <span class="o">=</span> <span class="n">downsample_data</span><span class="p">(</span><span class="n">pres</span><span class="p">,</span> <span class="n">step</span><span class="p">)</span>
            <span class="n">ushr_ds</span> <span class="o">=</span> <span class="n">downsample_data</span><span class="p">(</span><span class="n">vucsh</span><span class="p">,</span> <span class="n">step</span><span class="p">)</span>
            <span class="n">vshr_ds</span> <span class="o">=</span> <span class="n">downsample_data</span><span class="p">(</span><span class="n">vvcsh</span><span class="p">,</span> <span class="n">step</span><span class="p">)</span>

            <span class="n">lon_ds</span> <span class="o">=</span> <span class="n">downsample_data</span><span class="p">(</span><span class="n">lon</span><span class="p">,</span> <span class="n">step</span><span class="p">)</span>
            <span class="n">lat_ds</span> <span class="o">=</span> <span class="n">downsample_data</span><span class="p">(</span><span class="n">lat</span><span class="p">,</span> <span class="n">step</span><span class="p">)</span>

            <span class="n">wind_shear</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">ushr_ds</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">vshr_ds</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> 
            <span class="n">theta_e</span> <span class="o">=</span> <span class="n">equivalent_potential_temperature</span><span class="p">(</span><span class="n">pres_ds</span> <span class="o">*</span> <span class="n">units</span><span class="o">.</span><span class="n">hPa</span><span class="p">,</span> <span class="n">temp_ds</span> <span class="o">*</span> <span class="n">units</span><span class="o">.</span><span class="n">kelvin</span><span class="p">,</span> <span class="n">dpt_ds</span> <span class="o">*</span> <span class="n">units</span><span class="o">.</span><span class="n">kelvin</span><span class="p">)</span>
            <span class="n">theta_e_ds</span> <span class="o">=</span> <span class="n">theta_e</span><span class="o">.</span><span class="n">magnitude</span>
            


        <span class="k">if</span> <span class="s1">&#39;CAPE&#39;</span> <span class="ow">in</span> <span class="n">keyword</span> <span class="ow">or</span> <span class="p">(</span><span class="s1">&#39;cape&#39;</span> <span class="ow">in</span> <span class="n">file_paths</span> <span class="ow">and</span> <span class="n">file_paths</span><span class="p">[</span><span class="s1">&#39;cape&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="s1">&#39;STP&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">keyword</span><span class="p">):</span>
            <span class="k">assert</span> <span class="n">cape_ds</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;cape_ds is None&quot;</span>
        <span class="k">if</span> <span class="s1">&#39;UVV&#39;</span> <span class="ow">in</span> <span class="n">keyword</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">uvv_ds</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;uvv_ds is None&quot;</span>
        <span class="k">if</span> <span class="s1">&#39;ABSV&#39;</span> <span class="ow">in</span> <span class="n">keyword</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">absv_ds</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;absv_ds is None&quot;</span>
        <span class="k">if</span> <span class="s1">&#39;QPF&#39;</span> <span class="ow">in</span> <span class="n">keyword</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">tp_ds</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;tp_ds is None&quot;</span>
        <span class="k">if</span> <span class="s1">&#39;uphl&#39;</span> <span class="ow">in</span> <span class="n">keyword</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">uphl_ds</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;uphl_ds is None&quot;</span>
        <span class="k">if</span> <span class="s1">&#39;sfc&#39;</span> <span class="ow">in</span> <span class="n">keyword</span> <span class="ow">or</span> <span class="s1">&#39;TE&#39;</span> <span class="ow">in</span> <span class="n">keyword</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">tempf_ds</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;tempf_ds is None&quot;</span>
            <span class="k">assert</span> <span class="n">dptf_ds</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;dptf_ds is None&quot;</span>
            <span class="k">assert</span> <span class="n">u10_ds</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;u10_ds is None&quot;</span>
            <span class="k">assert</span> <span class="n">v10_ds</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;v10_ds is not None&quot;</span>
            <span class="k">if</span> <span class="s1">&#39;TE&#39;</span> <span class="ow">in</span> <span class="n">keyword</span><span class="p">:</span>
                <span class="k">assert</span> <span class="n">theta_e_ds</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;theta_e_ds is None&quot;</span>
        <span class="k">if</span> <span class="s1">&#39;LCL&#39;</span> <span class="ow">in</span> <span class="n">keyword</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">tempC</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;tempC_ds is None&quot;</span>
            <span class="k">assert</span> <span class="n">dptC</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;dptf_ds is None&quot;</span>
            <span class="k">assert</span> <span class="n">lcl_height</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;lcl_ds is None&quot;</span>
        <span class="k">if</span> <span class="s1">&#39;gh&#39;</span> <span class="ow">in</span> <span class="n">keyword</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">gh_ds</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;gh_ds is None&quot;</span>
            <span class="k">assert</span> <span class="n">u_ds</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;u_ds is None&quot;</span>
            <span class="k">assert</span> <span class="n">v_ds</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;v_ds is not None&quot;</span>
        <span class="k">if</span> <span class="s1">&#39;STP&#39;</span> <span class="ow">in</span> <span class="n">keyword</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">stp_ds</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;stp_ds is None&quot;</span>

        <span class="k">if</span> <span class="s1">&#39;UVV&#39;</span> <span class="ow">in</span> <span class="n">keyword</span><span class="p">:</span>
            <span class="n">custom_cmap_uvv</span> <span class="o">=</span> <span class="n">create_custom_colormap</span><span class="p">()</span>

            <span class="n">norm_uvv</span> <span class="o">=</span> <span class="n">TwoSlopeNorm</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="n">uvv_min</span><span class="p">,</span> <span class="n">vcenter</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">uvv_max</span><span class="p">)</span>

            <span class="n">contourf_uvv</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span>
                <span class="n">lon_ds</span><span class="p">,</span>
                <span class="n">lat_ds</span><span class="p">,</span>
                <span class="n">uvv_ds</span><span class="p">,</span>
                <span class="n">levels</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">uvv_min</span><span class="p">,</span> <span class="n">uvv_max</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span>
                <span class="n">cmap</span><span class="o">=</span><span class="n">custom_cmap_uvv</span><span class="p">,</span>
                <span class="n">norm</span><span class="o">=</span><span class="n">norm_uvv</span><span class="p">,</span>
                <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span>
                <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span>
            <span class="p">)</span>
            <span class="n">cbar_uvv</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">contourf_uvv</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;horizontal&#39;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">shrink</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
            <span class="n">cbar_uvv</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;UVV (Pa/s)&#39;</span><span class="p">)</span>

            <span class="n">contour_gh</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span>
                <span class="n">lon_ds</span><span class="p">,</span>
                <span class="n">lat_ds</span><span class="p">,</span>
                <span class="n">gh_ds</span><span class="p">,</span>
                <span class="n">levels</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">gh_ds</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">gh_ds</span><span class="p">),</span> <span class="mi">30</span><span class="p">),</span>
                <span class="n">colors</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span>
                <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span>
                <span class="n">linewidths</span><span class="o">=</span><span class="mi">1</span>
            <span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">clabel</span><span class="p">(</span><span class="n">contour_gh</span><span class="p">,</span> <span class="n">inline</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%1.0f</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="k">elif</span> <span class="s1">&#39;CAPE&#39;</span> <span class="ow">in</span> <span class="n">keyword</span> <span class="ow">and</span> <span class="s1">&#39;STP&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">keyword</span> <span class="ow">or</span> <span class="p">(</span><span class="s1">&#39;cape&#39;</span> <span class="ow">in</span> <span class="n">file_paths</span> <span class="ow">and</span> <span class="n">file_paths</span><span class="p">[</span><span class="s1">&#39;cape&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="s1">&#39;STP&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">keyword</span><span class="p">):</span>
            <span class="n">contourf_cape</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span>
                <span class="n">lon_ds</span><span class="p">,</span>
                <span class="n">lat_ds</span><span class="p">,</span>
                <span class="n">cape_ds</span><span class="p">,</span>
                <span class="n">levels</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">cape_min</span><span class="p">,</span> <span class="n">cape_max</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span>
                <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;viridis&#39;</span><span class="p">,</span>
                <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span>
                <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span>
            <span class="p">)</span>
            <span class="n">cbar_cape</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">contourf_cape</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;horizontal&#39;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">shrink</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
            <span class="n">cbar_cape</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;CAPE (J/kg)&#39;</span><span class="p">)</span>
            <span class="n">cbar_cape</span><span class="o">.</span><span class="n">locator</span> <span class="o">=</span> <span class="n">MaxNLocator</span><span class="p">(</span><span class="n">integer</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">cbar_cape</span><span class="o">.</span><span class="n">update_ticks</span><span class="p">()</span>

            <span class="k">if</span> <span class="s1">&#39;cin&#39;</span> <span class="ow">in</span> <span class="n">file_paths</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">file_paths</span><span class="p">[</span><span class="s1">&#39;cin&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="s1">&#39;hlcy&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">keyword</span><span class="p">:</span>
                <span class="n">contour_cin</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span>
                    <span class="n">lon_ds</span><span class="p">,</span>
                    <span class="n">lat_ds</span><span class="p">,</span>
                    <span class="n">cin_ds</span><span class="p">,</span>
                    <span class="n">levels</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">cin_min</span><span class="p">,</span> <span class="n">cin_max</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span>
                    <span class="n">colors</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span>
                    <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span>
                    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.75</span><span class="p">,</span>
                    <span class="n">linestyles</span><span class="o">=</span><span class="s1">&#39;--&#39;</span>
                <span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">clabel</span><span class="p">(</span><span class="n">contour_cin</span><span class="p">,</span> <span class="n">inline</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%1.0f</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="s1">&#39;helcy3&#39;</span> <span class="ow">in</span> <span class="n">keyword</span><span class="p">:</span>
            <span class="n">contour_helcy</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span>
                <span class="n">lon_ds</span><span class="p">,</span>
                <span class="n">lat_ds</span><span class="p">,</span>
                <span class="n">hlcy_ds</span><span class="p">,</span>
                <span class="n">levels</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">1200</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span>
                <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;viridis&#39;</span><span class="p">,</span>
                <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span>
                <span class="n">alpha</span><span class="o">=</span><span class="mf">0.75</span>
            <span class="p">)</span>
            <span class="n">cbar_helcy</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">contour_helcy</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;horizontal&#39;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">shrink</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
            <span class="n">cbar_helcy</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;0-3 km SRH (m/s)&#39;</span><span class="p">)</span>
            
        <span class="k">if</span> <span class="s1">&#39;PBL&#39;</span> <span class="ow">in</span> <span class="n">keyword</span><span class="p">:</span>
            <span class="n">contour_pbl</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span>
                <span class="n">lon_ds</span><span class="p">,</span>
                <span class="n">lat_ds</span><span class="p">,</span>
                <span class="n">pbl_ds</span><span class="p">,</span>
                <span class="n">levels</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">pbl_min</span><span class="p">,</span> <span class="n">pbl_max</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span>
                <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;viridis&#39;</span><span class="p">,</span>
                <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span>
                <span class="n">alpha</span><span class="o">=</span><span class="mf">0.75</span>
            <span class="p">)</span>
            <span class="n">cbar_pbl</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">contour_pbl</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;horizontal&#39;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">shrink</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
            <span class="n">cbar_pbl</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Height of Planetary Boundary Layer (m)&#39;</span><span class="p">)</span>
            <span class="n">cbar_pbl</span><span class="o">.</span><span class="n">locator</span> <span class="o">=</span> <span class="n">MaxNLocator</span><span class="p">(</span><span class="n">integer</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">cbar_pbl</span><span class="o">.</span><span class="n">update_ticks</span><span class="p">()</span>
        
        <span class="k">if</span> <span class="s1">&#39;LCL&#39;</span> <span class="ow">in</span> <span class="n">keyword</span><span class="p">:</span>
            <span class="n">contour_LCL</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span>
                <span class="n">lon</span><span class="p">,</span>
                <span class="n">lat</span><span class="p">,</span>
                <span class="n">lcl_height</span><span class="p">,</span>
                <span class="n">levels</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">lcl_min</span><span class="p">,</span> <span class="n">lcl_max</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span>
                <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;viridis&#39;</span><span class="p">,</span>
                <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span>
                <span class="n">alpha</span><span class="o">=</span><span class="mf">0.75</span>
            <span class="p">)</span>
            <span class="n">cbar_lcl</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">contour_LCL</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;horizontal&#39;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">shrink</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
            <span class="n">cbar_lcl</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Surface Based LCL Height (m)&#39;</span><span class="p">)</span>
            <span class="n">cbar_lcl</span><span class="o">.</span><span class="n">locator</span> <span class="o">=</span> <span class="n">MaxNLocator</span><span class="p">(</span><span class="n">integer</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">cbar_lcl</span><span class="o">.</span><span class="n">update_ticks</span><span class="p">()</span>
            
        <span class="k">if</span> <span class="s1">&#39;LI&#39;</span> <span class="ow">in</span> <span class="n">keyword</span><span class="p">:</span>
            <span class="n">contour_lift</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span>
                <span class="n">lon_ds</span><span class="p">,</span>
                <span class="n">lat_ds</span><span class="p">,</span>
                <span class="n">lift_ds</span><span class="p">,</span>
                <span class="n">levels</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">15</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span>
                <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;viridis&#39;</span><span class="p">,</span>
                <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span>
                <span class="n">alpha</span><span class="o">=</span><span class="mf">0.75</span>
            <span class="p">)</span>
            <span class="n">cbar_lift</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">contour_lift</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;horizontal&#39;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">shrink</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
            <span class="n">cbar_lift</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Surface-Based Lifted Index (C)&#39;</span><span class="p">)</span>
            <span class="n">cbar_lift</span><span class="o">.</span><span class="n">locator</span> <span class="o">=</span> <span class="n">MaxNLocator</span><span class="p">(</span><span class="n">integer</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">cbar_lift</span><span class="o">.</span><span class="n">update_ticks</span><span class="p">()</span>
        
        <span class="k">if</span> <span class="s1">&#39;hlcy&#39;</span> <span class="ow">in</span> <span class="n">keyword</span><span class="p">:</span>
            <span class="n">contour_hlcy</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span>
                <span class="n">lon_ds</span><span class="p">,</span>
                <span class="n">lat_ds</span><span class="p">,</span>
                <span class="n">hlcy_ds</span><span class="p">,</span>
                <span class="n">levels</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">4000</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span>
                <span class="n">colors</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span>
                <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span>
                <span class="n">alpha</span><span class="o">=</span><span class="mf">0.75</span><span class="p">,</span>
                <span class="n">linestyles</span><span class="o">=</span><span class="s1">&#39;-&#39;</span>
            <span class="p">)</span>
            
            <span class="n">ax</span><span class="o">.</span><span class="n">clabel</span><span class="p">(</span><span class="n">contour_hlcy</span><span class="p">,</span> <span class="n">inline</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%1.0f</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="s1">&#39;ABSV&#39;</span> <span class="ow">in</span> <span class="n">keyword</span><span class="p">:</span>
            <span class="n">custom_cmap</span> <span class="o">=</span> <span class="n">create_custom_colormap</span><span class="p">()</span>

            <span class="n">norm</span> <span class="o">=</span> <span class="n">TwoSlopeNorm</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="n">absv_min</span><span class="p">,</span> <span class="n">vcenter</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">absv_max</span><span class="p">)</span>

            <span class="n">contourf_absv</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span>
                <span class="n">lon_ds</span><span class="p">,</span>
                <span class="n">lat_ds</span><span class="p">,</span>
                <span class="n">absv_ds</span><span class="p">,</span>
                <span class="n">levels</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">absv_min</span><span class="p">,</span> <span class="n">absv_max</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span>
                <span class="n">cmap</span><span class="o">=</span><span class="n">custom_cmap</span><span class="p">,</span>
                <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">,</span>
                <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span>
                <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span>
            <span class="p">)</span>
            <span class="n">cbar_absv</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">contourf_absv</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;horizontal&#39;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">shrink</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
            <span class="n">cbar_absv</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;ABSV (s)&#39;</span><span class="p">)</span>

            <span class="n">contour_gh</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span>
                <span class="n">lon_ds</span><span class="p">,</span>
                <span class="n">lat_ds</span><span class="p">,</span>
                <span class="n">gh_ds</span><span class="p">,</span>
                <span class="n">levels</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">gh_ds</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">gh_ds</span><span class="p">),</span> <span class="mi">30</span><span class="p">),</span>
                <span class="n">colors</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span>
                <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span>
                <span class="n">linewidths</span><span class="o">=</span><span class="mi">1</span>
            <span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">clabel</span><span class="p">(</span><span class="n">contour_gh</span><span class="p">,</span> <span class="n">inline</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%1.0f</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="s1">&#39;QPF&#39;</span> <span class="ow">in</span> <span class="n">keyword</span><span class="p">:</span>
            <span class="n">contourf_tp</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span>
                <span class="n">lon_ds</span><span class="p">,</span>
                <span class="n">lat_ds</span><span class="p">,</span>
                <span class="n">tp_ds</span><span class="p">,</span>
                <span class="n">levels</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">tp_max</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span>
                <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;pyart_NWSRef&#39;</span><span class="p">,</span>
                <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span>
                <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span>
            <span class="p">)</span>
            <span class="n">cbar_tp</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">contourf_tp</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;horizontal&#39;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">shrink</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
            <span class="n">cbar_tp</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s1">&#39;Total Precipitation (inches)&#39;</span><span class="p">)</span>
            <span class="n">cbar_tp</span><span class="o">.</span><span class="n">locator</span> <span class="o">=</span> <span class="n">MaxNLocator</span><span class="p">(</span><span class="n">integer</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">cbar_tp</span><span class="o">.</span><span class="n">update_ticks</span><span class="p">()</span>
        
        <span class="k">if</span> <span class="s1">&#39;uphl&#39;</span> <span class="ow">in</span> <span class="n">keyword</span><span class="p">:</span>
            <span class="n">gray_cmap</span> <span class="o">=</span> <span class="n">create_gray_colormap</span><span class="p">()</span>

            <span class="n">contour_refc</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span>
                <span class="n">lon_ds</span><span class="p">,</span>
                <span class="n">lat_ds</span><span class="p">,</span>
                <span class="n">refc_ds</span><span class="p">,</span>
                <span class="n">levels</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span>
                <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;pyart_NWSRef&#39;</span><span class="p">,</span>
                <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">()</span>
            <span class="p">)</span>
            <span class="n">cbar_contour_refc</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">contour_refc</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;horizontal&#39;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">shrink</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
            <span class="n">cbar_contour_refc</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s1">&#39;Simulated Reflectivity (dBZ)&#39;</span><span class="p">)</span>
            <span class="n">cbar_contour_refc</span><span class="o">.</span><span class="n">set_ticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>  <span class="c1"># Set ticks to be in intervals of 10</span>

            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">uphl_ds</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">75</span><span class="p">:</span>
                <span class="n">contourf_uphl</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span>
                    <span class="n">lon_ds</span><span class="p">,</span>
                    <span class="n">lat_ds</span><span class="p">,</span>
                    <span class="n">uphl_ds</span><span class="p">,</span>
                    <span class="n">levels</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">75</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">uphl_ds</span><span class="p">),</span> <span class="mi">100</span><span class="p">),</span>
                    <span class="n">cmap</span><span class="o">=</span><span class="n">gray_cmap</span><span class="p">,</span>
                    <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span>
                    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span>
                <span class="p">)</span>
        
        <span class="k">if</span> <span class="s1">&#39;sfc&#39;</span> <span class="ow">in</span> <span class="n">keyword</span><span class="p">:</span>
            <span class="n">tempf_min</span> <span class="o">=</span> <span class="n">round_to_multiple</span><span class="p">(</span><span class="n">tempf_min</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
            <span class="n">tempf_max</span> <span class="o">=</span> <span class="n">round_to_multiple</span><span class="p">(</span><span class="n">tempf_max</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>

            <span class="n">contourf_temp</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span>
                <span class="n">lon_ds</span><span class="p">,</span>
                <span class="n">lat_ds</span><span class="p">,</span>
                <span class="n">tempf_ds</span><span class="p">,</span>
                <span class="n">levels</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">tempf_min</span><span class="p">,</span> <span class="n">tempf_max</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>  <span class="c1"># 1-degree increments</span>
                <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;coolwarm&#39;</span><span class="p">,</span>
                <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span>
                <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span>
            <span class="p">)</span>
            <span class="n">cbar_temp</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">contourf_temp</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;horizontal&#39;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">shrink</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
            <span class="n">cbar_temp</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s1">&#39;2 m Temperature (F)&#39;</span><span class="p">)</span>
            <span class="n">cbar_temp</span><span class="o">.</span><span class="n">set_ticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">tempf_min</span><span class="p">,</span> <span class="n">tempf_max</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>  <span class="c1"># Set colorbar ticks to multiples of 10</span>
            <span class="n">cbar_temp</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">tick</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">tick</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">tempf_min</span><span class="p">,</span> <span class="n">tempf_max</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">)])</span>  <span class="c1"># Remove decimals</span>

            <span class="n">contour_dpt</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span>
                <span class="n">lon_ds</span><span class="p">,</span>
                <span class="n">lat_ds</span><span class="p">,</span>
                <span class="n">dptf_ds</span><span class="p">,</span>
                <span class="n">levels</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">dptf_ds</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">dptf_ds</span><span class="p">),</span> <span class="mi">20</span><span class="p">),</span>
                <span class="n">colors</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">,</span>
                <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span>
                <span class="n">alpha</span><span class="o">=</span><span class="mf">0.75</span>
            <span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">clabel</span><span class="p">(</span><span class="n">contour_dpt</span><span class="p">,</span> <span class="n">inline</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%1.0f</span><span class="s1">&#39;</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lon_ds</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">lat_ds</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">lon_barbs</span> <span class="o">=</span> <span class="n">downsample_data</span><span class="p">(</span><span class="n">lon_ds</span><span class="p">,</span> <span class="n">barb_step</span><span class="p">)</span>
                <span class="n">lat_barbs</span> <span class="o">=</span> <span class="n">downsample_data</span><span class="p">(</span><span class="n">lat_ds</span><span class="p">,</span> <span class="n">barb_step</span><span class="p">)</span>
                <span class="n">u10_barbs</span> <span class="o">=</span> <span class="n">downsample_data</span><span class="p">(</span><span class="n">u10_ds</span><span class="p">,</span> <span class="n">barb_step</span><span class="p">)</span>
                <span class="n">v10_barbs</span> <span class="o">=</span> <span class="n">downsample_data</span><span class="p">(</span><span class="n">v10_ds</span><span class="p">,</span> <span class="n">barb_step</span><span class="p">)</span>
                
                <span class="n">ax</span><span class="o">.</span><span class="n">barbs</span><span class="p">(</span>
                    <span class="n">lon_barbs</span><span class="p">,</span>
                    <span class="n">lat_barbs</span><span class="p">,</span>
                    <span class="n">u10_barbs</span><span class="p">,</span>
                    <span class="n">v10_barbs</span><span class="p">,</span>
                    <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span>
                    <span class="n">length</span><span class="o">=</span><span class="mi">6</span>
                <span class="p">)</span>

        <span class="k">if</span> <span class="s1">&#39;TE&#39;</span> <span class="ow">in</span> <span class="n">keyword</span><span class="p">:</span>

            <span class="n">contourf_theta_e</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span>
                <span class="n">lon_ds</span><span class="p">,</span>
                <span class="n">lat_ds</span><span class="p">,</span>
                <span class="n">theta_e_ds</span><span class="p">,</span>
                <span class="n">levels</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">theta_e_min</span><span class="p">,</span> <span class="n">theta_e_max</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span>  <span class="c1"># Static range with 1-degree increments</span>
                <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;viridis&#39;</span><span class="p">,</span>
                <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span>
                <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span>
            <span class="p">)</span>
            <span class="n">cbar_theta_e</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">contourf_theta_e</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;horizontal&#39;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">shrink</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
            <span class="n">cbar_theta_e</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s1">&#39;Theta E (K)&#39;</span><span class="p">)</span>
            <span class="n">cbar_theta_e</span><span class="o">.</span><span class="n">locator</span> <span class="o">=</span> <span class="n">MaxNLocator</span><span class="p">(</span><span class="n">integer</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">cbar_theta_e</span><span class="o">.</span><span class="n">update_ticks</span><span class="p">()</span>
              <span class="c1"># Remove decimals</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lon_ds</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">lat_ds</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">lon_barbs</span> <span class="o">=</span> <span class="n">downsample_data</span><span class="p">(</span><span class="n">lon_ds</span><span class="p">,</span> <span class="n">barb_step</span><span class="p">)</span>
                <span class="n">lat_barbs</span> <span class="o">=</span> <span class="n">downsample_data</span><span class="p">(</span><span class="n">lat_ds</span><span class="p">,</span> <span class="n">barb_step</span><span class="p">)</span>
                <span class="n">u10_barbs</span> <span class="o">=</span> <span class="n">downsample_data</span><span class="p">(</span><span class="n">u10_ds</span><span class="p">,</span> <span class="n">barb_step</span><span class="p">)</span>
                <span class="n">v10_barbs</span> <span class="o">=</span> <span class="n">downsample_data</span><span class="p">(</span><span class="n">v10_ds</span><span class="p">,</span> <span class="n">barb_step</span><span class="p">)</span>
                
                <span class="n">ax</span><span class="o">.</span><span class="n">barbs</span><span class="p">(</span>
                    <span class="n">lon_barbs</span><span class="p">,</span>
                    <span class="n">lat_barbs</span><span class="p">,</span>
                    <span class="n">u10_barbs</span><span class="p">,</span>
                    <span class="n">v10_barbs</span><span class="p">,</span>
                    <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span>
                    <span class="n">length</span><span class="o">=</span><span class="mi">6</span>
                <span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;THESHR&#39;</span> <span class="ow">in</span> <span class="n">keyword</span><span class="p">:</span>

            <span class="n">contourf_theta_e</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span>
                <span class="n">lon_ds</span><span class="p">,</span>
                <span class="n">lat_ds</span><span class="p">,</span>
                <span class="n">theta_e_ds</span><span class="p">,</span>
                <span class="n">levels</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">theta_e_min</span><span class="p">,</span> <span class="n">theta_e_max</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span>  <span class="c1"># Static range with 1-degree increments</span>
                <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;viridis&#39;</span><span class="p">,</span>
                <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span>
                <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span>
            <span class="p">)</span>
            <span class="n">cbar_theta_e</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">contourf_theta_e</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;horizontal&#39;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">shrink</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
            <span class="n">cbar_theta_e</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s1">&#39;Theta E (K)&#39;</span><span class="p">)</span>
            <span class="n">cbar_theta_e</span><span class="o">.</span><span class="n">locator</span> <span class="o">=</span> <span class="n">MaxNLocator</span><span class="p">(</span><span class="n">integer</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">cbar_theta_e</span><span class="o">.</span><span class="n">update_ticks</span><span class="p">()</span>
              <span class="c1"># Remove decimals</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lon_ds</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">lat_ds</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">lon_barbs</span> <span class="o">=</span> <span class="n">downsample_data</span><span class="p">(</span><span class="n">lon_ds</span><span class="p">,</span> <span class="n">barb_step</span><span class="p">)</span>
                <span class="n">lat_barbs</span> <span class="o">=</span> <span class="n">downsample_data</span><span class="p">(</span><span class="n">lat_ds</span><span class="p">,</span> <span class="n">barb_step</span><span class="p">)</span>
                <span class="n">ushr_barbs</span> <span class="o">=</span> <span class="n">downsample_data</span><span class="p">(</span><span class="n">ushr_ds</span><span class="p">,</span> <span class="n">barb_step</span><span class="p">)</span>
                <span class="n">vshr_barbs</span> <span class="o">=</span> <span class="n">downsample_data</span><span class="p">(</span><span class="n">vshr_ds</span><span class="p">,</span> <span class="n">barb_step</span><span class="p">)</span>
                
                <span class="n">ax</span><span class="o">.</span><span class="n">barbs</span><span class="p">(</span>
                    <span class="n">lon_barbs</span><span class="p">,</span>
                    <span class="n">lat_barbs</span><span class="p">,</span>
                    <span class="n">ushr_barbs</span><span class="p">,</span>
                    <span class="n">vshr_barbs</span><span class="p">,</span>
                    <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span>
                    <span class="n">length</span><span class="o">=</span><span class="mi">6</span>
                <span class="p">)</span>

        <span class="k">if</span> <span class="s1">&#39;gh&#39;</span> <span class="ow">in</span> <span class="n">keyword</span><span class="p">:</span>
            <span class="n">contour_gh</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span>
                <span class="n">lon_ds</span><span class="p">,</span>
                <span class="n">lat_ds</span><span class="p">,</span>
                <span class="n">gh_ds</span><span class="p">,</span>
                <span class="n">levels</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">gh_ds</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">gh_ds</span><span class="p">),</span> <span class="mi">30</span><span class="p">),</span>
                <span class="n">colors</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span>
                <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span>
                <span class="n">linewidths</span><span class="o">=</span><span class="mi">1</span>
            <span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">clabel</span><span class="p">(</span><span class="n">contour_gh</span><span class="p">,</span> <span class="n">inline</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%1.0f</span><span class="s1">&#39;</span><span class="p">)</span>

            <span class="n">start_level</span> <span class="o">=</span> <span class="mi">50</span> <span class="k">if</span> <span class="n">level</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;250&quot;</span><span class="p">,</span> <span class="s2">&quot;300&quot;</span><span class="p">,</span> <span class="s2">&quot;500&quot;</span><span class="p">]</span> <span class="k">else</span> <span class="mi">25</span>

            <span class="c1"># Generate the contour plot for wind speeds with the appropriate levels</span>
            <span class="n">contourf_wind_speed_50kt</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span>
                <span class="n">lon_ds</span><span class="p">,</span>
                <span class="n">lat_ds</span><span class="p">,</span>
                <span class="n">wind_speed_500_50kt</span><span class="p">,</span>
                <span class="n">levels</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">start_level</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span>
                <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;viridis&#39;</span><span class="p">,</span>
                <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span>
                <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span>
            <span class="p">)</span>
            
            <span class="n">cbar</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">contourf_wind_speed_50kt</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;horizontal&#39;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">shrink</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
            <span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s1">&#39;Wind Speed (knots)&#39;</span><span class="p">)</span>
            <span class="n">cbar</span><span class="o">.</span><span class="n">locator</span> <span class="o">=</span> <span class="n">MaxNLocator</span><span class="p">(</span><span class="n">integer</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">cbar</span><span class="o">.</span><span class="n">update_ticks</span><span class="p">()</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lon_ds</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">lat_ds</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">lon_barbs</span> <span class="o">=</span> <span class="n">downsample_data</span><span class="p">(</span><span class="n">lon_ds</span><span class="p">,</span> <span class="n">barb_step</span><span class="p">)</span>
                <span class="n">lat_barbs</span> <span class="o">=</span> <span class="n">downsample_data</span><span class="p">(</span><span class="n">lat_ds</span><span class="p">,</span> <span class="n">barb_step</span><span class="p">)</span>
                <span class="n">u_barbs</span> <span class="o">=</span> <span class="n">downsample_data</span><span class="p">(</span><span class="n">u_ds</span><span class="p">,</span> <span class="n">barb_step</span><span class="p">)</span>
                <span class="n">v_barbs</span> <span class="o">=</span> <span class="n">downsample_data</span><span class="p">(</span><span class="n">v_ds</span><span class="p">,</span> <span class="n">barb_step</span><span class="p">)</span>
                
                <span class="n">ax</span><span class="o">.</span><span class="n">barbs</span><span class="p">(</span>
                    <span class="n">lon_barbs</span><span class="p">,</span>
                    <span class="n">lat_barbs</span><span class="p">,</span>
                    <span class="n">u_barbs</span><span class="p">,</span>
                    <span class="n">v_barbs</span><span class="p">,</span>
                    <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span>
                    <span class="n">length</span><span class="o">=</span><span class="mi">6</span>
                <span class="p">)</span>

        <span class="k">if</span> <span class="s1">&#39;STP&#39;</span> <span class="ow">in</span> <span class="n">keyword</span><span class="p">:</span>
            <span class="n">contour_stp</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span>
                <span class="n">lon</span><span class="p">,</span>
                <span class="n">lat</span><span class="p">,</span>
                <span class="n">stp</span><span class="p">,</span>
                <span class="n">levels</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span>
                <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;plasma&#39;</span><span class="p">,</span>
                <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span>
                <span class="n">alpha</span><span class="o">=</span><span class="mf">0.75</span>
            <span class="p">)</span>
            <span class="n">cbar_stp</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">contour_stp</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;horizontal&#39;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">shrink</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
            <span class="n">cbar_stp</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Significant Tornado Parameter&#39;</span><span class="p">)</span>
            <span class="n">cbar_stp</span><span class="o">.</span><span class="n">locator</span> <span class="o">=</span> <span class="n">MaxNLocator</span><span class="p">(</span><span class="n">integer</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">cbar_stp</span><span class="o">.</span><span class="n">update_ticks</span><span class="p">()</span>

        <span class="n">valid_time</span> <span class="o">=</span> <span class="n">init_time</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">timedelta64</span><span class="p">(</span><span class="n">fxx</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">)</span>
        <span class="n">valid_time_str</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">datetime_as_string</span><span class="p">(</span><span class="n">valid_time</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;h&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">)</span>

        <span class="n">title_text</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">model_name</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s2">: &quot;</span>
        <span class="k">if</span> <span class="s1">&#39;UVV&#39;</span> <span class="ow">in</span> <span class="n">keyword</span><span class="p">:</span>
            <span class="n">title_text</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">keyword</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2"> mb GH and UVV (fill)&quot;</span>
        <span class="k">elif</span> <span class="s1">&#39;CAPE&#39;</span> <span class="ow">in</span> <span class="n">keyword</span><span class="p">:</span>
            <span class="n">title_text</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">keyword</span><span class="si">}</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="p">(</span><span class="s2">&quot; and CIN (cnt)&quot;</span> <span class="k">if</span> <span class="s1">&#39;hlcy&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">keyword</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="s1">&#39;hlcy&#39;</span> <span class="ow">in</span> <span class="n">keyword</span><span class="p">:</span>
            <span class="n">cape_type</span> <span class="o">=</span> <span class="n">keyword</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
            <span class="n">title_text</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;HLCY (contours) and </span><span class="si">{</span><span class="n">cape_type</span><span class="si">}</span><span class="s2">CAPE&quot;</span>
        <span class="k">elif</span> <span class="s1">&#39;helcy3&#39;</span> <span class="ow">in</span> <span class="n">keyword</span><span class="p">:</span>
            <span class="n">title_text</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;0-3 KM Storm Relative Helicity&quot;</span>
        <span class="k">elif</span> <span class="s1">&#39;ABSV&#39;</span> <span class="ow">in</span> <span class="n">keyword</span><span class="p">:</span>
            <span class="n">title_text</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">keyword</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2"> mb GH and ABSV (fill)&quot;</span>
        <span class="k">elif</span> <span class="s1">&#39;QPF&#39;</span> <span class="ow">in</span> <span class="n">keyword</span><span class="p">:</span>
            <span class="n">title_text</span> <span class="o">+=</span> <span class="s2">&quot;Total Precipitation Accumulation&quot;</span>
        <span class="k">elif</span> <span class="s1">&#39;uphl&#39;</span> <span class="ow">in</span> <span class="n">keyword</span><span class="p">:</span>
            <span class="n">title_text</span> <span class="o">+=</span> <span class="s2">&quot;Updraft Helicity (75 m/s) and Composite Reflectivity&quot;</span>
        <span class="k">elif</span> <span class="s1">&#39;sfc&#39;</span> <span class="ow">in</span> <span class="n">keyword</span><span class="p">:</span>
            <span class="n">title_text</span> <span class="o">+=</span> <span class="s2">&quot;2 m Temp, 2 m Dew Point, 10 m Winds (barbs)&quot;</span>
        <span class="k">elif</span> <span class="s1">&#39;TE&#39;</span> <span class="ow">in</span> <span class="n">keyword</span><span class="p">:</span>
            <span class="n">title_text</span> <span class="o">+=</span> <span class="s2">&quot;Theta E (fill), 10 m Winds (barbs)&quot;</span>
        <span class="k">elif</span> <span class="s1">&#39;gh&#39;</span> <span class="ow">in</span> <span class="n">keyword</span><span class="p">:</span>
            <span class="n">title_text</span> <span class="o">+=</span> <span class="s2">&quot;500 mb Geopotential Height and Winds (barbs)&quot;</span>
        <span class="k">elif</span> <span class="s1">&#39;LI&#39;</span> <span class="ow">in</span> <span class="n">keyword</span><span class="p">:</span>
            <span class="n">title_text</span> <span class="o">+=</span> <span class="s2">&quot;Surface Based Lifted Index (C)&quot;</span>
        <span class="k">elif</span> <span class="s1">&#39;LCL&#39;</span> <span class="ow">in</span> <span class="n">keyword</span><span class="p">:</span>
            <span class="n">title_text</span> <span class="o">+=</span> <span class="s2">&quot;Surface Based LCL Height (m)&quot;</span>
        <span class="k">elif</span> <span class="s1">&#39;STP&#39;</span> <span class="ow">in</span> <span class="n">keyword</span><span class="p">:</span>
            <span class="n">title_text</span> <span class="o">+=</span> <span class="s2">&quot;Significant Tornado Parameter&quot;</span>
        <span class="k">elif</span> <span class="s1">&#39;PBL&#39;</span> <span class="ow">in</span> <span class="n">keyword</span><span class="p">:</span>
            <span class="n">title_text</span> <span class="o">+=</span> <span class="s2">&quot;PBL Height&quot;</span>
        <span class="k">elif</span> <span class="s1">&#39;THESHR&#39;</span> <span class="ow">in</span> <span class="n">keyword</span><span class="p">:</span>
            <span class="n">title_text</span> <span class="o">+=</span> <span class="s2">&quot;Theta-E (k) and 0-6 km shear&quot;</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1.02</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Valid: </span><span class="si">{</span><span class="n">valid_time_str</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">1.02</span><span class="p">,</span> <span class="n">title_text</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">)</span>

        <span class="n">frame_filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;frame_</span><span class="si">{</span><span class="n">fxx</span><span class="si">:</span><span class="s2">02d</span><span class="si">}</span><span class="s2">.png&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">frame_filename</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">frame_filename</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error creating frame for fxx=</span><span class="si">{</span><span class="n">fxx</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>

<span class="k">def</span> <span class="nf">force_delete_file</span><span class="p">(</span><span class="n">file_path</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">PermissionError</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;PermissionError: </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2"> is in use by another process.&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;File </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2"> does not exist.&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">create_animated_gif</span><span class="p">(</span><span class="n">date</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">max_fxx</span><span class="p">,</span> <span class="n">output_gif</span><span class="p">,</span> <span class="n">region</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">keyword</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">output_dir</span> <span class="o">=</span> <span class="s2">&quot;frames&quot;</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">init_time</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">datetime64</span><span class="p">(</span><span class="n">date</span><span class="p">)</span>
    <span class="n">model_name</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>

    <span class="n">extent</span> <span class="o">=</span> <span class="n">regions</span><span class="p">[</span><span class="n">region</span><span class="p">]</span>
    <span class="n">file_paths</span> <span class="o">=</span> <span class="n">download_files</span><span class="p">(</span><span class="n">date</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">max_fxx</span><span class="p">,</span> <span class="n">extent</span><span class="p">,</span> <span class="n">keyword</span><span class="p">,</span> <span class="n">level</span><span class="p">)</span>

    <span class="n">cape_min</span><span class="p">,</span> <span class="n">cape_max</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;inf&#39;</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;-inf&#39;</span><span class="p">)</span>
    <span class="n">cin_min</span><span class="p">,</span> <span class="n">cin_max</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;inf&#39;</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;-inf&#39;</span><span class="p">)</span>
    <span class="n">uvv_min</span><span class="p">,</span> <span class="n">uvv_max</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;inf&#39;</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;-inf&#39;</span><span class="p">)</span>
    <span class="n">absv_min</span><span class="p">,</span> <span class="n">absv_max</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;inf&#39;</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;-inf&#39;</span><span class="p">)</span>
    <span class="n">tp_min</span><span class="p">,</span> <span class="n">tp_max</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;inf&#39;</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;-inf&#39;</span><span class="p">)</span>
    <span class="n">tempf_min</span><span class="p">,</span> <span class="n">tempf_max</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;inf&#39;</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;-inf&#39;</span><span class="p">)</span>
    <span class="n">theta_e_min</span><span class="p">,</span> <span class="n">theta_e_max</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;inf&#39;</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;-inf&#39;</span><span class="p">)</span>
    <span class="n">wind_speed_max</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;-inf&#39;</span><span class="p">)</span>
    <span class="n">hlcy_min</span><span class="p">,</span> <span class="n">hlcy_max</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;inf&#39;</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;-inf&#39;</span><span class="p">)</span>
    <span class="n">lift_min</span><span class="p">,</span> <span class="n">lift_max</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;inf&#39;</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;-inf&#39;</span><span class="p">)</span>
    <span class="n">lcl_min</span><span class="p">,</span> <span class="n">lcl_max</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;inf&#39;</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;-inf&#39;</span><span class="p">)</span>
    <span class="n">pbl_min</span><span class="p">,</span> <span class="n">pbl_max</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;inf&#39;</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;-inf&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="s1">&#39;CAPE&#39;</span> <span class="ow">in</span> <span class="n">keyword</span> <span class="ow">or</span> <span class="p">(</span><span class="s1">&#39;cape&#39;</span> <span class="ow">in</span> <span class="n">file_paths</span> <span class="ow">and</span> <span class="n">file_paths</span><span class="p">[</span><span class="s1">&#39;cape&#39;</span><span class="p">]):</span>
        <span class="k">for</span> <span class="n">file_cape</span> <span class="ow">in</span> <span class="n">file_paths</span><span class="p">[</span><span class="s1">&#39;cape&#39;</span><span class="p">]:</span>
            <span class="n">ds_cape</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">file_cape</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s1">&#39;cfgrib&#39;</span><span class="p">,</span> <span class="n">filter_by_keys</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;stepType&#39;</span><span class="p">:</span> <span class="s1">&#39;instant&#39;</span><span class="p">})</span>
            <span class="k">if</span> <span class="s1">&#39;cape&#39;</span> <span class="ow">in</span> <span class="n">ds_cape</span><span class="p">:</span>
                <span class="n">cape</span> <span class="o">=</span> <span class="n">ds_cape</span><span class="o">.</span><span class="n">cape</span><span class="o">.</span><span class="n">values</span>  <span class="c1"># Assuming &#39;cape&#39; is the variable name for CAPE</span>
                <span class="n">cape_min</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">cape_min</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">cape</span><span class="p">))</span>
                <span class="n">cape_max</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">cape_max</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">cape</span><span class="p">))</span>

        <span class="n">cape_min</span> <span class="o">-=</span> <span class="mi">100</span>
        <span class="n">cape_max</span> <span class="o">+=</span> <span class="mi">100</span>

        <span class="k">if</span> <span class="s1">&#39;cin&#39;</span> <span class="ow">in</span> <span class="n">file_paths</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">file_paths</span><span class="p">[</span><span class="s1">&#39;cin&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="s1">&#39;hlcy&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">keyword</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">file_cin</span> <span class="ow">in</span> <span class="n">file_paths</span><span class="p">[</span><span class="s1">&#39;cin&#39;</span><span class="p">]:</span>
                <span class="n">ds_cin</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">file_cin</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s1">&#39;cfgrib&#39;</span><span class="p">,</span> <span class="n">filter_by_keys</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;stepType&#39;</span><span class="p">:</span> <span class="s1">&#39;instant&#39;</span><span class="p">})</span>
                <span class="n">cin</span> <span class="o">=</span> <span class="n">ds_cin</span><span class="o">.</span><span class="n">cin</span><span class="o">.</span><span class="n">values</span>
                <span class="n">cin_min</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">cin_min</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">cin</span><span class="p">))</span>
                <span class="n">cin_max</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">cin_max</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">cin</span><span class="p">))</span>

            <span class="n">cin_min</span> <span class="o">-=</span> <span class="mi">0</span>
            <span class="n">cin_max</span> <span class="o">+=</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="s1">&#39;helcy3&#39;</span> <span class="ow">in</span> <span class="n">keyword</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">file_hlcy</span> <span class="ow">in</span> <span class="n">file_paths</span><span class="p">[</span><span class="s1">&#39;helcy&#39;</span><span class="p">]:</span>
            <span class="n">ds_hlcy</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">file_hlcy</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s1">&#39;cfgrib&#39;</span><span class="p">,</span> <span class="n">filter_by_keys</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;stepType&#39;</span><span class="p">:</span> <span class="s1">&#39;instant&#39;</span><span class="p">})</span>
            <span class="n">hlcy</span> <span class="o">=</span> <span class="n">ds_hlcy</span><span class="p">[</span><span class="s1">&#39;hlcy&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
            <span class="n">hlcy_min</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">hlcy_min</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">hlcy</span><span class="p">))</span>
            <span class="n">hlcy_max</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">hlcy_max</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">hlcy</span><span class="p">))</span>

        <span class="n">hlcy_min</span> <span class="o">-=</span> <span class="mi">0</span>
        <span class="n">hlcy_max</span> <span class="o">+=</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="s1">&#39;LI&#39;</span> <span class="ow">in</span> <span class="n">keyword</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">file_lif</span> <span class="ow">in</span> <span class="n">file_paths</span><span class="p">[</span><span class="s1">&#39;lift&#39;</span><span class="p">]:</span>
            <span class="n">ds_lift</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">file_lif</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s1">&#39;cfgrib&#39;</span><span class="p">,</span> <span class="n">filter_by_keys</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;stepType&#39;</span><span class="p">:</span> <span class="s1">&#39;instant&#39;</span><span class="p">})</span>
            <span class="n">lift</span> <span class="o">=</span> <span class="n">ds_lift</span><span class="p">[</span><span class="s1">&#39;lftx&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
            <span class="n">lift_min</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">lift_min</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">lift</span><span class="p">))</span>
            <span class="n">lift_max</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">lift_max</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">lift</span><span class="p">))</span>

        <span class="n">lift_min</span> <span class="o">-=</span> <span class="mi">0</span>
        <span class="n">lift_max</span> <span class="o">+=</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="s1">&#39;PBL&#39;</span> <span class="ow">in</span> <span class="n">keyword</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">file_pbl</span> <span class="ow">in</span> <span class="n">file_paths</span><span class="p">[</span><span class="s1">&#39;pbl&#39;</span><span class="p">]:</span>
            <span class="n">ds_pbl</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">file_pbl</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s1">&#39;cfgrib&#39;</span><span class="p">,</span> <span class="n">filter_by_keys</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;stepType&#39;</span><span class="p">:</span> <span class="s1">&#39;instant&#39;</span><span class="p">})</span>
            <span class="n">pbl</span> <span class="o">=</span> <span class="n">ds_pbl</span><span class="p">[</span><span class="s1">&#39;blh&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
            <span class="n">pbl_min</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">pbl_min</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">pbl</span><span class="p">))</span>
            <span class="n">pbl_max</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">pbl_max</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">pbl</span><span class="p">))</span>

        <span class="n">pbl_min</span> <span class="o">-=</span> <span class="mi">0</span>
        <span class="n">pbl_max</span> <span class="o">+=</span> <span class="mi">0</span>


    <span class="k">if</span> <span class="s1">&#39;UVV&#39;</span> <span class="ow">in</span> <span class="n">keyword</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">file_uvv</span> <span class="ow">in</span> <span class="n">file_paths</span><span class="p">[</span><span class="s1">&#39;uvv&#39;</span><span class="p">]:</span>
            <span class="n">ds_uvv</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">file_uvv</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s1">&#39;cfgrib&#39;</span><span class="p">,</span> <span class="n">filter_by_keys</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;stepType&#39;</span><span class="p">:</span> <span class="s1">&#39;instant&#39;</span><span class="p">})</span>
            <span class="n">uvv</span> <span class="o">=</span> <span class="n">ds_uvv</span><span class="o">.</span><span class="n">w</span><span class="o">.</span><span class="n">values</span>
            <span class="n">uvv_min</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">uvv_min</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">uvv</span><span class="p">))</span>
            <span class="n">uvv_max</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">uvv_max</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">uvv</span><span class="p">))</span>
        <span class="n">uvv_min</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="n">uvv_max</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">if</span> <span class="s1">&#39;ABSV&#39;</span> <span class="ow">in</span> <span class="n">keyword</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">file_absv</span> <span class="ow">in</span> <span class="n">file_paths</span><span class="p">[</span><span class="s1">&#39;absv&#39;</span><span class="p">]:</span>
            <span class="n">ds_absv</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">file_absv</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s1">&#39;cfgrib&#39;</span><span class="p">,</span> <span class="n">filter_by_keys</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;stepType&#39;</span><span class="p">:</span> <span class="s1">&#39;instant&#39;</span><span class="p">})</span>
            <span class="n">absv</span> <span class="o">=</span> <span class="n">ds_absv</span><span class="o">.</span><span class="n">absv</span><span class="o">.</span><span class="n">values</span>
            <span class="n">absv_min</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">absv_min</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">absv</span><span class="p">))</span>
            <span class="n">absv_max</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">absv_max</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">absv</span><span class="p">))</span>
        <span class="n">absv_min</span> <span class="o">-=</span> <span class="mf">0.0001</span>
        <span class="n">absv_max</span> <span class="o">+=</span> <span class="mf">0.0001</span>

    <span class="k">if</span> <span class="s1">&#39;QPF&#39;</span> <span class="ow">in</span> <span class="n">keyword</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">file_precip</span> <span class="ow">in</span> <span class="n">file_paths</span><span class="p">[</span><span class="s1">&#39;precip&#39;</span><span class="p">]:</span>
            <span class="n">ds_precip</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">file_precip</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s1">&#39;cfgrib&#39;</span><span class="p">,</span> <span class="n">filter_by_keys</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;stepType&#39;</span><span class="p">:</span> <span class="s1">&#39;accum&#39;</span><span class="p">})</span>
            <span class="n">tp</span> <span class="o">=</span> <span class="n">ds_precip</span><span class="o">.</span><span class="n">tp</span><span class="o">.</span><span class="n">values</span> <span class="o">*</span> <span class="mf">0.0393701</span>  <span class="c1"># Convert from kg m**-2 to inches</span>
            <span class="n">tp_min</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">tp_min</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">tp</span><span class="p">))</span>
            <span class="n">tp_max</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">tp_max</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">tp</span><span class="p">))</span>
        <span class="n">tp_min</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="n">tp_max</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="s1">&#39;sfc&#39;</span> <span class="ow">in</span> <span class="n">keyword</span> <span class="ow">or</span> <span class="s1">&#39;TE&#39;</span> <span class="ow">in</span> <span class="n">keyword</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">file_temp</span> <span class="ow">in</span> <span class="n">file_paths</span><span class="p">[</span><span class="s1">&#39;temp&#39;</span><span class="p">]:</span>
            <span class="n">ds_temp</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">file_temp</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s1">&#39;cfgrib&#39;</span><span class="p">,</span> <span class="n">filter_by_keys</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;stepType&#39;</span><span class="p">:</span> <span class="s1">&#39;instant&#39;</span><span class="p">})</span>
            <span class="n">temp</span> <span class="o">=</span> <span class="n">ds_temp</span><span class="o">.</span><span class="n">t2m</span><span class="o">.</span><span class="n">values</span>
            <span class="n">tempf</span> <span class="o">=</span> <span class="p">(</span><span class="n">temp</span> <span class="o">-</span> <span class="mf">273.15</span><span class="p">)</span> <span class="o">*</span> <span class="mi">9</span><span class="o">/</span><span class="mi">5</span> <span class="o">+</span> <span class="mi">32</span>  <span class="c1"># Convert from Kelvin to Fahrenheit</span>
            <span class="n">tempf_min</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">tempf_min</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">tempf</span><span class="p">))</span>
            <span class="n">tempf_max</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">tempf_max</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">tempf</span><span class="p">))</span>
        <span class="n">tempf_min</span> <span class="o">-=</span> <span class="mi">0</span>
        <span class="n">tempf_max</span> <span class="o">+=</span> <span class="mi">0</span> 

        <span class="k">if</span> <span class="s1">&#39;TE&#39;</span> <span class="ow">in</span> <span class="n">keyword</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">fxx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_fxx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">file_temp</span> <span class="o">=</span> <span class="n">file_paths</span><span class="p">[</span><span class="s1">&#39;temp&#39;</span><span class="p">][</span><span class="n">fxx</span><span class="p">]</span>
                <span class="n">ds_temp</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">file_temp</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s1">&#39;cfgrib&#39;</span><span class="p">,</span> <span class="n">filter_by_keys</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;stepType&#39;</span><span class="p">:</span> <span class="s1">&#39;instant&#39;</span><span class="p">})</span>
                <span class="n">temp</span> <span class="o">=</span> <span class="n">ds_temp</span><span class="o">.</span><span class="n">t2m</span><span class="o">.</span><span class="n">values</span> 
                <span class="n">tempf</span> <span class="o">=</span> <span class="p">(</span><span class="n">temp</span> <span class="o">-</span> <span class="mf">273.15</span><span class="p">)</span> <span class="o">*</span> <span class="mi">9</span><span class="o">/</span><span class="mi">5</span> <span class="o">+</span> <span class="mi">32</span>  <span class="c1"># Convert from Kelvin to Fahrenheit</span>
                <span class="n">tempf_ds</span> <span class="o">=</span> <span class="n">downsample_data</span><span class="p">(</span><span class="n">tempf</span><span class="p">,</span> <span class="n">step</span><span class="p">)</span>
                
                <span class="n">file_dpt</span> <span class="o">=</span> <span class="n">file_paths</span><span class="p">[</span><span class="s1">&#39;dpt&#39;</span><span class="p">][</span><span class="n">fxx</span><span class="p">]</span>
                <span class="n">ds_dpt</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">file_dpt</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s1">&#39;cfgrib&#39;</span><span class="p">,</span> <span class="n">filter_by_keys</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;stepType&#39;</span><span class="p">:</span> <span class="s1">&#39;instant&#39;</span><span class="p">})</span>
                <span class="n">dpt</span> <span class="o">=</span> <span class="n">ds_dpt</span><span class="o">.</span><span class="n">d2m</span><span class="o">.</span><span class="n">values</span>
                <span class="n">dptf</span> <span class="o">=</span> <span class="p">(</span><span class="n">dpt</span> <span class="o">-</span> <span class="mf">273.15</span><span class="p">)</span> <span class="o">*</span> <span class="mi">9</span><span class="o">/</span><span class="mi">5</span> <span class="o">+</span> <span class="mi">32</span>  <span class="c1"># Convert from Kelvin to Fahrenheit</span>
                <span class="n">dptf_smooth</span> <span class="o">=</span> <span class="n">gaussian_filter</span><span class="p">(</span><span class="n">dpt</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>  <span class="c1"># Gaussian smoothing</span>
                <span class="n">dptf_ds</span> <span class="o">=</span> <span class="n">downsample_data</span><span class="p">(</span><span class="n">dptf_smooth</span><span class="p">,</span> <span class="n">step</span><span class="p">)</span>

                <span class="n">file_pres</span> <span class="o">=</span> <span class="n">file_paths</span><span class="p">[</span><span class="s1">&#39;pres&#39;</span><span class="p">][</span><span class="n">fxx</span><span class="p">]</span>
                <span class="n">ds_pres</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">file_pres</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s1">&#39;cfgrib&#39;</span><span class="p">,</span> <span class="n">filter_by_keys</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;stepType&#39;</span><span class="p">:</span> <span class="s1">&#39;instant&#39;</span><span class="p">})</span>
                <span class="n">pres</span> <span class="o">=</span> <span class="n">ds_pres</span><span class="o">.</span><span class="n">mslma</span><span class="o">.</span><span class="n">values</span> <span class="o">/</span> <span class="mi">100</span>  <span class="c1"># Convert to hPa</span>
                <span class="n">pres_ds</span> <span class="o">=</span> <span class="n">downsample_data</span><span class="p">(</span><span class="n">pres</span><span class="p">,</span> <span class="n">step</span><span class="p">)</span>

                <span class="c1"># Adjust units for equivalent_potential_temperature calculation</span>
                <span class="n">tempf_units</span> <span class="o">=</span> <span class="p">(</span><span class="n">tempf_ds</span> <span class="o">-</span> <span class="mi">32</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">5</span><span class="o">/</span><span class="mi">9</span><span class="p">)</span> <span class="o">+</span> <span class="mf">273.15</span>  <span class="c1"># Convert from Fahrenheit to Kelvin</span>
                <span class="n">dptf_units</span> <span class="o">=</span> <span class="p">(</span><span class="n">dptf_ds</span> <span class="o">-</span> <span class="mi">32</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">5</span><span class="o">/</span><span class="mi">9</span><span class="p">)</span> <span class="o">+</span> <span class="mf">273.15</span>  <span class="c1"># Convert from Fahrenheit to Kelvin</span>
                
                <span class="n">theta_e</span> <span class="o">=</span> <span class="n">equivalent_potential_temperature</span><span class="p">(</span><span class="n">pres_ds</span> <span class="o">*</span> <span class="n">units</span><span class="o">.</span><span class="n">hPa</span><span class="p">,</span> <span class="n">tempf_units</span> <span class="o">*</span> <span class="n">units</span><span class="o">.</span><span class="n">kelvin</span><span class="p">,</span> <span class="n">dptf_units</span> <span class="o">*</span> <span class="n">units</span><span class="o">.</span><span class="n">kelvin</span><span class="p">)</span>
                <span class="n">theta_e_ds</span> <span class="o">=</span> <span class="n">theta_e</span><span class="o">.</span><span class="n">magnitude</span>

                <span class="n">theta_e_min</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">theta_e_min</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">theta_e_ds</span><span class="p">))</span>
                <span class="n">theta_e_max</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">theta_e_max</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">theta_e_ds</span><span class="p">))</span>

            <span class="n">theta_e_min</span> <span class="o">-=</span> <span class="mi">1</span> 
            <span class="n">theta_e_max</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="s1">&#39;THESHR&#39;</span> <span class="ow">in</span> <span class="n">keyword</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">fxx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_fxx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">file_temp</span> <span class="o">=</span> <span class="n">file_paths</span><span class="p">[</span><span class="s1">&#39;temp&#39;</span><span class="p">][</span><span class="n">fxx</span><span class="p">]</span>
                <span class="n">ds_temp</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">file_temp</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s1">&#39;cfgrib&#39;</span><span class="p">,</span> <span class="n">filter_by_keys</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;stepType&#39;</span><span class="p">:</span> <span class="s1">&#39;instant&#39;</span><span class="p">})</span>
                <span class="n">temp</span> <span class="o">=</span> <span class="n">ds_temp</span><span class="o">.</span><span class="n">t2m</span><span class="o">.</span><span class="n">values</span>   <span class="c1"># Convert from Kelvin to Fahrenheit</span>
                <span class="n">temp_ds</span> <span class="o">=</span> <span class="n">downsample_data</span><span class="p">(</span><span class="n">temp</span><span class="p">,</span> <span class="n">step</span><span class="p">)</span>
                
                <span class="n">file_dpt</span> <span class="o">=</span> <span class="n">file_paths</span><span class="p">[</span><span class="s1">&#39;dpt&#39;</span><span class="p">][</span><span class="n">fxx</span><span class="p">]</span>
                <span class="n">ds_dpt</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">file_dpt</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s1">&#39;cfgrib&#39;</span><span class="p">,</span> <span class="n">filter_by_keys</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;stepType&#39;</span><span class="p">:</span> <span class="s1">&#39;instant&#39;</span><span class="p">})</span>
                <span class="n">dpt</span> <span class="o">=</span> <span class="n">ds_dpt</span><span class="o">.</span><span class="n">d2m</span><span class="o">.</span><span class="n">values</span>  <span class="c1"># Gaussian smoothing</span>
                <span class="n">dpt_ds</span> <span class="o">=</span> <span class="n">downsample_data</span><span class="p">(</span><span class="n">dpt</span><span class="p">,</span> <span class="n">step</span><span class="p">)</span>

                <span class="n">file_pres</span> <span class="o">=</span> <span class="n">file_paths</span><span class="p">[</span><span class="s1">&#39;pres&#39;</span><span class="p">][</span><span class="n">fxx</span><span class="p">]</span>
                <span class="n">ds_pres</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">file_pres</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s1">&#39;cfgrib&#39;</span><span class="p">,</span> <span class="n">filter_by_keys</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;stepType&#39;</span><span class="p">:</span> <span class="s1">&#39;instant&#39;</span><span class="p">})</span>
                <span class="n">pres</span> <span class="o">=</span> <span class="n">ds_pres</span><span class="o">.</span><span class="n">mslma</span><span class="o">.</span><span class="n">values</span> <span class="o">/</span> <span class="mi">100</span>  <span class="c1"># Convert to hPa</span>
                <span class="n">pres_ds</span> <span class="o">=</span> <span class="n">downsample_data</span><span class="p">(</span><span class="n">pres</span><span class="p">,</span> <span class="n">step</span><span class="p">)</span>

                <span class="c1"># Adjust units for equivalent_potential_temperature calculation</span>
                
                <span class="n">theta_e</span> <span class="o">=</span> <span class="n">equivalent_potential_temperature</span><span class="p">(</span><span class="n">pres_ds</span> <span class="o">*</span> <span class="n">units</span><span class="o">.</span><span class="n">hPa</span><span class="p">,</span> <span class="n">temp_ds</span> <span class="o">*</span> <span class="n">units</span><span class="o">.</span><span class="n">kelvin</span><span class="p">,</span> <span class="n">dpt_ds</span> <span class="o">*</span> <span class="n">units</span><span class="o">.</span><span class="n">kelvin</span><span class="p">)</span>
                <span class="n">theta_e_ds</span> <span class="o">=</span> <span class="n">theta_e</span><span class="o">.</span><span class="n">magnitude</span>

                <span class="n">theta_e_min</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">theta_e_min</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">theta_e_ds</span><span class="p">))</span>
                <span class="n">theta_e_max</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">theta_e_max</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">theta_e_ds</span><span class="p">))</span>

            <span class="n">theta_e_min</span> <span class="o">-=</span> <span class="mi">0</span>
            <span class="n">theta_e_max</span> <span class="o">+=</span> <span class="mi">0</span>
    
    <span class="k">if</span> <span class="s1">&#39;LCL&#39;</span> <span class="ow">in</span> <span class="n">keyword</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">fxx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_fxx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">file_temp</span> <span class="o">=</span> <span class="n">file_paths</span><span class="p">[</span><span class="s1">&#39;temp&#39;</span><span class="p">][</span><span class="n">fxx</span><span class="p">]</span>
            <span class="n">ds_temp</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">file_temp</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s1">&#39;cfgrib&#39;</span><span class="p">,</span> <span class="n">filter_by_keys</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;stepType&#39;</span><span class="p">:</span> <span class="s1">&#39;instant&#39;</span><span class="p">})</span>
            <span class="n">temp</span> <span class="o">=</span> <span class="n">ds_temp</span><span class="o">.</span><span class="n">t2m</span><span class="o">.</span><span class="n">values</span> 
            <span class="n">tempC</span> <span class="o">=</span> <span class="p">(</span><span class="n">temp</span> <span class="o">-</span> <span class="mf">273.15</span><span class="p">)</span>  <span class="c1"># Convert from Kelvin to Celsius</span>
                
            <span class="k">try</span><span class="p">:</span>
                <span class="n">file_dpt</span> <span class="o">=</span> <span class="n">file_paths</span><span class="p">[</span><span class="s1">&#39;dpt&#39;</span><span class="p">][</span><span class="n">fxx</span><span class="p">]</span>
                <span class="n">ds_dpt</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">file_dpt</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s1">&#39;cfgrib&#39;</span><span class="p">,</span> <span class="n">filter_by_keys</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;stepType&#39;</span><span class="p">:</span> <span class="s1">&#39;instant&#39;</span><span class="p">})</span>
                <span class="k">if</span> <span class="s1">&#39;d2m&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ds_dpt</span><span class="o">.</span><span class="n">variables</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;dpt variable not found in dataset for fxx=</span><span class="si">{</span><span class="n">fxx</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">dpt</span> <span class="o">=</span> <span class="n">ds_dpt</span><span class="o">.</span><span class="n">d2m</span><span class="o">.</span><span class="n">values</span>  <span class="c1"># Assuming &#39;d2m&#39; is the variable name for dew point temperature</span>
            <span class="k">except</span> <span class="p">(</span><span class="ne">IndexError</span><span class="p">,</span> <span class="ne">KeyError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span>
            
            <span class="n">dptC</span> <span class="o">=</span> <span class="p">(</span><span class="n">dpt</span> <span class="o">-</span> <span class="mf">273.15</span><span class="p">)</span>   <span class="c1"># Convert from Kelvin to Celsius  </span>


            <span class="n">file_pres</span> <span class="o">=</span> <span class="n">file_paths</span><span class="p">[</span><span class="s1">&#39;pres&#39;</span><span class="p">][</span><span class="n">fxx</span><span class="p">]</span>
            <span class="n">ds_pres</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">file_pres</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s1">&#39;cfgrib&#39;</span><span class="p">,</span> <span class="n">filter_by_keys</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;stepType&#39;</span><span class="p">:</span> <span class="s1">&#39;instant&#39;</span><span class="p">})</span>
            <span class="n">pres</span> <span class="o">=</span> <span class="n">ds_pres</span><span class="o">.</span><span class="n">sp</span><span class="o">.</span><span class="n">values</span> <span class="o">/</span> <span class="mi">100</span>  <span class="c1"># Convert to hPa</span>
            

            <span class="n">lclc</span> <span class="o">=</span> <span class="n">lcl</span><span class="p">(</span><span class="n">pres</span> <span class="o">*</span> <span class="n">units</span><span class="o">.</span><span class="n">hPa</span><span class="p">,</span> <span class="n">tempC</span> <span class="o">*</span> <span class="n">units</span><span class="o">.</span><span class="n">degC</span><span class="p">,</span> <span class="n">dptC</span><span class="o">*</span> <span class="n">units</span><span class="o">.</span><span class="n">degC</span><span class="p">)</span>
            <span class="n">lcl_pressure</span> <span class="o">=</span> <span class="n">lclc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">magnitude</span>
            <span class="n">lcl_height</span> <span class="o">=</span> <span class="n">pressure_to_height</span><span class="p">(</span><span class="n">lcl_pressure</span><span class="p">)</span>

            <span class="n">lcl_min</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">lcl_min</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">lcl_height</span><span class="p">))</span>
            <span class="n">lcl_max</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">lcl_max</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">lcl_height</span><span class="p">))</span>    

        <span class="n">lcl_min</span> <span class="o">-=</span> <span class="mi">0</span> 
        <span class="n">lcl_max</span> <span class="o">+=</span> <span class="mi">0</span>
        

    <span class="k">if</span> <span class="s1">&#39;gh&#39;</span> <span class="ow">in</span> <span class="n">keyword</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">file_gh</span> <span class="ow">in</span> <span class="n">file_paths</span><span class="p">[</span><span class="s1">&#39;gh&#39;</span><span class="p">]:</span>
            <span class="n">ds_gh</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">file_gh</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s1">&#39;cfgrib&#39;</span><span class="p">,</span> <span class="n">filter_by_keys</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;stepType&#39;</span><span class="p">:</span> <span class="s1">&#39;instant&#39;</span><span class="p">})</span>
            <span class="n">gh</span> <span class="o">=</span> <span class="n">ds_gh</span><span class="o">.</span><span class="n">gh</span><span class="o">.</span><span class="n">values</span>
            <span class="n">lon</span> <span class="o">=</span> <span class="n">ds_gh</span><span class="o">.</span><span class="n">longitude</span><span class="o">.</span><span class="n">values</span>
            <span class="n">lat</span> <span class="o">=</span> <span class="n">ds_gh</span><span class="o">.</span><span class="n">latitude</span><span class="o">.</span><span class="n">values</span>

        <span class="k">for</span> <span class="n">file_wind</span> <span class="ow">in</span> <span class="n">file_paths</span><span class="p">[</span><span class="s1">&#39;winds&#39;</span><span class="p">]:</span>
            <span class="n">ds_winds</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">file_wind</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s1">&#39;cfgrib&#39;</span><span class="p">,</span> <span class="n">filter_by_keys</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;stepType&#39;</span><span class="p">:</span> <span class="s1">&#39;instant&#39;</span><span class="p">})</span>
            <span class="n">u</span> <span class="o">=</span> <span class="n">ds_winds</span><span class="o">.</span><span class="n">u</span><span class="o">.</span><span class="n">values</span> <span class="o">*</span> <span class="n">MS_TO_KNOTS</span>

        <span class="k">for</span> <span class="n">file_wind2</span> <span class="ow">in</span> <span class="n">file_paths</span><span class="p">[</span><span class="s1">&#39;winds2&#39;</span><span class="p">]:</span>
            <span class="n">ds_winds2</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">file_wind2</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s1">&#39;cfgrib&#39;</span><span class="p">,</span> <span class="n">filter_by_keys</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;stepType&#39;</span><span class="p">:</span> <span class="s1">&#39;instant&#39;</span><span class="p">})</span>
            <span class="n">v</span> <span class="o">=</span> <span class="n">ds_winds2</span><span class="o">.</span><span class="n">v</span><span class="o">.</span><span class="n">values</span> <span class="o">*</span> <span class="n">MS_TO_KNOTS</span>
            <span class="n">wind_speed_max</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">wind_speed_max</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">u</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">v</span><span class="o">**</span><span class="mi">2</span><span class="p">)))</span>
            
    

    <span class="n">frames</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">fxx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_fxx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">frame_filename</span> <span class="o">=</span> <span class="n">create_frame</span><span class="p">(</span><span class="n">file_paths</span><span class="p">,</span> <span class="n">fxx</span><span class="p">,</span> <span class="n">output_dir</span><span class="p">,</span> <span class="n">extent</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">init_time</span><span class="p">,</span> <span class="n">model_name</span><span class="p">,</span> <span class="n">cape_min</span><span class="p">,</span> <span class="n">cape_max</span><span class="p">,</span> <span class="n">cin_min</span><span class="p">,</span> <span class="n">cin_max</span><span class="p">,</span> <span class="n">keyword</span><span class="p">,</span> <span class="n">uvv_min</span><span class="p">,</span> <span class="n">uvv_max</span><span class="p">,</span> <span class="n">absv_min</span><span class="p">,</span> <span class="n">absv_max</span><span class="p">,</span> <span class="n">tp_min</span><span class="p">,</span> <span class="n">tp_max</span><span class="p">,</span> <span class="n">tempf_min</span><span class="p">,</span> <span class="n">tempf_max</span><span class="p">,</span> <span class="n">step</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="n">theta_e_min</span><span class="p">,</span> <span class="n">theta_e_max</span><span class="p">,</span> <span class="n">wind_speed_max</span><span class="p">,</span> <span class="n">hlcy_min</span><span class="p">,</span> <span class="n">hlcy_max</span><span class="p">,</span> <span class="n">lift_min</span><span class="p">,</span> <span class="n">lift_max</span><span class="p">,</span> <span class="n">lcl_min</span><span class="p">,</span> <span class="n">lcl_max</span><span class="p">,</span> <span class="n">pbl_min</span><span class="p">,</span> <span class="n">pbl_max</span><span class="p">,</span> <span class="n">level</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">frame_filename</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">frame_filename</span><span class="p">)</span> <span class="k">as</span> <span class="n">img</span><span class="p">:</span>
                <span class="n">frames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">img</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">pass</span>

    <span class="k">if</span> <span class="n">frames</span><span class="p">:</span>
        <span class="n">frames</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">save</span><span class="p">(</span>
            <span class="n">output_gif</span><span class="p">,</span>
            <span class="n">save_all</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">append_images</span><span class="o">=</span><span class="n">frames</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span>
            <span class="n">duration</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>
            <span class="n">loop</span><span class="o">=</span><span class="mi">0</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">pass</span>

    <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">output_dir</span><span class="p">):</span>
        <span class="n">file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">file_path</span><span class="p">):</span>
            <span class="n">force_delete_file</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">file_paths</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">file_path</span> <span class="ow">in</span> <span class="n">file_paths</span><span class="p">[</span><span class="n">key</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">file_path</span><span class="p">):</span>
                <span class="n">force_delete_file</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
            <span class="n">original_file_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;subset_</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">_&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">original_file_path</span><span class="p">):</span>
                <span class="n">force_delete_file</span><span class="p">(</span><span class="n">original_file_path</span><span class="p">)</span>

    <span class="n">date_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;C:</span><span class="se">\\</span><span class="s2">Users</span><span class="se">\\</span><span class="s2">thewe</span><span class="se">\\</span><span class="s2">data</span><span class="se">\\</span><span class="s2">hrrr&quot;</span><span class="p">,</span> <span class="n">date</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">date_dir</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">root</span><span class="p">,</span> <span class="n">dirs</span><span class="p">,</span> <span class="n">files</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">date_dir</span><span class="p">,</span> <span class="n">topdown</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
                <span class="n">force_delete_file</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">name</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">dirs</span><span class="p">:</span>
                <span class="n">os</span><span class="o">.</span><span class="n">rmdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">name</span><span class="p">))</span>
        <span class="n">os</span><span class="o">.</span><span class="n">rmdir</span><span class="p">(</span><span class="n">date_dir</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">output_dir</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">rmdir</span><span class="p">(</span><span class="n">output_dir</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">select_region</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Select a region:&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">region</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">regions</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="mi">1</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">. </span><span class="si">{</span><span class="n">region</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39; &#39;</span><span class="p">)</span><span class="o">.</span><span class="n">title</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">choice</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Enter the number of the region: &quot;</span><span class="p">))</span>
    <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">regions</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="n">choice</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">select_variable</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Select a variable:&quot;</span><span class="p">)</span>
    <span class="n">variables</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;MLCAPE&quot;</span><span class="p">,</span> <span class="s2">&quot;MUCAPE&quot;</span><span class="p">,</span> <span class="s2">&quot;SBCAPE&quot;</span><span class="p">,</span> <span class="s2">&quot;helcy3&quot;</span><span class="p">,</span> <span class="s2">&quot;hlcy_ml&quot;</span><span class="p">,</span> <span class="s2">&quot;hlcy_mu&quot;</span><span class="p">,</span> <span class="s2">&quot;hlcy_sb&quot;</span><span class="p">,</span> <span class="s2">&quot;UVV&quot;</span><span class="p">,</span> <span class="s2">&quot;ABSV&quot;</span><span class="p">,</span> <span class="s2">&quot;QPF&quot;</span><span class="p">,</span> <span class="s2">&quot;uphl&quot;</span><span class="p">,</span> <span class="s2">&quot;sfc&quot;</span><span class="p">,</span> <span class="s2">&quot;TE&quot;</span><span class="p">,</span> <span class="s2">&quot;gh&quot;</span><span class="p">,</span> <span class="s2">&quot;LI&quot;</span><span class="p">,</span> <span class="s2">&quot;LCL&quot;</span><span class="p">,</span> <span class="s2">&quot;STP&quot;</span><span class="p">,</span> <span class="s2">&quot;PBL&quot;</span><span class="p">,</span> <span class="s2">&quot;THESHR&quot;</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">var</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">variables</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">. </span><span class="si">{</span><span class="n">var</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">choice</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Enter the number of the variable: &quot;</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">variables</span><span class="p">[</span><span class="n">choice</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">select_level</span><span class="p">(</span><span class="n">variable</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">variable</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;UVV&quot;</span><span class="p">,</span> <span class="s2">&quot;ABSV&quot;</span><span class="p">,</span> <span class="s2">&quot;gh&quot;</span><span class="p">]:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Select a level for </span><span class="si">{</span><span class="n">variable</span><span class="si">}</span><span class="s2">:&quot;</span><span class="p">)</span>
        <span class="n">levels</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;250&quot;</span><span class="p">,</span> <span class="s2">&quot;300&quot;</span><span class="p">,</span> <span class="s2">&quot;500&quot;</span><span class="p">,</span> <span class="s2">&quot;700&quot;</span><span class="p">,</span> <span class="s2">&quot;850&quot;</span><span class="p">,</span> <span class="s2">&quot;925&quot;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">level</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">levels</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">. </span><span class="si">{</span><span class="n">level</span><span class="si">}</span><span class="s2"> mb&quot;</span><span class="p">)</span>
        <span class="n">choice</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">input</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Enter the number of the level: &quot;</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">levels</span><span class="p">[</span><span class="n">choice</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
    <span class="k">return</span> <span class="kc">None</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">date</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Enter the date (e.g., 2024-06-24 18:00): &quot;</span><span class="p">)</span>
    <span class="n">model</span> <span class="o">=</span> <span class="s2">&quot;hrrr&quot;</span>
    <span class="n">max_fxx</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Enter the maximum forecast hour (For 0, 6, 12, 18z, its 48, anything else it&#39;s 18): &quot;</span><span class="p">))</span>
    
    

    <span class="n">region</span> <span class="o">=</span> <span class="n">select_region</span><span class="p">()</span>
    <span class="n">variable</span> <span class="o">=</span> <span class="n">select_variable</span><span class="p">()</span>
    <span class="n">level</span> <span class="o">=</span> <span class="n">select_level</span><span class="p">(</span><span class="n">variable</span><span class="p">)</span>
    <span class="n">output_gif</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">variable</span><span class="si">}</span><span class="s2">_animation.gif&quot;</span>
    <span class="k">if</span> <span class="n">region</span> <span class="o">==</span> <span class="s2">&quot;conus&quot;</span><span class="p">:</span>
        <span class="n">step</span> <span class="o">=</span> <span class="mi">6</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">step</span> <span class="o">=</span> <span class="mi">4</span>

    <span class="n">create_animated_gif</span><span class="p">(</span><span class="n">date</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">max_fxx</span><span class="p">,</span> <span class="n">output_gif</span><span class="p">,</span> <span class="n">region</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">variable</span><span class="p">,</span> <span class="n">level</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Animated GIF saved as </span><span class="si">{</span><span class="n">output_gif</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">output_gif</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">display</span><span class="p">(</span><span class="n">IPImage</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(),</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;gif&#39;</span><span class="p">))</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>## You are using the Python ARM Radar Toolkit (Py-ART), an open source
## library for working with weather radar data. Py-ART is partly
## supported by the U.S. Department of Energy as part of the Atmospheric
## Radiation Measurement (ARM) Climate Research Facility, an Office of
## Science user facility.
##
## If you use this software to prepare a publication, please cite:
##
##     JJ Helmus and SM Collis, JORS 2016, doi: 10.5334/jors.119
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Select a region:
1. North Central
2. Central
3. South Central
4. Midwestern
5. Ohio Valley
6. Mid Atlantic
7. Northeastern
8. Southeastern
9. Northwestern
10. Southwestern
11. Rocky Mountain
12. Upper Great Lakes
13. Plains
14. Conus
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Select a variable:
1. MLCAPE
2. MUCAPE
3. SBCAPE
4. helcy3
5. hlcy_ml
6. hlcy_mu
7. hlcy_sb
8. UVV
9. ABSV
10. QPF
11. uphl
12. sfc
13. TE
14. gh
15. LI
16. LCL
17. STP
18. PBL
19. THESHR
20. GSWIND
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> Found  model=hrrr  product=sfc  2024-Jul-08 12:00 UTC F00  GRIB2 @ aws  IDX @ aws
 Created directory: [C:\Users\thewe\data\hrrr\20240708]
Downloaded temp (lcl) file for fxx=0: C:\Users\thewe\data\hrrr\20240708\subset_d0ef7d97__hrrr.t12z.wrfsfcf00.grib2
Downloaded dpt (lcl) file for fxx=0: C:\Users\thewe\data\hrrr\20240708\subset_d0ef7d97__hrrr.t12z.wrfsfcf00.grib2
Downloaded pres (lcl) file for fxx=0: C:\Users\thewe\data\hrrr\20240708\subset_d0ef7a9f__hrrr.t12z.wrfsfcf00.grib2
Downloaded vvcsh file for fxx=0: C:\Users\thewe\data\hrrr\20240708\subset_d0efa92d__hrrr.t12z.wrfsfcf00.grib2
Downloaded vucsh file for fxx=0: C:\Users\thewe\data\hrrr\20240708\subset_d0efa92d__hrrr.t12z.wrfsfcf00.grib2
Creating frame for fxx=0 with keyword=THESHR
Processing THESHR for fxx=0
Variables in ds_pres for fxx=0: [&#39;time&#39;, &#39;step&#39;, &#39;meanSea&#39;, &#39;latitude&#39;, &#39;longitude&#39;, &#39;valid_time&#39;, &#39;mslma&#39;]
Animated GIF saved as THESHR_animation.gif
</pre></div>
</div>
<img alt="../../_images/222982d9d3b6eb078dca2a3fbcb8cdbe91cb037d6b7596abb2a4e6b0230297db.gif" src="../../_images/222982d9d3b6eb078dca2a3fbcb8cdbe91cb037d6b7596abb2a4e6b0230297db.gif" />
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "crocusenv"
        },
        kernelOptions: {
            name: "crocusenv",
            path: "./notebooks/solutions"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'crocusenv'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="simple visible nav section-nav flex-column">
</ul>

  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By the <a href="https://www.anl.gov/evs">Argonne National Laboratory </a> Environmental Sciences
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
       Copyright 2024.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    <p class="last-updated">
  Last updated on 21 July 2024.
  <br/>
</p>
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>