
<!DOCTYPE html>


<html lang="en" data-content_root="../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Overview &#8212; Summer 2024 DOE SULI Project - Hyperlocal Precipitation Observations</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-design.min.css?v=87e54e7c" />
    <link rel="stylesheet" type="text/css" href="../../_static/custom.css?v=d0efeab3" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'notebooks/solutions/AnimatedPyARTBlg';</script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
    <meta name="docbuild:last-update" content="2 August 2024"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
        
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
     
  

<a class="navbar-brand logo" href="https://www.anl.gov/">
  
  
  
  
  
    
    
      
    
    
    <img src="../../_static/ANL_RGB-01.png" class="logo__image only-light" alt="Summer 2024 DOE SULI Project - Hyperlocal Precipitation Observations - Home"/>
    <script>document.write(`<img src="../../_static/ANL_RGB-01.png" class="logo__image only-dark" alt="Summer 2024 DOE SULI Project - Hyperlocal Precipitation Observations - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/EVS-ATMOS/hyperlocal-observations" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-square-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
</ul></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../README.html">
                    Hyperlocal Precipitation Observations Cookbook
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Logistics + Information</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../schedule.html">Schedule</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Exploration</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../Exploration/Herbie_HRRR_Custom.html">Overview</a></li>








</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Assignments</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../assignments/pyart-blog.html">Assignment 1 : Py-ART Blog Post</a></li>
<li class="toctree-l1"><a class="reference internal" href="../assignments/insitu-comparison.html">Assignment 2 : Radar / In-Situ Observation Comparison</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Solutions</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="PPI_Notebook.html">NEXRAD Level 2 Radar Data Animated GIFs</a></li>







<li class="toctree-l1"><a class="reference internal" href="FeatDetection.html">Radar Reflectivity Feature Detection and Classification</a></li>





<li class="toctree-l1"><a class="reference internal" href="VertCol.html">Vertical Reflectivity Columns</a></li>





</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Final Project</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../project/hyperlocal-final-project.html">Final Project - Hyperlocal Preciptiation Analysis</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/EVS-ATMOS/hyperlocal-observations" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/EVS-ATMOS/hyperlocal-observations/edit/main/notebooks/solutions/AnimatedPyARTBlg.ipynb" target="_blank"
   class="btn btn-sm btn-source-edit-button dropdown-item"
   title="Suggest edit"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="btn__text-container">Suggest edit</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/EVS-ATMOS/hyperlocal-observations/issues/new?title=Issue%20on%20page%20%2Fnotebooks/solutions/AnimatedPyARTBlg.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../_sources/notebooks/solutions/AnimatedPyARTBlg.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Overview</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Overview</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#within-this-notebook-we-will-cover">Within this notebook, we will cover:</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#accessing-nexrad-data-from-aws">1: Accessing NEXRAD data from AWS</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#how-to-read-the-data-into-py-art-and-create-plots">2: How to read the data into Py-ART and create plots</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#how-to-create-animated-gifs-with-acquired-radar-data-from-py-art">3: How to create animated gifs with acquired radar data from Py-ART</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#alternative-applications-of-gif-making-for-more-obscure-or-algorithmic-products-such-as-feature-detection-or-vertical-column-pulling">4: Alternative applications of GIF making for more obscure or algorithmic products such as feature detection, or vertical column pulling</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#prerequisites">Prerequisites</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#imports-for-animated-gif-making-in-pyart">Imports for animated gif making in PyArt</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#set-up-the-aws-s3-filysystem">Set up the AWS S3 filysystem</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#selecting-your-date-station-and-time-period">Selecting your date, station, and time period</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#optional-setting-up-individual-locations-to-be-plotted-on-your-map">OPTIONAL* setting up individual locations to be plotted on your map</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#checking-your-plottable-radar-products">Checking your plottable radar products</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#reading-the-data-into-pyart">Reading the data into PyART</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#looping-through-the-radar-data">Looping through the radar data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#plotting-code-with-added-features-and-plotted-points">Plotting code with added features and plotted points</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#customizing-the-range-of-plotted-data">Customizing the range of plotted data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#counties">Counties</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#location-plotting">Location plotting</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#zooming">Zooming</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#colorbar">Colorbar</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#note">NOTE</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#full-code-block-constructed-properly-within-the-for-loop">Full code block constructed properly within the for loop.</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#gif-creation">GIF creation</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#code-in-whole">Code in whole</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#making-gifs-of-other-analysis-products-such-as-feature-detection">Making GIFs of other analysis products such as feature detection</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#now-that-we-know-how-to-create-animated-gifs-through-use-of-basic-python-syntax-and-the-py-art-package-we-will-learn-how-to-create-gifs-of-more-obscure-products-such-as-feature-detection">Now that we know how to create animated gifs through use of basic python syntax and the Py-ART package, we will learn how to create GIFs of more obscure products such as feature detection.</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#if-you-would-like-to-know-more-about-how-feature-detection-in-py-art-works-and-what-exactly-it-does-in-detail-visit-https-arm-doe-github-io-pyart-examples-retrieve-plot-convective-stratiform-html">If you would like to know more about how feature detection in Py-ART works and what exactly it does in detail, visit https://arm-doe.github.io/pyart/examples/retrieve/plot_convective_stratiform.html</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#imports">Imports</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#we-will-use-most-of-the-same-code-for-setting-up-the-date-selection-file-grabbing-and-station-selection-stuff-so-it-will-just-be-posted-as-one-block-the-function-to-read-the-files-is-also-the-same">We will use most of the same code for setting up the date selection, file grabbing, and station selection stuff, so it will just be posted as one block. The function to read the files is also the same.</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-loop-made-to-parse-through-the-files-is-also-similar-but-we-will-instead-set-up-our-for-loop-to-extract-the-scanning-elevation-in-question-and-interpolate-it-into-a-grid-to-use-for-the-feature-detection-algorithm">The loop made to parse through the files is also similar, but we will instead set up our for loop to extract the scanning elevation in question, and interpolate it into a grid to use for the feature detection algorithm</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">GIF creation</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#vertical-radar-column-gif-making-and-complex-plotting">Vertical Radar Column GIF making and complex plotting</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#this-portion-will-demonstrate-how-to-make-a-complex-plot-including-vertical-reflectivity-columns-derived-rainfall-rate-and-reflectivity-for-analytical-purposes">This portion will demonstrate how to make a complex plot including vertical reflectivity columns, derived rainfall rate, and reflectivity for analytical purposes</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">Imports</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-initial-setup-for-this-product-will-be-similar-to-the-previous-products-although-there-will-be-some-notable-differences">The initial setup for this product will be similar to the previous products, although there will be some notable differences</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#netcdf-file-creation">netCDF file creation</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#to-create-the-netcdf-file-we-will-extract-the-radar-data-from-the-files-and-save-the-reflectivity-data-for-each-points-preserving-the-spatial-and-temporal-data-by-indexing-the-variable-by-time-and-height-this-is-essential-for-plotting-our-vertical-column-data">To create the netCDF file, we will extract the radar data from the files and save the reflectivity data for each points, preserving the spatial and temporal data by indexing the variable by time and height. This is essential for plotting our vertical column data</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#initializing-the-netcdf-files-for-use">Initializing the netcDF files for use</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#calculation-of-z-r-relationship-for-derived-rainfall-rate-caluclations">Calculation of Z-R relationship for derived rainfall rate caluclations</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#plotting">Plotting</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-time-height-plots-visualize-the-reflectivity-column-over-each-location-specified-earlier-in-the-code-it-will-create-a-figure-that-shows-the-change-in-vertical-reflectivity-columns-with-respect-to-time-to-visualize-the-position-of-the-convective-precipitaton-core-should-one-exist-over-the-area">The time height plots visualize the reflectivity column over each location specified earlier in the code. It will create a figure that shows the change in vertical reflectivity columns with respect to time to visualize the position of the convective precipitaton core (should one exist) over the area.</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-rainfall-rate-plots-will-visualize-the-change-in-rainfall-rate-as-calculated-by-the-z-r-relationship">The rainfall rate plots will visualize the change in rainfall rate as calculated by the Z-R relationship.</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#gif-creation-and-cleanup">GIF creation and cleanup</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#if-you-want-to-keep-the-netcdf-files-for-whatever-purpose-feel-free-to-remove-or-comment-the-code-to-remove-them-out">IF you want to keep the netCDF files for whatever purpose, feel free to remove or comment the code to remove them out.</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#summary">Summary</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#what-comes-next">What comes next?</a></li>
</ul>
</li>
</ul>

            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <p style="text-align: left; font-size: 32px; font-weight: bold;">
    Creating animated gifs with NEXRAD Level 2 radar data using Py-ART
</p><section class="tex2jax_ignore mathjax_ignore" id="overview">
<h1>Overview<a class="headerlink" href="#overview" title="Link to this heading"><i class="fas fa-link"></i></a></h1>
<section id="within-this-notebook-we-will-cover">
<h2>Within this notebook, we will cover:<a class="headerlink" href="#within-this-notebook-we-will-cover" title="Link to this heading"><i class="fas fa-link"></i></a></h2>
<section id="accessing-nexrad-data-from-aws">
<h3>1: Accessing NEXRAD data from AWS<a class="headerlink" href="#accessing-nexrad-data-from-aws" title="Link to this heading"><i class="fas fa-link"></i></a></h3>
</section>
<section id="how-to-read-the-data-into-py-art-and-create-plots">
<h3>2: How to read the data into Py-ART and create plots<a class="headerlink" href="#how-to-read-the-data-into-py-art-and-create-plots" title="Link to this heading"><i class="fas fa-link"></i></a></h3>
</section>
<section id="how-to-create-animated-gifs-with-acquired-radar-data-from-py-art">
<h3>3: How to create animated gifs with acquired radar data from Py-ART<a class="headerlink" href="#how-to-create-animated-gifs-with-acquired-radar-data-from-py-art" title="Link to this heading"><i class="fas fa-link"></i></a></h3>
</section>
<section id="alternative-applications-of-gif-making-for-more-obscure-or-algorithmic-products-such-as-feature-detection-or-vertical-column-pulling">
<h3>4: Alternative applications of GIF making for more obscure or algorithmic products such as feature detection, or vertical column pulling<a class="headerlink" href="#alternative-applications-of-gif-making-for-more-obscure-or-algorithmic-products-such-as-feature-detection-or-vertical-column-pulling" title="Link to this heading"><i class="fas fa-link"></i></a></h3>
</section>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="prerequisites">
<h1>Prerequisites<a class="headerlink" href="#prerequisites" title="Link to this heading"><i class="fas fa-link"></i></a></h1>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Concepts</p></th>
<th class="head"><p>Importance</p></th>
<th class="head"><p>Notes</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><a class="reference external" href="https://foundations.projectpythia.org/foundations/quickstart.html">Quickstart: Zero to Python</a></p></td>
<td><p>Required</p></td>
<td><p>For loops, lists</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference external" href="https://link-to-matplotlib-basics">Matplotlib Basics</a></p></td>
<td><p>Required</p></td>
<td><p>Basic plotting</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference external" href="https://link-to-pyart-basics">Py-ART Basics</a></p></td>
<td><p>Required</p></td>
<td><p>IO/Visualization</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference external" href="https://projectpythia.org/radar-cookbook/notebooks/radar-basics/radar-basics.html">The Basics of Weather Radar</a></p></td>
<td><p>Required</p></td>
<td><p>Competency with Radar and its products</p></td>
</tr>
</tbody>
</table>
</div>
<ul class="simple">
<li><p><strong>Time to learn:</strong> 30 Minutes</p></li>
</ul>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="imports-for-animated-gif-making-in-pyart">
<h1>Imports for animated gif making in PyArt<a class="headerlink" href="#imports-for-animated-gif-making-in-pyart" title="Link to this heading"><i class="fas fa-link"></i></a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pyart</span>
<span class="kn">import</span> <span class="nn">fsspec</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">io</span> <span class="kn">import</span> <span class="n">BytesIO</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">import</span> <span class="nn">cartopy.crs</span> <span class="k">as</span> <span class="nn">ccrs</span>
<span class="kn">from</span> <span class="nn">metpy.plots</span> <span class="kn">import</span> <span class="n">USCOUNTIES</span>
<span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span>
<span class="kn">from</span> <span class="nn">mpl_toolkits.axes_grid1</span> <span class="kn">import</span> <span class="n">make_axes_locatable</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<hr class="docutils" />
<section id="set-up-the-aws-s3-filysystem">
<h2>Set up the AWS S3 filysystem<a class="headerlink" href="#set-up-the-aws-s3-filysystem" title="Link to this heading"><i class="fas fa-link"></i></a></h2>
<p>This allows you to pull nexrad-level-2 data files from the AWS repository.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fs</span> <span class="o">=</span> <span class="n">fsspec</span><span class="o">.</span><span class="n">filesystem</span><span class="p">(</span><span class="s2">&quot;s3&quot;</span><span class="p">,</span> <span class="n">anon</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="selecting-your-date-station-and-time-period">
<h2>Selecting your date, station, and time period<a class="headerlink" href="#selecting-your-date-station-and-time-period" title="Link to this heading"><i class="fas fa-link"></i></a></h2>
<p>Once the file system is set up, you can use the following code to specify what time, date, and station you’d like to retrieve data for</p>
<p>For this example, we will use data from NWS Chicago (KLOT) from 04 UTC, June 5th, 2024</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">start_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">(</span><span class="mi">2024</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>  <span class="c1"># YYYY/MM/DD HH</span>
<span class="n">end_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">(</span><span class="mi">2024</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>   <span class="c1"># YYYY/MM/DD HH</span>
<span class="n">station</span> <span class="o">=</span> <span class="s1">&#39;KLOT&#39;</span>

<span class="c1"># Generate the list of files for the specified date and hour range</span>
<span class="n">files</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">current_date</span> <span class="o">=</span> <span class="n">start_date</span>
<span class="k">while</span> <span class="n">current_date</span> <span class="o">&lt;=</span> <span class="n">end_date</span><span class="p">:</span>
    <span class="n">date_str</span> <span class="o">=</span> <span class="n">current_date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y/%m/</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">date_str_compact</span> <span class="o">=</span> <span class="n">current_date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y%m</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">hour</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">start_hour</span><span class="p">,</span> <span class="n">end_hour</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">hour_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">hour</span><span class="si">:</span><span class="s2">02d</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">files</span> <span class="o">+=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">fs</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;s3://noaa-nexrad-level2/</span><span class="si">{</span><span class="n">date_str</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">station</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">station</span><span class="si">}{</span><span class="n">date_str_compact</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">hour_str</span><span class="si">}</span><span class="s2">*&quot;</span><span class="p">))</span>
    <span class="n">current_date</span> <span class="o">+=</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># Print the selected files</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Selected files:&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Selected files:
noaa-nexrad-level2/2024/06/05/KLOT/KLOT20240605_040442_V06
noaa-nexrad-level2/2024/06/05/KLOT/KLOT20240605_040926_V06
noaa-nexrad-level2/2024/06/05/KLOT/KLOT20240605_041403_V06
noaa-nexrad-level2/2024/06/05/KLOT/KLOT20240605_041840_V06
noaa-nexrad-level2/2024/06/05/KLOT/KLOT20240605_042316_V06
noaa-nexrad-level2/2024/06/05/KLOT/KLOT20240605_042800_V06
noaa-nexrad-level2/2024/06/05/KLOT/KLOT20240605_043244_V06
noaa-nexrad-level2/2024/06/05/KLOT/KLOT20240605_043728_V06
noaa-nexrad-level2/2024/06/05/KLOT/KLOT20240605_044158_V06
noaa-nexrad-level2/2024/06/05/KLOT/KLOT20240605_044635_V06
noaa-nexrad-level2/2024/06/05/KLOT/KLOT20240605_045106_V06
noaa-nexrad-level2/2024/06/05/KLOT/KLOT20240605_045532_V06
noaa-nexrad-level2/2024/06/05/KLOT/KLOT20240605_045958_V06
noaa-nexrad-level2/2024/06/05/KLOT/KLOT20240605_045958_V06_MDM
noaa-nexrad-level2/2024/06/05/KLOT/KLOT20240605_050423_V06
noaa-nexrad-level2/2024/06/05/KLOT/KLOT20240605_050849_V06
noaa-nexrad-level2/2024/06/05/KLOT/KLOT20240605_051315_V06
noaa-nexrad-level2/2024/06/05/KLOT/KLOT20240605_051741_V06
noaa-nexrad-level2/2024/06/05/KLOT/KLOT20240605_052202_V06
noaa-nexrad-level2/2024/06/05/KLOT/KLOT20240605_052623_V06
noaa-nexrad-level2/2024/06/05/KLOT/KLOT20240605_053059_V06
noaa-nexrad-level2/2024/06/05/KLOT/KLOT20240605_053543_V06
noaa-nexrad-level2/2024/06/05/KLOT/KLOT20240605_054009_V06
noaa-nexrad-level2/2024/06/05/KLOT/KLOT20240605_054452_V06
noaa-nexrad-level2/2024/06/05/KLOT/KLOT20240605_054936_V06
noaa-nexrad-level2/2024/06/05/KLOT/KLOT20240605_055420_V06
noaa-nexrad-level2/2024/06/05/KLOT/KLOT20240605_055845_V06
noaa-nexrad-level2/2024/06/05/KLOT/KLOT20240605_055845_V06_MDM
noaa-nexrad-level2/2024/06/05/KLOT/KLOT20240605_060311_V06
noaa-nexrad-level2/2024/06/05/KLOT/KLOT20240605_060737_V06
noaa-nexrad-level2/2024/06/05/KLOT/KLOT20240605_061221_V06
noaa-nexrad-level2/2024/06/05/KLOT/KLOT20240605_061705_V06
noaa-nexrad-level2/2024/06/05/KLOT/KLOT20240605_062142_V06
noaa-nexrad-level2/2024/06/05/KLOT/KLOT20240605_062625_V06
noaa-nexrad-level2/2024/06/05/KLOT/KLOT20240605_063110_V06
noaa-nexrad-level2/2024/06/05/KLOT/KLOT20240605_063530_V06
noaa-nexrad-level2/2024/06/05/KLOT/KLOT20240605_063956_V06
noaa-nexrad-level2/2024/06/05/KLOT/KLOT20240605_064417_V06
noaa-nexrad-level2/2024/06/05/KLOT/KLOT20240605_064838_V06
noaa-nexrad-level2/2024/06/05/KLOT/KLOT20240605_065259_V06
noaa-nexrad-level2/2024/06/05/KLOT/KLOT20240605_065721_V06
noaa-nexrad-level2/2024/06/05/KLOT/KLOT20240605_065721_V06_MDM
noaa-nexrad-level2/2024/06/05/KLOT/KLOT20240605_070158_V06
noaa-nexrad-level2/2024/06/05/KLOT/KLOT20240605_070635_V06
noaa-nexrad-level2/2024/06/05/KLOT/KLOT20240605_071112_V06
noaa-nexrad-level2/2024/06/05/KLOT/KLOT20240605_071533_V06
noaa-nexrad-level2/2024/06/05/KLOT/KLOT20240605_071955_V06
noaa-nexrad-level2/2024/06/05/KLOT/KLOT20240605_072438_V06
noaa-nexrad-level2/2024/06/05/KLOT/KLOT20240605_072859_V06
noaa-nexrad-level2/2024/06/05/KLOT/KLOT20240605_073320_V06
noaa-nexrad-level2/2024/06/05/KLOT/KLOT20240605_073741_V06
noaa-nexrad-level2/2024/06/05/KLOT/KLOT20240605_074202_V06
noaa-nexrad-level2/2024/06/05/KLOT/KLOT20240605_074646_V06
noaa-nexrad-level2/2024/06/05/KLOT/KLOT20240605_075130_V06
noaa-nexrad-level2/2024/06/05/KLOT/KLOT20240605_075614_V06
noaa-nexrad-level2/2024/06/05/KLOT/KLOT20240605_075614_V06_MDM
noaa-nexrad-level2/2024/06/05/KLOT/KLOT20240605_080036_V06
noaa-nexrad-level2/2024/06/05/KLOT/KLOT20240605_080506_V06
noaa-nexrad-level2/2024/06/05/KLOT/KLOT20240605_080918_V06
noaa-nexrad-level2/2024/06/05/KLOT/KLOT20240605_081341_V06
noaa-nexrad-level2/2024/06/05/KLOT/KLOT20240605_081811_V06
noaa-nexrad-level2/2024/06/05/KLOT/KLOT20240605_082221_V06
noaa-nexrad-level2/2024/06/05/KLOT/KLOT20240605_082631_V06
noaa-nexrad-level2/2024/06/05/KLOT/KLOT20240605_083042_V06
noaa-nexrad-level2/2024/06/05/KLOT/KLOT20240605_083451_V06
noaa-nexrad-level2/2024/06/05/KLOT/KLOT20240605_083847_V06
noaa-nexrad-level2/2024/06/05/KLOT/KLOT20240605_084244_V06
noaa-nexrad-level2/2024/06/05/KLOT/KLOT20240605_084640_V06
noaa-nexrad-level2/2024/06/05/KLOT/KLOT20240605_085049_V06
noaa-nexrad-level2/2024/06/05/KLOT/KLOT20240605_085459_V06
noaa-nexrad-level2/2024/06/05/KLOT/KLOT20240605_085908_V06
noaa-nexrad-level2/2024/06/05/KLOT/KLOT20240605_085908_V06_MDM
noaa-nexrad-level2/2024/06/05/KLOT/KLOT20240605_090330_V06
noaa-nexrad-level2/2024/06/05/KLOT/KLOT20240605_090739_V06
noaa-nexrad-level2/2024/06/05/KLOT/KLOT20240605_091202_V06
noaa-nexrad-level2/2024/06/05/KLOT/KLOT20240605_091613_V06
noaa-nexrad-level2/2024/06/05/KLOT/KLOT20240605_092036_V06
noaa-nexrad-level2/2024/06/05/KLOT/KLOT20240605_092443_V06
noaa-nexrad-level2/2024/06/05/KLOT/KLOT20240605_092919_V06
noaa-nexrad-level2/2024/06/05/KLOT/KLOT20240605_093342_V06
noaa-nexrad-level2/2024/06/05/KLOT/KLOT20240605_093804_V06
noaa-nexrad-level2/2024/06/05/KLOT/KLOT20240605_094248_V06
noaa-nexrad-level2/2024/06/05/KLOT/KLOT20240605_094724_V06
noaa-nexrad-level2/2024/06/05/KLOT/KLOT20240605_095200_V06
noaa-nexrad-level2/2024/06/05/KLOT/KLOT20240605_095637_V06
noaa-nexrad-level2/2024/06/05/KLOT/KLOT20240605_095637_V06_MDM
noaa-nexrad-level2/2024/06/05/KLOT/KLOT20240605_100113_V06
noaa-nexrad-level2/2024/06/05/KLOT/KLOT20240605_100550_V06
noaa-nexrad-level2/2024/06/05/KLOT/KLOT20240605_101026_V06
noaa-nexrad-level2/2024/06/05/KLOT/KLOT20240605_101511_V06
noaa-nexrad-level2/2024/06/05/KLOT/KLOT20240605_101954_V06
noaa-nexrad-level2/2024/06/05/KLOT/KLOT20240605_102531_V06
noaa-nexrad-level2/2024/06/05/KLOT/KLOT20240605_103002_V06
noaa-nexrad-level2/2024/06/05/KLOT/KLOT20240605_103419_V06
noaa-nexrad-level2/2024/06/05/KLOT/KLOT20240605_103829_V06
noaa-nexrad-level2/2024/06/05/KLOT/KLOT20240605_104224_V06
noaa-nexrad-level2/2024/06/05/KLOT/KLOT20240605_104615_V06
noaa-nexrad-level2/2024/06/05/KLOT/KLOT20240605_105007_V06
noaa-nexrad-level2/2024/06/05/KLOT/KLOT20240605_105357_V06
noaa-nexrad-level2/2024/06/05/KLOT/KLOT20240605_105748_V06
noaa-nexrad-level2/2024/06/05/KLOT/KLOT20240605_105748_V06_MDM
noaa-nexrad-level2/2024/06/06/KLOT/KLOT20240606_040136_V06
noaa-nexrad-level2/2024/06/06/KLOT/KLOT20240606_040514_V06
noaa-nexrad-level2/2024/06/06/KLOT/KLOT20240606_040853_V06
noaa-nexrad-level2/2024/06/06/KLOT/KLOT20240606_041232_V06
noaa-nexrad-level2/2024/06/06/KLOT/KLOT20240606_041602_V06
noaa-nexrad-level2/2024/06/06/KLOT/KLOT20240606_041933_V06
noaa-nexrad-level2/2024/06/06/KLOT/KLOT20240606_042316_V06
noaa-nexrad-level2/2024/06/06/KLOT/KLOT20240606_042647_V06
noaa-nexrad-level2/2024/06/06/KLOT/KLOT20240606_043018_V06
noaa-nexrad-level2/2024/06/06/KLOT/KLOT20240606_043349_V06
noaa-nexrad-level2/2024/06/06/KLOT/KLOT20240606_043719_V06
noaa-nexrad-level2/2024/06/06/KLOT/KLOT20240606_044050_V06
noaa-nexrad-level2/2024/06/06/KLOT/KLOT20240606_044420_V06
noaa-nexrad-level2/2024/06/06/KLOT/KLOT20240606_044750_V06
noaa-nexrad-level2/2024/06/06/KLOT/KLOT20240606_045121_V06
noaa-nexrad-level2/2024/06/06/KLOT/KLOT20240606_045452_V06
noaa-nexrad-level2/2024/06/06/KLOT/KLOT20240606_045823_V06
noaa-nexrad-level2/2024/06/06/KLOT/KLOT20240606_045823_V06_MDM
noaa-nexrad-level2/2024/06/06/KLOT/KLOT20240606_050154_V06
noaa-nexrad-level2/2024/06/06/KLOT/KLOT20240606_050526_V06
noaa-nexrad-level2/2024/06/06/KLOT/KLOT20240606_050903_V06
noaa-nexrad-level2/2024/06/06/KLOT/KLOT20240606_051253_V06
noaa-nexrad-level2/2024/06/06/KLOT/KLOT20240606_051631_V06
noaa-nexrad-level2/2024/06/06/KLOT/KLOT20240606_052022_V06
noaa-nexrad-level2/2024/06/06/KLOT/KLOT20240606_052400_V06
noaa-nexrad-level2/2024/06/06/KLOT/KLOT20240606_052737_V06
noaa-nexrad-level2/2024/06/06/KLOT/KLOT20240606_053115_V06
noaa-nexrad-level2/2024/06/06/KLOT/KLOT20240606_053454_V06
noaa-nexrad-level2/2024/06/06/KLOT/KLOT20240606_053832_V06
noaa-nexrad-level2/2024/06/06/KLOT/KLOT20240606_054210_V06
noaa-nexrad-level2/2024/06/06/KLOT/KLOT20240606_054549_V06
noaa-nexrad-level2/2024/06/06/KLOT/KLOT20240606_054927_V06
noaa-nexrad-level2/2024/06/06/KLOT/KLOT20240606_055304_V06
noaa-nexrad-level2/2024/06/06/KLOT/KLOT20240606_055634_V06
noaa-nexrad-level2/2024/06/06/KLOT/KLOT20240606_055959_V06
noaa-nexrad-level2/2024/06/06/KLOT/KLOT20240606_055959_V06_MDM
noaa-nexrad-level2/2024/06/06/KLOT/KLOT20240606_060330_V06
noaa-nexrad-level2/2024/06/06/KLOT/KLOT20240606_060727_V06
noaa-nexrad-level2/2024/06/06/KLOT/KLOT20240606_061058_V06
noaa-nexrad-level2/2024/06/06/KLOT/KLOT20240606_061442_V06
noaa-nexrad-level2/2024/06/06/KLOT/KLOT20240606_061814_V06
noaa-nexrad-level2/2024/06/06/KLOT/KLOT20240606_062143_V06
noaa-nexrad-level2/2024/06/06/KLOT/KLOT20240606_062514_V06
noaa-nexrad-level2/2024/06/06/KLOT/KLOT20240606_062852_V06
noaa-nexrad-level2/2024/06/06/KLOT/KLOT20240606_063231_V06
noaa-nexrad-level2/2024/06/06/KLOT/KLOT20240606_063602_V06
noaa-nexrad-level2/2024/06/06/KLOT/KLOT20240606_063933_V06
noaa-nexrad-level2/2024/06/06/KLOT/KLOT20240606_064304_V06
noaa-nexrad-level2/2024/06/06/KLOT/KLOT20240606_064634_V06
noaa-nexrad-level2/2024/06/06/KLOT/KLOT20240606_065004_V06
noaa-nexrad-level2/2024/06/06/KLOT/KLOT20240606_065334_V06
noaa-nexrad-level2/2024/06/06/KLOT/KLOT20240606_065704_V06
noaa-nexrad-level2/2024/06/06/KLOT/KLOT20240606_065704_V06_MDM
noaa-nexrad-level2/2024/06/06/KLOT/KLOT20240606_070034_V06
noaa-nexrad-level2/2024/06/06/KLOT/KLOT20240606_070403_V06
noaa-nexrad-level2/2024/06/06/KLOT/KLOT20240606_070733_V06
noaa-nexrad-level2/2024/06/06/KLOT/KLOT20240606_071104_V06
noaa-nexrad-level2/2024/06/06/KLOT/KLOT20240606_071442_V06
noaa-nexrad-level2/2024/06/06/KLOT/KLOT20240606_071813_V06
noaa-nexrad-level2/2024/06/06/KLOT/KLOT20240606_072144_V06
noaa-nexrad-level2/2024/06/06/KLOT/KLOT20240606_072516_V06
noaa-nexrad-level2/2024/06/06/KLOT/KLOT20240606_072847_V06
noaa-nexrad-level2/2024/06/06/KLOT/KLOT20240606_073218_V06
noaa-nexrad-level2/2024/06/06/KLOT/KLOT20240606_073916_V06
noaa-nexrad-level2/2024/06/06/KLOT/KLOT20240606_074614_V06
noaa-nexrad-level2/2024/06/06/KLOT/KLOT20240606_075320_V06
noaa-nexrad-level2/2024/06/06/KLOT/KLOT20240606_075320_V06_MDM
noaa-nexrad-level2/2024/06/06/KLOT/KLOT20240606_080025_V06
noaa-nexrad-level2/2024/06/06/KLOT/KLOT20240606_080730_V06
noaa-nexrad-level2/2024/06/06/KLOT/KLOT20240606_081434_V06
noaa-nexrad-level2/2024/06/06/KLOT/KLOT20240606_082139_V06
noaa-nexrad-level2/2024/06/06/KLOT/KLOT20240606_082844_V06
noaa-nexrad-level2/2024/06/06/KLOT/KLOT20240606_083549_V06
noaa-nexrad-level2/2024/06/06/KLOT/KLOT20240606_084253_V06
noaa-nexrad-level2/2024/06/06/KLOT/KLOT20240606_084959_V06
noaa-nexrad-level2/2024/06/06/KLOT/KLOT20240606_085703_V06
noaa-nexrad-level2/2024/06/06/KLOT/KLOT20240606_085703_V06_MDM
noaa-nexrad-level2/2024/06/06/KLOT/KLOT20240606_090348_V06
noaa-nexrad-level2/2024/06/06/KLOT/KLOT20240606_091034_V06
noaa-nexrad-level2/2024/06/06/KLOT/KLOT20240606_091719_V06
noaa-nexrad-level2/2024/06/06/KLOT/KLOT20240606_092404_V06
noaa-nexrad-level2/2024/06/06/KLOT/KLOT20240606_093048_V06
noaa-nexrad-level2/2024/06/06/KLOT/KLOT20240606_093733_V06
noaa-nexrad-level2/2024/06/06/KLOT/KLOT20240606_094438_V06
noaa-nexrad-level2/2024/06/06/KLOT/KLOT20240606_095131_V06
noaa-nexrad-level2/2024/06/06/KLOT/KLOT20240606_095558_V06
noaa-nexrad-level2/2024/06/06/KLOT/KLOT20240606_095558_V06_MDM
noaa-nexrad-level2/2024/06/06/KLOT/KLOT20240606_100038_V06
noaa-nexrad-level2/2024/06/06/KLOT/KLOT20240606_100510_V06
noaa-nexrad-level2/2024/06/06/KLOT/KLOT20240606_100948_V06
noaa-nexrad-level2/2024/06/06/KLOT/KLOT20240606_101427_V06
noaa-nexrad-level2/2024/06/06/KLOT/KLOT20240606_101906_V06
noaa-nexrad-level2/2024/06/06/KLOT/KLOT20240606_102346_V06
noaa-nexrad-level2/2024/06/06/KLOT/KLOT20240606_102825_V06
noaa-nexrad-level2/2024/06/06/KLOT/KLOT20240606_103416_V06
noaa-nexrad-level2/2024/06/06/KLOT/KLOT20240606_103855_V06
noaa-nexrad-level2/2024/06/06/KLOT/KLOT20240606_104334_V06
noaa-nexrad-level2/2024/06/06/KLOT/KLOT20240606_104813_V06
noaa-nexrad-level2/2024/06/06/KLOT/KLOT20240606_105252_V06
noaa-nexrad-level2/2024/06/06/KLOT/KLOT20240606_105731_V06
noaa-nexrad-level2/2024/06/06/KLOT/KLOT20240606_105731_V06_MDM
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">frames</span> <span class="o">=</span> <span class="p">[]</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="optional-setting-up-individual-locations-to-be-plotted-on-your-map">
<h2>OPTIONAL* setting up individual locations to be plotted on your map<a class="headerlink" href="#optional-setting-up-individual-locations-to-be-plotted-on-your-map" title="Link to this heading"><i class="fas fa-link"></i></a></h2>
<p>In this example, two plots are pointed due to their relevance to the example weather event: The ATMOS facility at Argonne National Laboratory, Lemont, IL, and Sawmill Creek in Darien, IL. The latitude and longitude for each site should be placed at the same index (IE. Index 0 in both latitude and longitude should contain the latitude and longitude data for that one site. This also applies to the labels, markers, and colors. Any object in the index 0 slot will apply to that same point.)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">latitude</span> <span class="o">=</span> <span class="p">[</span><span class="mf">41.700937896518866</span><span class="p">,</span> <span class="mf">41.73884644555692</span><span class="p">]</span> 
<span class="n">longitude</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mf">87.99578103231573</span><span class="p">,</span> <span class="o">-</span><span class="mf">87.98744136114946</span><span class="p">]</span>
<span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Tower&#39;</span><span class="p">,</span> <span class="s1">&#39;SCM&#39;</span><span class="p">]</span>
<span class="n">markers</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;v&#39;</span><span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="p">]</span>
<span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="s1">&#39;gray&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="checking-your-plottable-radar-products">
<h2>Checking your plottable radar products<a class="headerlink" href="#checking-your-plottable-radar-products" title="Link to this heading"><i class="fas fa-link"></i></a></h2>
<p>This function reads one of the radar files in your file list and prints out the available products for plotting. One file should represent all products available in each radar file in the list. Although if you are pulling data from files pre 2011, dual-pol products won’t be available.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">check_radar_fields</span><span class="p">(</span><span class="n">file_path</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">fs</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">radar_data</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="n">radar_file</span> <span class="o">=</span> <span class="n">BytesIO</span><span class="p">(</span><span class="n">radar_data</span><span class="p">)</span>
        <span class="n">radar</span> <span class="o">=</span> <span class="n">pyart</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">read_nexrad_archive</span><span class="p">(</span><span class="n">radar_file</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Fields in radar data from </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">:&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">radar</span><span class="o">.</span><span class="n">fields</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to read radar data from </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Check the fields for the first file</span>
<span class="k">if</span> <span class="n">files</span><span class="p">:</span>
    <span class="n">check_radar_fields</span><span class="p">(</span><span class="n">files</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Fields in radar data from noaa-nexrad-level2/2024/06/05/KLOT/KLOT20240605_040442_V06:
[&#39;differential_reflectivity&#39;, &#39;differential_phase&#39;, &#39;velocity&#39;, &#39;spectrum_width&#39;, &#39;clutter_filter_power_removed&#39;, &#39;cross_correlation_ratio&#39;, &#39;reflectivity&#39;]
</pre></div>
</div>
</div>
</div>
</section>
</section>
<hr class="docutils" />
<section class="tex2jax_ignore mathjax_ignore" id="reading-the-data-into-pyart">
<h1>Reading the data into PyART<a class="headerlink" href="#reading-the-data-into-pyart" title="Link to this heading"><i class="fas fa-link"></i></a></h1>
<p>To streamline the process of pulling and processing the radar files, we will create a function called read_radar_data.</p>
<p>Within this function, some progress tracking code is implemented. Each time a file is successfully read, a message will be printed out letting you know what file in the order it is. This is useful to tell if your code is actually working.
An exception is added to this code so that the files marked MDM (shown on the list of filed compiled when pulling data) do not halt the process, and are instead skipped as they are not necessary.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">read_radar_data</span><span class="p">(</span><span class="n">file_path</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">fs</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">radar_data</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="n">radar_file</span> <span class="o">=</span> <span class="n">BytesIO</span><span class="p">(</span><span class="n">radar_data</span><span class="p">)</span>
        <span class="n">radar</span> <span class="o">=</span> <span class="n">pyart</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">read_nexrad_archive</span><span class="p">(</span><span class="n">radar_file</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Successfully read radar data from </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">radar</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to read radar data from </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>
</pre></div>
</div>
</div>
</div>
<section id="looping-through-the-radar-data">
<h2>Looping through the radar data<a class="headerlink" href="#looping-through-the-radar-data" title="Link to this heading"><i class="fas fa-link"></i></a></h2>
<p>This code allows us to loop through each radar file read. A progress message is printed when a new file has started being processed.
The if statement tells the code to skip files that are unable to be read.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">file</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">files</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Processing file </span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">files</span><span class="p">)</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">radar</span> <span class="o">=</span> <span class="n">read_radar_data</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">radar</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Skipping file </span><span class="si">{</span><span class="n">file</span><span class="si">}</span><span class="s2"> due to read error.&quot;</span><span class="p">)</span>
        <span class="k">continue</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Processing file 1/202: noaa-nexrad-level2/2024/06/05/KLOT/KLOT20240605_040442_V06
Successfully read radar data from noaa-nexrad-level2/2024/06/05/KLOT/KLOT20240605_040442_V06
Processing file 2/202: noaa-nexrad-level2/2024/06/05/KLOT/KLOT20240605_040926_V06
</pre></div>
</div>
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">KeyboardInterrupt</span><span class="g g-Whitespace">                         </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">176</span><span class="p">],</span> <span class="n">line</span> <span class="mi">3</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">file</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">files</span><span class="p">):</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span>     <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Processing file </span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">files</span><span class="p">)</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="ne">----&gt; </span><span class="mi">3</span>     <span class="n">radar</span> <span class="o">=</span> <span class="n">read_radar_data</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span>     <span class="k">if</span> <span class="n">radar</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span>         <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Skipping file </span><span class="si">{</span><span class="n">file</span><span class="si">}</span><span class="s2"> due to read error.&quot;</span><span class="p">)</span>

<span class="nn">Cell In[161], line 6,</span> in <span class="ni">read_radar_data</span><span class="nt">(file_path)</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span>     <span class="n">radar_data</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span> <span class="n">radar_file</span> <span class="o">=</span> <span class="n">BytesIO</span><span class="p">(</span><span class="n">radar_data</span><span class="p">)</span>
<span class="ne">----&gt; </span><span class="mi">6</span> <span class="n">radar</span> <span class="o">=</span> <span class="n">pyart</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">read_nexrad_archive</span><span class="p">(</span><span class="n">radar_file</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">7</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Successfully read radar data from </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">8</span> <span class="k">return</span> <span class="n">radar</span>

<span class="nn">File ~\anaconda3\envs\crocusenv\Lib\site-packages\pyart\io\nexrad_archive.py:228,</span> in <span class="ni">read_nexrad_archive</span><span class="nt">(filename, field_names, additional_metadata, file_field_names, exclude_fields, include_fields, delay_field_loading, station, scans, linear_interp, storage_options, **kwargs)</span>
<span class="g g-Whitespace">    </span><span class="mi">226</span>     <span class="n">dic</span><span class="o">.</span><span class="n">set_lazy</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="n">data_call</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">227</span> <span class="k">else</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">228</span>     <span class="n">mdata</span> <span class="o">=</span> <span class="n">nfile</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="n">moment</span><span class="p">,</span> <span class="n">max_ngates</span><span class="p">,</span> <span class="n">scans</span><span class="o">=</span><span class="n">scans</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">229</span>     <span class="k">if</span> <span class="n">moment</span> <span class="ow">in</span> <span class="n">interpolate</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">230</span>         <span class="n">interp_scans</span> <span class="o">=</span> <span class="n">interpolate</span><span class="p">[</span><span class="n">moment</span><span class="p">]</span>

<span class="nn">File ~\anaconda3\envs\crocusenv\Lib\site-packages\pyart\io\nexrad_level2.py:536,</span> in <span class="ni">NEXRADLevel2File.get_data</span><span class="nt">(self, moment, max_ngates, scans, raw_data)</span>
<span class="g g-Whitespace">    </span><span class="mi">533</span>         <span class="n">set_datatype</span> <span class="o">=</span> <span class="kc">True</span>
<span class="g g-Whitespace">    </span><span class="mi">535</span>     <span class="n">ngates</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">msg</span><span class="p">[</span><span class="n">moment</span><span class="p">][</span><span class="s2">&quot;ngates&quot;</span><span class="p">],</span> <span class="n">max_ngates</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">msg</span><span class="p">[</span><span class="n">moment</span><span class="p">][</span><span class="s2">&quot;data&quot;</span><span class="p">]))</span>
<span class="ne">--&gt; </span><span class="mi">536</span>     <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:</span><span class="n">ngates</span><span class="p">]</span> <span class="o">=</span> <span class="n">msg</span><span class="p">[</span><span class="n">moment</span><span class="p">][</span><span class="s2">&quot;data&quot;</span><span class="p">][:</span><span class="n">ngates</span><span class="p">]</span>
<span class="g g-Whitespace">    </span><span class="mi">537</span> <span class="c1"># return raw data if requested</span>
<span class="g g-Whitespace">    </span><span class="mi">538</span> <span class="k">if</span> <span class="n">raw_data</span><span class="p">:</span>

<span class="ne">KeyboardInterrupt</span>: 
</pre></div>
</div>
</div>
</div>
</section>
<section id="plotting-code-with-added-features-and-plotted-points">
<h2>Plotting code with added features and plotted points<a class="headerlink" href="#plotting-code-with-added-features-and-plotted-points" title="Link to this heading"><i class="fas fa-link"></i></a></h2>
<p>The radar product being plotted can be changed based on the needs of the individual, but for this example, we will use reflectivity to make a singular gif.</p>
</section>
<section id="customizing-the-range-of-plotted-data">
<h2>Customizing the range of plotted data<a class="headerlink" href="#customizing-the-range-of-plotted-data" title="Link to this heading"><i class="fas fa-link"></i></a></h2>
<p>Vmin and vmax represent the range of dBz values you’d like to plot on the radar. Sometimes, one may want to raise the lower limit to reduce clutter or nonmeteorological scatter that often appears as low reflectivity blobs near the radar. Basically the maximum and minimum values for your colorbar as well.</p>
<p>The sweep is the elevation being scanned. For example, sweep 0 is the lowest level scanned by the radar.</p>
</section>
<section id="counties">
<h2>Counties<a class="headerlink" href="#counties" title="Link to this heading"><i class="fas fa-link"></i></a></h2>
<p>Counties can be added with the ax.add_feature line. Further additions can be made using cartopy.cfeature if needed.</p>
</section>
<section id="location-plotting">
<h2>Location plotting<a class="headerlink" href="#location-plotting" title="Link to this heading"><i class="fas fa-link"></i></a></h2>
<p>The for loop in this cell is used to plot the location data provided in the aforementioned variables.</p>
</section>
<section id="zooming">
<h2>Zooming<a class="headerlink" href="#zooming" title="Link to this heading"><i class="fas fa-link"></i></a></h2>
<p>The x and ylim functions will allow you to control the zoom on your plot. The grid on the plot is representative of latitude (y) and longitude (x) lines. For this example, we are zoomed in over the points.</p>
</section>
<section id="colorbar">
<h2>Colorbar<a class="headerlink" href="#colorbar" title="Link to this heading"><i class="fas fa-link"></i></a></h2>
<p>The built in colorbar is disabled and one was created manually to make it fit the image better. Purely an aesthetic decision.</p>
</section>
<section id="note">
<h2>NOTE<a class="headerlink" href="#note" title="Link to this heading"><i class="fas fa-link"></i></a></h2>
<p>This code is meant to go under the for loop. Don’t run it on its own as it won’t work as intended. Full code block will be below</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">12</span><span class="p">,</span> <span class="mi">8</span><span class="p">])</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">())</span>
<span class="n">display</span> <span class="o">=</span> <span class="n">pyart</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">RadarMapDisplay</span><span class="p">(</span><span class="n">radar</span><span class="p">)</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">display</span><span class="o">.</span><span class="n">plot_ppi_map</span><span class="p">(</span><span class="s1">&#39;reflectivity&#39;</span><span class="p">,</span>
                         <span class="n">sweep</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                         <span class="n">vmin</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                         <span class="n">vmax</span><span class="o">=</span><span class="mi">65</span><span class="p">,</span>
                         <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
                         <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Z for </span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">file</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
                         <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;pyart_ChaseSpectral&#39;</span><span class="p">,</span>
                         <span class="n">colorbar_flag</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>  <span class="c1"># Disable the built-in colorbar</span>
    <span class="n">mappable</span> <span class="o">=</span> <span class="n">display</span><span class="o">.</span><span class="n">plots</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error plotting radar data for file </span><span class="si">{</span><span class="n">file</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
    <span class="k">continue</span>

<span class="c1"># Set the extent to zoom in much closer and centered on the points</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="o">-</span><span class="mf">88.1</span><span class="p">,</span> <span class="o">-</span><span class="mf">87.8</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mf">41.6</span><span class="p">,</span> <span class="mf">41.8</span><span class="p">)</span>

<span class="c1"># Add counties</span>
<span class="n">ax</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">USCOUNTIES</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

<span class="k">for</span> <span class="n">lat</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">marker</span><span class="p">,</span> <span class="n">color</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">latitude</span><span class="p">,</span> <span class="n">longitude</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">markers</span><span class="p">,</span> <span class="n">colors</span><span class="p">):</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">marker</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

<span class="c1"># Create a colorbar manually</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">cbar</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">mappable</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;vertical&#39;</span><span class="p">,</span> <span class="n">fraction</span><span class="o">=</span><span class="mf">0.046</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.04</span><span class="p">)</span>
<span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s1">&#39;equivalent reflectivity factor (dBZ)&#39;</span><span class="p">)</span>

<span class="c1"># Save the plot to a file</span>
<span class="n">filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;radar_frame_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">.png&#39;</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper right&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="s1">&#39;large&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Locations&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>

<span class="c1"># Add the file to the frames list</span>
<span class="n">frames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Saved frame </span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">files</span><span class="p">)</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="full-code-block-constructed-properly-within-the-for-loop">
<h2>Full code block constructed properly within the for loop.<a class="headerlink" href="#full-code-block-constructed-properly-within-the-for-loop" title="Link to this heading"><i class="fas fa-link"></i></a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">file</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">files</span><span class="p">):</span>
    <span class="n">radar</span> <span class="o">=</span> <span class="n">read_radar_data</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">radar</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Skipping file </span><span class="si">{</span><span class="n">file</span><span class="si">}</span><span class="s2"> due to read error.&quot;</span><span class="p">)</span>
        <span class="k">continue</span>

    <span class="c1"># Create a plot for the first sweep&#39;s reflectivity</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">12</span><span class="p">,</span> <span class="mi">8</span><span class="p">])</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">())</span>
    <span class="n">display</span> <span class="o">=</span> <span class="n">pyart</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">RadarMapDisplay</span><span class="p">(</span><span class="n">radar</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">display</span><span class="o">.</span><span class="n">plot_ppi_map</span><span class="p">(</span><span class="s1">&#39;reflectivity&#39;</span><span class="p">,</span>
                             <span class="n">sweep</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                             <span class="n">vmin</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                             <span class="n">vmax</span><span class="o">=</span><span class="mi">65</span><span class="p">,</span>
                             <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
                             <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Z for </span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">file</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
                             <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;pyart_ChaseSpectral&#39;</span><span class="p">,</span>
                             <span class="n">colorbar_flag</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>  <span class="c1"># Disable the built-in colorbar</span>
        <span class="n">mappable</span> <span class="o">=</span> <span class="n">display</span><span class="o">.</span><span class="n">plots</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error plotting radar data for file </span><span class="si">{</span><span class="n">file</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
        <span class="k">continue</span>

    <span class="c1"># Set the extent to zoom in much closer and centered on the points</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="o">-</span><span class="mf">88.2</span><span class="p">,</span> <span class="o">-</span><span class="mf">87.7</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mf">41.5</span><span class="p">,</span> <span class="mf">41.9</span><span class="p">)</span>

    <span class="c1"># Add counties</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">USCOUNTIES</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">lat</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">marker</span><span class="p">,</span> <span class="n">color</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">latitude</span><span class="p">,</span> <span class="n">longitude</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">markers</span><span class="p">,</span> <span class="n">colors</span><span class="p">):</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">marker</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

    <span class="c1"># Create a colorbar manually</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">cbar</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">mappable</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;vertical&#39;</span><span class="p">,</span> <span class="n">fraction</span><span class="o">=</span><span class="mf">0.046</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.04</span><span class="p">)</span>
    <span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s1">&#39;equivalent reflectivity factor (dBZ)&#39;</span><span class="p">)</span>

    <span class="c1"># Save the plot to a file</span>
    <span class="n">filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;radar_frame_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">.png&#39;</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper right&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="s1">&#39;large&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Locations&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>

    <span class="c1"># Add the file to the frames list</span>
    <span class="n">frames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Saved frame </span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">files</span><span class="p">)</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Successfully read radar data from noaa-nexrad-level2/2024/06/05/KLOT/KLOT20240605_040442_V06
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>KeyboardInterrupt
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Error in callback &lt;function _draw_all_if_interactive at 0x00000137D2FF09A0&gt; (for post_execute), with arguments args (),kwargs {}:
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>KeyboardInterrupt
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Error in callback &lt;function flush_figures at 0x00000137DD1DE980&gt; (for post_execute), with arguments args (),kwargs {}:
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>KeyboardInterrupt
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="gif-creation">
<h1>GIF creation<a class="headerlink" href="#gif-creation" title="Link to this heading"><i class="fas fa-link"></i></a></h1>
<p>We can now use the data to create a gif out of the frames we’ve appended to our list.</p>
<p>This code also includes code to save the gif to your local directory.</p>
<p>Something to note, if you do not want to save the gif, you can get rid of this code.</p>
<p>As the frames are processed, they will temporarily save to your directory until the gif is made. They will save as PNG files, which are able to be opened and can be used to make sure everything is plotting on your figure correctly.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create an animated GIF using Pillow</span>
<span class="k">if</span> <span class="n">frames</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Creating animated GIF...&quot;</span><span class="p">)</span>
    <span class="n">images</span> <span class="o">=</span> <span class="p">[</span><span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span> <span class="k">for</span> <span class="n">frame</span> <span class="ow">in</span> <span class="n">frames</span><span class="p">]</span>
    <span class="n">images</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s1">&#39;radar_animation.gif&#39;</span><span class="p">,</span> <span class="n">save_all</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">append_images</span><span class="o">=</span><span class="n">images</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">duration</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">loop</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># duration in milliseconds</span>

    <span class="c1"># Clean up the saved frames</span>
    <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">frames</span><span class="p">:</span>
        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Animated GIF created as &#39;radar_animation.gif&#39;&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No frames were generated.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Creating animated GIF...
Animated GIF created as &#39;radar_animation.gif&#39;
</pre></div>
</div>
</div>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="code-in-whole">
<h1>Code in whole<a class="headerlink" href="#code-in-whole" title="Link to this heading"><i class="fas fa-link"></i></a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pyart</span>
<span class="kn">import</span> <span class="nn">fsspec</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">io</span> <span class="kn">import</span> <span class="n">BytesIO</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">import</span> <span class="nn">cartopy.crs</span> <span class="k">as</span> <span class="nn">ccrs</span>
<span class="kn">from</span> <span class="nn">metpy.plots</span> <span class="kn">import</span> <span class="n">USCOUNTIES</span>
<span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span>
<span class="kn">from</span> <span class="nn">mpl_toolkits.axes_grid1</span> <span class="kn">import</span> <span class="n">make_axes_locatable</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span>

<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>

<span class="n">fs</span> <span class="o">=</span> <span class="n">fsspec</span><span class="o">.</span><span class="n">filesystem</span><span class="p">(</span><span class="s2">&quot;s3&quot;</span><span class="p">,</span> <span class="n">anon</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Define the start and end dates and hours</span>
<span class="n">start_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">(</span><span class="mi">2024</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>  <span class="c1"># YYYY/MM/DD HH</span>
<span class="n">end_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">(</span><span class="mi">2024</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>   <span class="c1"># YYYY/MM/DD HH</span>
<span class="n">station</span> <span class="o">=</span> <span class="s1">&#39;KLOT&#39;</span>
<span class="n">latitude</span> <span class="o">=</span> <span class="p">[</span><span class="mf">41.700937896518866</span><span class="p">,</span> <span class="mf">41.704120</span><span class="p">]</span>
<span class="n">longitude</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mf">87.99578103231573</span><span class="p">,</span> <span class="o">-</span><span class="mf">87.968328</span><span class="p">]</span>
<span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Tower&#39;</span><span class="p">,</span> <span class="s1">&#39;SCM&#39;</span><span class="p">]</span>
<span class="n">markers</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;v&#39;</span><span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="p">]</span>
<span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;pink&#39;</span><span class="p">,</span> <span class="s1">&#39;cyan&#39;</span><span class="p">]</span>

<span class="c1"># Generate the list of files for the specified date and hour range</span>
<span class="n">files</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">current_date</span> <span class="o">=</span> <span class="n">start_date</span>
<span class="k">while</span> <span class="n">current_date</span> <span class="o">&lt;=</span> <span class="n">end_date</span><span class="p">:</span>
    <span class="n">date_str</span> <span class="o">=</span> <span class="n">current_date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y/%m/</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">date_str_compact</span> <span class="o">=</span> <span class="n">current_date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y%m</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">hour</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">start_date</span><span class="o">.</span><span class="n">hour</span><span class="p">,</span> <span class="n">end_date</span><span class="o">.</span><span class="n">hour</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">hour_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">hour</span><span class="si">:</span><span class="s2">02d</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">files</span> <span class="o">+=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">fs</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;s3://noaa-nexrad-level2/</span><span class="si">{</span><span class="n">date_str</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">station</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">station</span><span class="si">}{</span><span class="n">date_str_compact</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">hour_str</span><span class="si">}</span><span class="s2">*&quot;</span><span class="p">))</span>
    <span class="n">current_date</span> <span class="o">+=</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># Print the selected files</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Selected files:&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>

<span class="c1"># Check and print the fields in the first radar file</span>
<span class="k">def</span> <span class="nf">check_radar_fields</span><span class="p">(</span><span class="n">file_path</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">fs</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">radar_data</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="n">radar_file</span> <span class="o">=</span> <span class="n">BytesIO</span><span class="p">(</span><span class="n">radar_data</span><span class="p">)</span>
        <span class="n">radar</span> <span class="o">=</span> <span class="n">pyart</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">read_nexrad_archive</span><span class="p">(</span><span class="n">radar_file</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Fields in radar data from </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">:&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">radar</span><span class="o">.</span><span class="n">fields</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to read radar data from </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Check the fields for the first file</span>
<span class="k">if</span> <span class="n">files</span><span class="p">:</span>
    <span class="n">check_radar_fields</span><span class="p">(</span><span class="n">files</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

<span class="c1"># Function to read radar data</span>
<span class="k">def</span> <span class="nf">read_radar_data</span><span class="p">(</span><span class="n">file_path</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">fs</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">radar_data</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="n">radar_file</span> <span class="o">=</span> <span class="n">BytesIO</span><span class="p">(</span><span class="n">radar_data</span><span class="p">)</span>
        <span class="n">radar</span> <span class="o">=</span> <span class="n">pyart</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">read_nexrad_archive</span><span class="p">(</span><span class="n">radar_file</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Successfully read radar data from </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">radar</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to read radar data from </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>

<span class="c1"># Create frames for the animated GIF</span>
<span class="n">frames</span> <span class="o">=</span> <span class="p">[]</span>

<span class="c1"># Loop through each radar file</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">file</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">files</span><span class="p">):</span>
    <span class="n">radar</span> <span class="o">=</span> <span class="n">read_radar_data</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">radar</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Skipping file </span><span class="si">{</span><span class="n">file</span><span class="si">}</span><span class="s2"> due to read error.&quot;</span><span class="p">)</span>
        <span class="k">continue</span>

    <span class="c1"># Create a plot for the first sweep&#39;s reflectivity</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">12</span><span class="p">,</span> <span class="mi">8</span><span class="p">])</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">())</span>
    <span class="n">display</span> <span class="o">=</span> <span class="n">pyart</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">RadarMapDisplay</span><span class="p">(</span><span class="n">radar</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">display</span><span class="o">.</span><span class="n">plot_ppi_map</span><span class="p">(</span><span class="s1">&#39;reflectivity&#39;</span><span class="p">,</span>
                             <span class="n">sweep</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                             <span class="n">vmin</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                             <span class="n">vmax</span><span class="o">=</span><span class="mi">65</span><span class="p">,</span>
                             <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
                             <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Z for </span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">file</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
                             <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;pyart_ChaseSpectral&#39;</span><span class="p">,</span>
                             <span class="n">colorbar_flag</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>  <span class="c1"># Disable the built-in colorbar</span>
        <span class="n">mappable</span> <span class="o">=</span> <span class="n">display</span><span class="o">.</span><span class="n">plots</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error plotting radar data for file </span><span class="si">{</span><span class="n">file</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
        <span class="k">continue</span>

    <span class="c1"># Set the extent to zoom in much closer and centered on the points</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="o">-</span><span class="mf">88.2</span><span class="p">,</span> <span class="o">-</span><span class="mf">87.7</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mf">41.5</span><span class="p">,</span> <span class="mf">41.9</span><span class="p">)</span>

    <span class="c1"># Add counties</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">USCOUNTIES</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">lat</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">marker</span><span class="p">,</span> <span class="n">color</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">latitude</span><span class="p">,</span> <span class="n">longitude</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">markers</span><span class="p">,</span> <span class="n">colors</span><span class="p">):</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">marker</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

    <span class="c1"># Create a colorbar manually</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">cbar</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">mappable</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;vertical&#39;</span><span class="p">,</span> <span class="n">fraction</span><span class="o">=</span><span class="mf">0.046</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.04</span><span class="p">)</span>
    <span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s1">&#39;equivalent reflectivity factor (dBZ)&#39;</span><span class="p">)</span>

    <span class="c1"># Save the plot to a file</span>
    <span class="n">filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;radar_frame_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">.png&#39;</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper right&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="s1">&#39;large&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Locations&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>

    <span class="c1"># Add the file to the frames list</span>
    <span class="n">frames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Saved frame </span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">files</span><span class="p">)</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Create an animated GIF using Pillow</span>
<span class="k">if</span> <span class="n">frames</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Creating animated GIF...&quot;</span><span class="p">)</span>
    <span class="n">images</span> <span class="o">=</span> <span class="p">[</span><span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span> <span class="k">for</span> <span class="n">frame</span> <span class="ow">in</span> <span class="n">frames</span><span class="p">]</span>
    <span class="n">images</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s1">&#39;radar_animation.gif&#39;</span><span class="p">,</span> <span class="n">save_all</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">append_images</span><span class="o">=</span><span class="n">images</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">duration</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">loop</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># duration in milliseconds</span>

    <span class="c1"># Clean up the saved frames</span>
    <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">frames</span><span class="p">:</span>
        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Animated GIF created as &#39;radar_animation.gif&#39;&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No frames were generated.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<hr class="docutils" />
<section class="tex2jax_ignore mathjax_ignore" id="making-gifs-of-other-analysis-products-such-as-feature-detection">
<h1>Making GIFs of other analysis products such as feature detection<a class="headerlink" href="#making-gifs-of-other-analysis-products-such-as-feature-detection" title="Link to this heading"><i class="fas fa-link"></i></a></h1>
<section id="now-that-we-know-how-to-create-animated-gifs-through-use-of-basic-python-syntax-and-the-py-art-package-we-will-learn-how-to-create-gifs-of-more-obscure-products-such-as-feature-detection">
<h2>Now that we know how to create animated gifs through use of basic python syntax and the Py-ART package, we will learn how to create GIFs of more obscure products such as feature detection.<a class="headerlink" href="#now-that-we-know-how-to-create-animated-gifs-through-use-of-basic-python-syntax-and-the-py-art-package-we-will-learn-how-to-create-gifs-of-more-obscure-products-such-as-feature-detection" title="Link to this heading"><i class="fas fa-link"></i></a></h2>
<section id="if-you-would-like-to-know-more-about-how-feature-detection-in-py-art-works-and-what-exactly-it-does-in-detail-visit-https-arm-doe-github-io-pyart-examples-retrieve-plot-convective-stratiform-html">
<h3>If you would like to know more about how feature detection in Py-ART works and what exactly it does in detail, visit https://arm-doe.github.io/pyart/examples/retrieve/plot_convective_stratiform.html<a class="headerlink" href="#if-you-would-like-to-know-more-about-how-feature-detection-in-py-art-works-and-what-exactly-it-does-in-detail-visit-https-arm-doe-github-io-pyart-examples-retrieve-plot-convective-stratiform-html" title="Link to this heading"><i class="fas fa-link"></i></a></h3>
</section>
</section>
<section id="imports">
<h2>Imports<a class="headerlink" href="#imports" title="Link to this heading"><i class="fas fa-link"></i></a></h2>
<p>Import the following packages, should be very similar to the ones above</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pyart</span>
<span class="kn">import</span> <span class="nn">fsspec</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">io</span> <span class="kn">import</span> <span class="n">BytesIO</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">import</span> <span class="nn">cartopy.crs</span> <span class="k">as</span> <span class="nn">ccrs</span>
<span class="kn">from</span> <span class="nn">metpy.plots</span> <span class="kn">import</span> <span class="n">USCOUNTIES</span>
<span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.colors</span> <span class="k">as</span> <span class="nn">mcolors</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<section id="we-will-use-most-of-the-same-code-for-setting-up-the-date-selection-file-grabbing-and-station-selection-stuff-so-it-will-just-be-posted-as-one-block-the-function-to-read-the-files-is-also-the-same">
<h3>We will use most of the same code for setting up the date selection, file grabbing, and station selection stuff, so it will just be posted as one block. The function to read the files is also the same.<a class="headerlink" href="#we-will-use-most-of-the-same-code-for-setting-up-the-date-selection-file-grabbing-and-station-selection-stuff-so-it-will-just-be-posted-as-one-block-the-function-to-read-the-files-is-also-the-same" title="Link to this heading"><i class="fas fa-link"></i></a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">start_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">(</span><span class="mi">2024</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>  <span class="c1"># example start date</span>
<span class="n">end_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">(</span><span class="mi">2024</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>    <span class="c1"># example end date</span>
<span class="n">station</span> <span class="o">=</span> <span class="s1">&#39;KLOT&#39;</span>

<span class="c1"># Generate the list of files for the specified date and hour range</span>
<span class="n">files</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">current_time</span> <span class="o">=</span> <span class="n">start_date</span>
<span class="k">while</span> <span class="n">current_time</span> <span class="o">&lt;=</span> <span class="n">end_date</span><span class="p">:</span>
    <span class="n">date_str</span> <span class="o">=</span> <span class="n">current_time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y/%m/</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">datetime_str</span> <span class="o">=</span> <span class="n">current_time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y%m</span><span class="si">%d</span><span class="s2">_%H&quot;</span><span class="p">)</span>
    <span class="n">hour_str</span> <span class="o">=</span> <span class="n">current_time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%H&quot;</span><span class="p">)</span>
    <span class="n">files</span> <span class="o">+=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">fs</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;s3://noaa-nexrad-level2/</span><span class="si">{</span><span class="n">date_str</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">station</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">station</span><span class="si">}{</span><span class="n">datetime_str</span><span class="si">}</span><span class="s2">*&quot;</span><span class="p">))</span>
    <span class="n">current_time</span> <span class="o">+=</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># Print the selected files</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Selected files:&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>

<span class="n">latitude</span> <span class="o">=</span> <span class="p">[</span><span class="mf">41.700937896518866</span><span class="p">,</span> <span class="mf">41.704120</span><span class="p">]</span>
<span class="n">longitude</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mf">87.99578103231573</span><span class="p">,</span> <span class="o">-</span><span class="mf">87.968328</span><span class="p">]</span>
<span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Tower&#39;</span><span class="p">,</span> <span class="s1">&#39;SCM&#39;</span><span class="p">]</span>
<span class="n">markers</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;v&#39;</span><span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="p">]</span>
<span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;cyan&#39;</span><span class="p">,</span> <span class="s1">&#39;magenta&#39;</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">read_radar_data</span><span class="p">(</span><span class="n">file_path</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">fs</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">radar_data</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="n">radar_file</span> <span class="o">=</span> <span class="n">BytesIO</span><span class="p">(</span><span class="n">radar_data</span><span class="p">)</span>
        <span class="n">radar</span> <span class="o">=</span> <span class="n">pyart</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">read_nexrad_archive</span><span class="p">(</span><span class="n">radar_file</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Successfully read radar data from </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">radar</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to read radar data from </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>
<span class="n">frames</span> <span class="o">=</span> <span class="p">[]</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="the-loop-made-to-parse-through-the-files-is-also-similar-but-we-will-instead-set-up-our-for-loop-to-extract-the-scanning-elevation-in-question-and-interpolate-it-into-a-grid-to-use-for-the-feature-detection-algorithm">
<h3>The loop made to parse through the files is also similar, but we will instead set up our for loop to extract the scanning elevation in question, and interpolate it into a grid to use for the feature detection algorithm<a class="headerlink" href="#the-loop-made-to-parse-through-the-files-is-also-similar-but-we-will-instead-set-up-our-for-loop-to-extract-the-scanning-elevation-in-question-and-interpolate-it-into-a-grid-to-use-for-the-feature-detection-algorithm" title="Link to this heading"><i class="fas fa-link"></i></a></h3>
<p>Reflectivity will be used as a comparison to the algorithm. This can be changed by editing the field_name variable and selecting from the available fields listed previously.</p>
<p>Data is masked so that we dont see any areas with either no echo, or weak echoes, that would otherwise be denoted as 0 and 3 respectively.</p>
<p>The resolution of the frames are 300 dpi each, but this can be changed to higher or lower values (Higher DPI will create a more intensive load and will take longer to
complete)</p>
<p>If you would like to change the radar scanning elevation analyzed, you can change the index specified in “radar = radar.extract_sweeps([0])”</p>
<p>Other parameters such as colormaps and the extent shown on a figure can be changed to fit ones specific needs as well.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">file</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">files</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Processing file </span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">files</span><span class="p">)</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="c1"># Read radar data</span>
    <span class="n">radar</span> <span class="o">=</span> <span class="n">read_radar_data</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">radar</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Skipping file </span><span class="si">{</span><span class="n">file</span><span class="si">}</span><span class="s2"> due to read error.&quot;</span><span class="p">)</span>
        <span class="k">continue</span>

    <span class="c1"># List available fields</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Available fields in radar data: </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="n">radar</span><span class="o">.</span><span class="n">fields</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Use a suitable field name based on available fields</span>
    <span class="n">field_name</span> <span class="o">=</span> <span class="s2">&quot;reflectivity&quot;</span>  <span class="c1"># Use &#39;reflectivity&#39; as the common field name</span>

    <span class="c1"># Extract the lowest sweep</span>
    <span class="n">radar</span> <span class="o">=</span> <span class="n">radar</span><span class="o">.</span><span class="n">extract_sweeps</span><span class="p">([</span><span class="mi">0</span><span class="p">])</span>

    <span class="c1"># Interpolate to grid</span>
    <span class="n">grid</span> <span class="o">=</span> <span class="n">pyart</span><span class="o">.</span><span class="n">map</span><span class="o">.</span><span class="n">grid_from_radars</span><span class="p">(</span>
        <span class="p">(</span><span class="n">radar</span><span class="p">,),</span>
        <span class="n">grid_shape</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">201</span><span class="p">,</span> <span class="mi">201</span><span class="p">),</span>
        <span class="n">grid_limits</span><span class="o">=</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10000</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mf">50000.0</span><span class="p">,</span> <span class="mf">50000.0</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mf">50000.0</span><span class="p">,</span> <span class="mf">50000.0</span><span class="p">)),</span>
        <span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="n">field_name</span><span class="p">],</span>
    <span class="p">)</span>

    <span class="c1"># Get dx dy</span>
    <span class="n">dx</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">grid</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">dy</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">grid</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

    <span class="c1"># Feature detection</span>
    <span class="n">feature_dict</span> <span class="o">=</span> <span class="n">pyart</span><span class="o">.</span><span class="n">retrieve</span><span class="o">.</span><span class="n">feature_detection</span><span class="p">(</span>
        <span class="n">grid</span><span class="p">,</span>
        <span class="n">dx</span><span class="p">,</span>
        <span class="n">dy</span><span class="p">,</span>
        <span class="n">field</span><span class="o">=</span><span class="n">field_name</span><span class="p">,</span>
        <span class="n">always_core_thres</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span>
        <span class="n">bkg_rad_km</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
        <span class="n">use_cosine</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">max_diff</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
        <span class="n">zero_diff_cos_val</span><span class="o">=</span><span class="mi">55</span><span class="p">,</span>
        <span class="n">weak_echo_thres</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
        <span class="n">max_rad_km</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># Add to grid object</span>
    <span class="c1"># Mask zero values (no surface echo)</span>
    <span class="n">feature_masked</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_equal</span><span class="p">(</span><span class="n">feature_dict</span><span class="p">[</span><span class="s2">&quot;feature_detection&quot;</span><span class="p">][</span><span class="s2">&quot;data&quot;</span><span class="p">],</span> <span class="mi">0</span><span class="p">)</span>
    <span class="c1"># Mask 3 values (weak echo)</span>
    <span class="n">feature_masked</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_equal</span><span class="p">(</span><span class="n">feature_masked</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
    <span class="c1"># Add dimension to array to add to grid object</span>
    <span class="n">feature_dict</span><span class="p">[</span><span class="s2">&quot;feature_detection&quot;</span><span class="p">][</span><span class="s2">&quot;data&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">feature_masked</span>
    <span class="c1"># Add field</span>
    <span class="n">grid</span><span class="o">.</span><span class="n">add_field</span><span class="p">(</span>
        <span class="s2">&quot;feature_detection&quot;</span><span class="p">,</span> <span class="n">feature_dict</span><span class="p">[</span><span class="s2">&quot;feature_detection&quot;</span><span class="p">],</span> <span class="n">replace_existing</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">)</span>

    <span class="c1"># Create plot using GridMapDisplay</span>
    <span class="c1"># Plot variables</span>
    <span class="n">display</span> <span class="o">=</span> <span class="n">pyart</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">GridMapDisplay</span><span class="p">(</span><span class="n">grid</span><span class="p">)</span>
    <span class="n">magma_r_cmap</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s2">&quot;pyart_ChaseSpectral&quot;</span><span class="p">)</span>
    <span class="n">ref_cmap</span> <span class="o">=</span> <span class="n">mcolors</span><span class="o">.</span><span class="n">LinearSegmentedColormap</span><span class="o">.</span><span class="n">from_list</span><span class="p">(</span>
        <span class="s2">&quot;ref_cmap&quot;</span><span class="p">,</span> <span class="n">magma_r_cmap</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">,</span> <span class="n">magma_r_cmap</span><span class="o">.</span><span class="n">N</span><span class="p">))</span>
    <span class="p">)</span>
    <span class="n">projection</span> <span class="o">=</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">AlbersEqualArea</span><span class="p">(</span>
        <span class="n">central_latitude</span><span class="o">=</span><span class="n">radar</span><span class="o">.</span><span class="n">latitude</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
        <span class="n">central_longitude</span><span class="o">=</span><span class="n">radar</span><span class="o">.</span><span class="n">longitude</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
    <span class="p">)</span>

    <span class="c1"># Plot</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">12</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
    <span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="n">projection</span><span class="p">)</span>
    <span class="n">display</span><span class="o">.</span><span class="n">plot_grid</span><span class="p">(</span>
        <span class="n">field_name</span><span class="p">,</span>
        <span class="n">vmin</span><span class="o">=</span><span class="mi">9</span><span class="p">,</span>
        <span class="n">vmax</span><span class="o">=</span><span class="mi">65</span><span class="p">,</span>
        <span class="n">cmap</span><span class="o">=</span><span class="n">ref_cmap</span><span class="p">,</span>
        <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span>
        <span class="n">ax</span><span class="o">=</span><span class="n">ax1</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">ax2</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="n">projection</span><span class="p">)</span>
    <span class="n">display</span><span class="o">.</span><span class="n">plot_grid</span><span class="p">(</span>
        <span class="s2">&quot;feature_detection&quot;</span><span class="p">,</span>
        <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">vmax</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
        <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s2">&quot;viridis&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
        <span class="n">ax</span><span class="o">=</span><span class="n">ax2</span><span class="p">,</span>
        <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span>
        <span class="n">ticks</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span> <span class="o">/</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span> <span class="o">/</span> <span class="mi">3</span><span class="p">],</span>
        <span class="n">ticklabs</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;Stratiform&quot;</span><span class="p">,</span> <span class="s2">&quot;Convective&quot;</span><span class="p">],</span>
    <span class="p">)</span>

    <span class="c1"># Set the extent to zoom out slightly</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_extent</span><span class="p">([</span><span class="o">-</span><span class="mf">88.3</span><span class="p">,</span> <span class="o">-</span><span class="mf">87.7</span><span class="p">,</span> <span class="mf">41.5</span><span class="p">,</span> <span class="mf">42.0</span><span class="p">],</span> <span class="n">crs</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">())</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_extent</span><span class="p">([</span><span class="o">-</span><span class="mf">88.3</span><span class="p">,</span> <span class="o">-</span><span class="mf">87.7</span><span class="p">,</span> <span class="mf">41.5</span><span class="p">,</span> <span class="mf">42.0</span><span class="p">],</span> <span class="n">crs</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">())</span>

    <span class="c1"># Add counties</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">USCOUNTIES</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">USCOUNTIES</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">lat</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">marker</span><span class="p">,</span> <span class="n">color</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">latitude</span><span class="p">,</span> <span class="n">longitude</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">markers</span><span class="p">,</span> <span class="n">colors</span><span class="p">):</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">marker</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">marker</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>

    <span class="c1"># Save the plot to a file</span>
    <span class="n">filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;detection_frame_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">.png&#39;</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper right&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="s1">&#39;large&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Locations&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>

    <span class="c1"># Add the file to the frames list</span>
    <span class="n">frames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Saved frame </span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">files</span><span class="p">)</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="id1">
<h2>GIF creation<a class="headerlink" href="#id1" title="Link to this heading"><i class="fas fa-link"></i></a></h2>
<p>The same method is used to create a GIF out of the frames</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">frames</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Creating animated GIF...&quot;</span><span class="p">)</span>
    <span class="n">images</span> <span class="o">=</span> <span class="p">[</span><span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span> <span class="k">for</span> <span class="n">frame</span> <span class="ow">in</span> <span class="n">frames</span><span class="p">]</span>
    <span class="n">images</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s1">&#39;feature_detection.gif&#39;</span><span class="p">,</span> <span class="n">save_all</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">append_images</span><span class="o">=</span><span class="n">images</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">duration</span><span class="o">=</span><span class="mi">325</span><span class="p">,</span> <span class="n">loop</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">dpi</span> <span class="o">=</span> <span class="mi">300</span><span class="p">)</span>  <span class="c1"># duration in milliseconds</span>

    <span class="c1"># Clean up the saved frames</span>
    <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">frames</span><span class="p">:</span>
        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Animated GIF created as &#39;feature_detection.gif&#39;&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No frames were generated.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pyart</span>
<span class="kn">import</span> <span class="nn">fsspec</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">io</span> <span class="kn">import</span> <span class="n">BytesIO</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">import</span> <span class="nn">cartopy.crs</span> <span class="k">as</span> <span class="nn">ccrs</span>
<span class="kn">from</span> <span class="nn">metpy.plots</span> <span class="kn">import</span> <span class="n">USCOUNTIES</span>
<span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.colors</span> <span class="k">as</span> <span class="nn">mcolors</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span>

<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>

<span class="c1"># Setup the S3 filesystem</span>
<span class="n">fs</span> <span class="o">=</span> <span class="n">fsspec</span><span class="o">.</span><span class="n">filesystem</span><span class="p">(</span><span class="s2">&quot;s3&quot;</span><span class="p">,</span> <span class="n">anon</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Define the start and end dates and hours</span>
<span class="n">start_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">(</span><span class="mi">2024</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>  <span class="c1"># example start date</span>
<span class="n">end_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">(</span><span class="mi">2024</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>    <span class="c1"># example end date</span>
<span class="n">station</span> <span class="o">=</span> <span class="s1">&#39;KLOT&#39;</span>

<span class="c1"># Generate the list of files for the specified date and hour range</span>
<span class="n">files</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">current_time</span> <span class="o">=</span> <span class="n">start_date</span>
<span class="k">while</span> <span class="n">current_time</span> <span class="o">&lt;=</span> <span class="n">end_date</span><span class="p">:</span>
    <span class="n">date_str</span> <span class="o">=</span> <span class="n">current_time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y/%m/</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">datetime_str</span> <span class="o">=</span> <span class="n">current_time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y%m</span><span class="si">%d</span><span class="s2">_%H&quot;</span><span class="p">)</span>
    <span class="n">hour_str</span> <span class="o">=</span> <span class="n">current_time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%H&quot;</span><span class="p">)</span>
    <span class="n">files</span> <span class="o">+=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">fs</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;s3://noaa-nexrad-level2/</span><span class="si">{</span><span class="n">date_str</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">station</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">station</span><span class="si">}{</span><span class="n">datetime_str</span><span class="si">}</span><span class="s2">*&quot;</span><span class="p">))</span>
    <span class="n">current_time</span> <span class="o">+=</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># Print the selected files</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Selected files:&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>

<span class="n">latitude</span> <span class="o">=</span> <span class="p">[</span><span class="mf">41.700937896518866</span><span class="p">,</span> <span class="mf">41.704120</span><span class="p">]</span>
<span class="n">longitude</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mf">87.99578103231573</span><span class="p">,</span> <span class="o">-</span><span class="mf">87.968328</span><span class="p">]</span>
<span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Tower&#39;</span><span class="p">,</span> <span class="s1">&#39;SCM&#39;</span><span class="p">]</span>
<span class="n">markers</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;v&#39;</span><span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="p">]</span>
<span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;cyan&#39;</span><span class="p">,</span> <span class="s1">&#39;magenta&#39;</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">read_radar_data</span><span class="p">(</span><span class="n">file_path</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">fs</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">radar_data</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="n">radar_file</span> <span class="o">=</span> <span class="n">BytesIO</span><span class="p">(</span><span class="n">radar_data</span><span class="p">)</span>
        <span class="n">radar</span> <span class="o">=</span> <span class="n">pyart</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">read_nexrad_archive</span><span class="p">(</span><span class="n">radar_file</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Successfully read radar data from </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">radar</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to read radar data from </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>

<span class="n">frames</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">file</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">files</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Processing file </span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">files</span><span class="p">)</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="c1"># Read radar data</span>
    <span class="n">radar</span> <span class="o">=</span> <span class="n">read_radar_data</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">radar</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Skipping file </span><span class="si">{</span><span class="n">file</span><span class="si">}</span><span class="s2"> due to read error.&quot;</span><span class="p">)</span>
        <span class="k">continue</span>

    <span class="c1"># List available fields</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Available fields in radar data: </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="n">radar</span><span class="o">.</span><span class="n">fields</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Use a suitable field name based on available fields</span>
    <span class="n">field_name</span> <span class="o">=</span> <span class="s2">&quot;reflectivity&quot;</span>  <span class="c1"># Use &#39;reflectivity&#39; as the common field name</span>

    <span class="c1"># Extract the lowest sweep</span>
    <span class="n">radar</span> <span class="o">=</span> <span class="n">radar</span><span class="o">.</span><span class="n">extract_sweeps</span><span class="p">([</span><span class="mi">0</span><span class="p">])</span>

    <span class="c1"># Interpolate to grid</span>
    <span class="n">grid</span> <span class="o">=</span> <span class="n">pyart</span><span class="o">.</span><span class="n">map</span><span class="o">.</span><span class="n">grid_from_radars</span><span class="p">(</span>
        <span class="p">(</span><span class="n">radar</span><span class="p">,),</span>
        <span class="n">grid_shape</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">201</span><span class="p">,</span> <span class="mi">201</span><span class="p">),</span>
        <span class="n">grid_limits</span><span class="o">=</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10000</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mf">50000.0</span><span class="p">,</span> <span class="mf">50000.0</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mf">50000.0</span><span class="p">,</span> <span class="mf">50000.0</span><span class="p">)),</span>
        <span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="n">field_name</span><span class="p">],</span>
    <span class="p">)</span>

    <span class="c1"># Get dx dy</span>
    <span class="n">dx</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">grid</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">dy</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">grid</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

    <span class="c1"># Feature detection</span>
    <span class="n">feature_dict</span> <span class="o">=</span> <span class="n">pyart</span><span class="o">.</span><span class="n">retrieve</span><span class="o">.</span><span class="n">feature_detection</span><span class="p">(</span>
        <span class="n">grid</span><span class="p">,</span>
        <span class="n">dx</span><span class="p">,</span>
        <span class="n">dy</span><span class="p">,</span>
        <span class="n">field</span><span class="o">=</span><span class="n">field_name</span><span class="p">,</span>
        <span class="n">always_core_thres</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span>
        <span class="n">bkg_rad_km</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
        <span class="n">use_cosine</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">max_diff</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
        <span class="n">zero_diff_cos_val</span><span class="o">=</span><span class="mi">55</span><span class="p">,</span>
        <span class="n">weak_echo_thres</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
        <span class="n">max_rad_km</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># Add to grid object</span>
    <span class="c1"># Mask zero values (no surface echo)</span>
    <span class="n">feature_masked</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_equal</span><span class="p">(</span><span class="n">feature_dict</span><span class="p">[</span><span class="s2">&quot;feature_detection&quot;</span><span class="p">][</span><span class="s2">&quot;data&quot;</span><span class="p">],</span> <span class="mi">0</span><span class="p">)</span>
    <span class="c1"># Mask 3 values (weak echo)</span>
    <span class="n">feature_masked</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_equal</span><span class="p">(</span><span class="n">feature_masked</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
    <span class="c1"># Add dimension to array to add to grid object</span>
    <span class="n">feature_dict</span><span class="p">[</span><span class="s2">&quot;feature_detection&quot;</span><span class="p">][</span><span class="s2">&quot;data&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">feature_masked</span>
    <span class="c1"># Add field</span>
    <span class="n">grid</span><span class="o">.</span><span class="n">add_field</span><span class="p">(</span>
        <span class="s2">&quot;feature_detection&quot;</span><span class="p">,</span> <span class="n">feature_dict</span><span class="p">[</span><span class="s2">&quot;feature_detection&quot;</span><span class="p">],</span> <span class="n">replace_existing</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">)</span>

    <span class="c1"># Create plot using GridMapDisplay</span>
    <span class="c1"># Plot variables</span>
    <span class="n">display</span> <span class="o">=</span> <span class="n">pyart</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">GridMapDisplay</span><span class="p">(</span><span class="n">grid</span><span class="p">)</span>
    <span class="n">magma_r_cmap</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s2">&quot;pyart_ChaseSpectral&quot;</span><span class="p">)</span>
    <span class="n">ref_cmap</span> <span class="o">=</span> <span class="n">mcolors</span><span class="o">.</span><span class="n">LinearSegmentedColormap</span><span class="o">.</span><span class="n">from_list</span><span class="p">(</span>
        <span class="s2">&quot;ref_cmap&quot;</span><span class="p">,</span> <span class="n">magma_r_cmap</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">,</span> <span class="n">magma_r_cmap</span><span class="o">.</span><span class="n">N</span><span class="p">))</span>
    <span class="p">)</span>
    <span class="n">projection</span> <span class="o">=</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">AlbersEqualArea</span><span class="p">(</span>
        <span class="n">central_latitude</span><span class="o">=</span><span class="n">radar</span><span class="o">.</span><span class="n">latitude</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
        <span class="n">central_longitude</span><span class="o">=</span><span class="n">radar</span><span class="o">.</span><span class="n">longitude</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
    <span class="p">)</span>

    <span class="c1"># Plot</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">12</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
    <span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="n">projection</span><span class="p">)</span>
    <span class="n">display</span><span class="o">.</span><span class="n">plot_grid</span><span class="p">(</span>
        <span class="n">field_name</span><span class="p">,</span>
        <span class="n">vmin</span><span class="o">=</span><span class="mi">9</span><span class="p">,</span>
        <span class="n">vmax</span><span class="o">=</span><span class="mi">65</span><span class="p">,</span>
        <span class="n">cmap</span><span class="o">=</span><span class="n">ref_cmap</span><span class="p">,</span>
        <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span>
        <span class="n">ax</span><span class="o">=</span><span class="n">ax1</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">ax2</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="n">projection</span><span class="p">)</span>
    <span class="n">display</span><span class="o">.</span><span class="n">plot_grid</span><span class="p">(</span>
        <span class="s2">&quot;feature_detection&quot;</span><span class="p">,</span>
        <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">vmax</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
        <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s2">&quot;viridis&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
        <span class="n">ax</span><span class="o">=</span><span class="n">ax2</span><span class="p">,</span>
        <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span>
        <span class="n">ticks</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span> <span class="o">/</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span> <span class="o">/</span> <span class="mi">3</span><span class="p">],</span>
        <span class="n">ticklabs</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;Stratiform&quot;</span><span class="p">,</span> <span class="s2">&quot;Convective&quot;</span><span class="p">],</span>
    <span class="p">)</span>

    <span class="c1"># Set the extent to zoom out slightly</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_extent</span><span class="p">([</span><span class="o">-</span><span class="mf">88.3</span><span class="p">,</span> <span class="o">-</span><span class="mf">87.7</span><span class="p">,</span> <span class="mf">41.5</span><span class="p">,</span> <span class="mf">42.0</span><span class="p">],</span> <span class="n">crs</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">())</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_extent</span><span class="p">([</span><span class="o">-</span><span class="mf">88.3</span><span class="p">,</span> <span class="o">-</span><span class="mf">87.7</span><span class="p">,</span> <span class="mf">41.5</span><span class="p">,</span> <span class="mf">42.0</span><span class="p">],</span> <span class="n">crs</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">())</span>

    <span class="c1"># Add counties</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">USCOUNTIES</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">USCOUNTIES</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">lat</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">marker</span><span class="p">,</span> <span class="n">color</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">latitude</span><span class="p">,</span> <span class="n">longitude</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">markers</span><span class="p">,</span> <span class="n">colors</span><span class="p">):</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">marker</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">marker</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>

    <span class="c1"># Save the plot to a file</span>
    <span class="n">filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;detection_frame_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">.png&#39;</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper right&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="s1">&#39;large&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Locations&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>

    <span class="c1"># Add the file to the frames list</span>
    <span class="n">frames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Saved frame </span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">files</span><span class="p">)</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Create an animated GIF using Pillow</span>
<span class="k">if</span> <span class="n">frames</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Creating animated GIF...&quot;</span><span class="p">)</span>
    <span class="n">images</span> <span class="o">=</span> <span class="p">[</span><span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span> <span class="k">for</span> <span class="n">frame</span> <span class="ow">in</span> <span class="n">frames</span><span class="p">]</span>
    <span class="n">images</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s1">&#39;feature_detection.gif&#39;</span><span class="p">,</span> <span class="n">save_all</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">append_images</span><span class="o">=</span><span class="n">images</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">duration</span><span class="o">=</span><span class="mi">325</span><span class="p">,</span> <span class="n">loop</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">dpi</span> <span class="o">=</span> <span class="mi">300</span><span class="p">)</span>  <span class="c1"># duration in milliseconds</span>

    <span class="c1"># Clean up the saved frames</span>
    <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">frames</span><span class="p">:</span>
        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Animated GIF created as &#39;feature_detection.gif&#39;&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No frames were generated.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="vertical-radar-column-gif-making-and-complex-plotting">
<h1>Vertical Radar Column GIF making and complex plotting<a class="headerlink" href="#vertical-radar-column-gif-making-and-complex-plotting" title="Link to this heading"><i class="fas fa-link"></i></a></h1>
<section id="this-portion-will-demonstrate-how-to-make-a-complex-plot-including-vertical-reflectivity-columns-derived-rainfall-rate-and-reflectivity-for-analytical-purposes">
<h2>This portion will demonstrate how to make a complex plot including vertical reflectivity columns, derived rainfall rate, and reflectivity for analytical purposes<a class="headerlink" href="#this-portion-will-demonstrate-how-to-make-a-complex-plot-including-vertical-reflectivity-columns-derived-rainfall-rate-and-reflectivity-for-analytical-purposes" title="Link to this heading"><i class="fas fa-link"></i></a></h2>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="id2">
<h1>Imports<a class="headerlink" href="#id2" title="Link to this heading"><i class="fas fa-link"></i></a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pyart</span>
<span class="kn">import</span> <span class="nn">fsspec</span>
<span class="kn">import</span> <span class="nn">xarray</span> <span class="k">as</span> <span class="nn">xr</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">from</span> <span class="nn">io</span> <span class="kn">import</span> <span class="n">BytesIO</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">matplotlib.dates</span> <span class="k">as</span> <span class="nn">mdates</span>
<span class="kn">import</span> <span class="nn">cartopy.crs</span> <span class="k">as</span> <span class="nn">ccrs</span>
<span class="kn">from</span> <span class="nn">metpy.plots</span> <span class="kn">import</span> <span class="n">USCOUNTIES</span>
<span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="ne">DeprecationWarning</span><span class="p">)</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="ne">FutureWarning</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<section id="the-initial-setup-for-this-product-will-be-similar-to-the-previous-products-although-there-will-be-some-notable-differences">
<h2>The initial setup for this product will be similar to the previous products, although there will be some notable differences<a class="headerlink" href="#the-initial-setup-for-this-product-will-be-similar-to-the-previous-products-although-there-will-be-some-notable-differences" title="Link to this heading"><i class="fas fa-link"></i></a></h2>
<p>Instead of directly pulling all of the data from the AWS and using it directly, we will be saving the data to temporary netCDF files for ease of access. This process will be explained throughout the demonstration</p>
<p>To initialize this process, we will use the same code as before to pull the radar files and read them. Although this time we are filtering out the mdm files due to errors in plotting.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fs</span> <span class="o">=</span> <span class="n">fsspec</span><span class="o">.</span><span class="n">filesystem</span><span class="p">(</span><span class="s2">&quot;s3&quot;</span><span class="p">,</span> <span class="n">anon</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Define the start and end dates and hours</span>
<span class="n">start_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">(</span><span class="mi">2024</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>  <span class="c1"># YYYY/MM/DD HH</span>
<span class="n">end_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">(</span><span class="mi">2024</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>   <span class="c1"># YYYY/MM/DD HH</span>
<span class="n">station</span> <span class="o">=</span> <span class="s1">&#39;KLOT&#39;</span>
<span class="n">latitude</span> <span class="o">=</span> <span class="p">[</span><span class="mf">41.700937896518866</span><span class="p">,</span> <span class="mf">41.704120</span><span class="p">]</span>
<span class="n">longitude</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mf">87.99578103231573</span><span class="p">,</span> <span class="o">-</span><span class="mf">87.968328</span><span class="p">]</span>
<span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Tower&#39;</span><span class="p">,</span> <span class="s1">&#39;SMC&#39;</span><span class="p">]</span>
<span class="n">markers</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;^&#39;</span><span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="p">]</span>
<span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;magenta&#39;</span><span class="p">,</span> <span class="s1">&#39;cyan&#39;</span><span class="p">]</span>

<span class="c1"># Generate the list of files for the specified date and hour range</span>
<span class="n">files</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">current_date</span> <span class="o">=</span> <span class="n">start_date</span>
<span class="k">while</span> <span class="n">current_date</span> <span class="o">&lt;=</span> <span class="n">end_date</span><span class="p">:</span>
    <span class="n">date_str</span> <span class="o">=</span> <span class="n">current_date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y/%m/</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">date_str_compact</span> <span class="o">=</span> <span class="n">current_date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y%m</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">hour</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">start_date</span><span class="o">.</span><span class="n">hour</span><span class="p">,</span> <span class="n">end_date</span><span class="o">.</span><span class="n">hour</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">hour_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">hour</span><span class="si">:</span><span class="s2">02d</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">all_files</span> <span class="o">=</span> <span class="n">fs</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;s3://noaa-nexrad-level2/</span><span class="si">{</span><span class="n">date_str</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">station</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">station</span><span class="si">}{</span><span class="n">date_str_compact</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">hour_str</span><span class="si">}</span><span class="s2">*&quot;</span><span class="p">)</span>
        <span class="n">filtered_files</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">all_files</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">f</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;_MDM&#39;</span><span class="p">)]</span>
        <span class="n">files</span> <span class="o">+=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">filtered_files</span><span class="p">)</span>
    <span class="n">current_date</span> <span class="o">+=</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># Print the selected files</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Selected files:&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>

<span class="c1"># Function to check and print the fields in the first radar file</span>
<span class="k">def</span> <span class="nf">check_radar_fields</span><span class="p">(</span><span class="n">file_path</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">fs</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">radar_data</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="n">radar_file</span> <span class="o">=</span> <span class="n">BytesIO</span><span class="p">(</span><span class="n">radar_data</span><span class="p">)</span>
        <span class="n">radar</span> <span class="o">=</span> <span class="n">pyart</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">read_nexrad_archive</span><span class="p">(</span><span class="n">radar_file</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Fields in radar data from </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">:&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">radar</span><span class="o">.</span><span class="n">fields</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to read radar data from </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Check the fields for the first file</span>
<span class="k">if</span> <span class="n">files</span><span class="p">:</span>
    <span class="n">check_radar_fields</span><span class="p">(</span><span class="n">files</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

<span class="c1"># Function to read radar data</span>
<span class="k">def</span> <span class="nf">read_radar_data</span><span class="p">(</span><span class="n">file_path</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">fs</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">radar_data</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="n">radar_file</span> <span class="o">=</span> <span class="n">BytesIO</span><span class="p">(</span><span class="n">radar_data</span><span class="p">)</span>
        <span class="n">radar</span> <span class="o">=</span> <span class="n">pyart</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">read_nexrad_archive</span><span class="p">(</span><span class="n">radar_file</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Successfully read radar data from </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">radar</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to read radar data from </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>

<span class="c1"># Collect data for the NetCDF files</span>
<span class="n">time_height_data_tower</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">time_height_data_smc</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">times</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">heights</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># Initialize heights to None</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="netcdf-file-creation">
<h2>netCDF file creation<a class="headerlink" href="#netcdf-file-creation" title="Link to this heading"><i class="fas fa-link"></i></a></h2>
<section id="to-create-the-netcdf-file-we-will-extract-the-radar-data-from-the-files-and-save-the-reflectivity-data-for-each-points-preserving-the-spatial-and-temporal-data-by-indexing-the-variable-by-time-and-height-this-is-essential-for-plotting-our-vertical-column-data">
<h3>To create the netCDF file, we will extract the radar data from the files and save the reflectivity data for each points, preserving the spatial and temporal data by indexing the variable by time and height. This is essential for plotting our vertical column data<a class="headerlink" href="#to-create-the-netcdf-file-we-will-extract-the-radar-data-from-the-files-and-save-the-reflectivity-data-for-each-points-preserving-the-spatial-and-temporal-data-by-indexing-the-variable-by-time-and-height-this-is-essential-for-plotting-our-vertical-column-data" title="Link to this heading"><i class="fas fa-link"></i></a></h3>
<p>NAN values are also filtered out of the radar to prevent gaps in the data.</p>
<p>Two seperate netCDF files will be created, one for each point. If you would like to create more or less depending on your personal needs, this code can be modified accordingly.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
    <span class="n">radar</span> <span class="o">=</span> <span class="n">read_radar_data</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">radar</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">continue</span>

    <span class="c1"># Append the corresponding time once per file</span>
    <span class="n">radar_time</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">radar</span><span class="o">.</span><span class="n">time</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;since &#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">+</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_timedelta</span><span class="p">(</span><span class="n">radar</span><span class="o">.</span><span class="n">time</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;s&#39;</span><span class="p">)</span>
    <span class="n">times</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">datetime64</span><span class="p">(</span><span class="n">radar_time</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]:</span>
        <span class="c1"># Extract vertical profile</span>
        <span class="n">profile</span> <span class="o">=</span> <span class="n">pyart</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">column_vertical_profile</span><span class="p">(</span><span class="n">radar</span><span class="p">,</span> <span class="n">latitude</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="n">longitude</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="n">azimuth_spread</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">spatial_spread</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">reflectivity</span> <span class="o">=</span> <span class="n">profile</span><span class="p">[</span><span class="s1">&#39;reflectivity&#39;</span><span class="p">]</span>

        <span class="c1"># Get the heights of the sweeps if not already obtained</span>
        <span class="k">if</span> <span class="n">heights</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">heights</span> <span class="o">=</span> <span class="n">radar</span><span class="o">.</span><span class="n">gate_altitude</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span>

        <span class="c1"># Append the profile to the respective array</span>
        <span class="k">if</span> <span class="n">idx</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">time_height_data_tower</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">reflectivity</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">time_height_data_smc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">reflectivity</span><span class="p">)</span>

<span class="c1"># Determine the maximum profile length</span>
<span class="n">max_length_tower</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">profile</span><span class="p">)</span> <span class="k">for</span> <span class="n">profile</span> <span class="ow">in</span> <span class="n">time_height_data_tower</span><span class="p">)</span>
<span class="n">max_length_smc</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">profile</span><span class="p">)</span> <span class="k">for</span> <span class="n">profile</span> <span class="ow">in</span> <span class="n">time_height_data_smc</span><span class="p">)</span>

<span class="c1"># Pad profiles with NaNs to match the maximum length</span>
<span class="n">padded_time_height_data_tower</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">time_height_data_tower</span><span class="p">),</span> <span class="n">max_length_tower</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
<span class="n">padded_time_height_data_smc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">time_height_data_smc</span><span class="p">),</span> <span class="n">max_length_smc</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">profile</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">time_height_data_tower</span><span class="p">):</span>
    <span class="n">padded_time_height_data_tower</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">profile</span><span class="p">)]</span> <span class="o">=</span> <span class="n">profile</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">profile</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">time_height_data_smc</span><span class="p">):</span>
    <span class="n">padded_time_height_data_smc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">profile</span><span class="p">)]</span> <span class="o">=</span> <span class="n">profile</span>

<span class="c1"># Convert collected data to 2D arrays</span>
<span class="n">time_height_data_tower</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">padded_time_height_data_tower</span><span class="p">)</span>
<span class="n">time_height_data_smc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">padded_time_height_data_smc</span><span class="p">)</span>

<span class="c1"># Ensure heights array matches the padded data&#39;s second dimension</span>
<span class="n">heights_tower</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">heights</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">heights</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">max_length_tower</span><span class="p">)</span>
<span class="n">heights_smc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">heights</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">heights</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">max_length_smc</span><span class="p">)</span>

<span class="c1"># Create the xarray Datasets</span>
<span class="n">ds_tower</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">(</span>
    <span class="p">{</span>
        <span class="s2">&quot;reflectivity&quot;</span><span class="p">:</span> <span class="p">([</span><span class="s2">&quot;time&quot;</span><span class="p">,</span> <span class="s2">&quot;height&quot;</span><span class="p">],</span> <span class="n">time_height_data_tower</span><span class="p">)</span>
    <span class="p">},</span>
    <span class="n">coords</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;time&quot;</span><span class="p">:</span> <span class="n">times</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="n">time_height_data_tower</span><span class="p">)],</span>  <span class="c1"># Ensure time dimension matches the data</span>
        <span class="s2">&quot;height&quot;</span><span class="p">:</span> <span class="n">heights_tower</span>
    <span class="p">}</span>
<span class="p">)</span>

<span class="n">ds_smc</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">(</span>
    <span class="p">{</span>
        <span class="s2">&quot;reflectivity&quot;</span><span class="p">:</span> <span class="p">([</span><span class="s2">&quot;time&quot;</span><span class="p">,</span> <span class="s2">&quot;height&quot;</span><span class="p">],</span> <span class="n">time_height_data_smc</span><span class="p">)</span>
    <span class="p">},</span>
    <span class="n">coords</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;time&quot;</span><span class="p">:</span> <span class="n">times</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="n">time_height_data_smc</span><span class="p">)],</span>  <span class="c1"># Ensure time dimension matches the data</span>
        <span class="s2">&quot;height&quot;</span><span class="p">:</span> <span class="n">heights_smc</span>
    <span class="p">}</span>
<span class="p">)</span>

<span class="c1"># Save the datasets to NetCDF files</span>
<span class="n">output_file_tower</span> <span class="o">=</span> <span class="s2">&quot;combined_radar_Tower.nc&quot;</span>
<span class="n">output_file_smc</span> <span class="o">=</span> <span class="s2">&quot;combined_radar_SMC.nc&quot;</span>
<span class="n">ds_tower</span><span class="o">.</span><span class="n">to_netcdf</span><span class="p">(</span><span class="n">output_file_tower</span><span class="p">)</span>
<span class="n">ds_smc</span><span class="o">.</span><span class="n">to_netcdf</span><span class="p">(</span><span class="n">output_file_smc</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Saved combined dataset to </span><span class="si">{</span><span class="n">output_file_tower</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Saved combined dataset to </span><span class="si">{</span><span class="n">output_file_smc</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="initializing-the-netcdf-files-for-use">
<h2>Initializing the netcDF files for use<a class="headerlink" href="#initializing-the-netcdf-files-for-use" title="Link to this heading"><i class="fas fa-link"></i></a></h2>
<p>Now that we have our netCDF files created and saved, we can use them for data extraction and plotting purposes.</p>
<p>The data is extracted and converted to numpy arrays for use in plotting.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Load the NetCDF files</span>
<span class="n">ds_tower</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">output_file_tower</span><span class="p">)</span>
<span class="n">ds_smc</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">output_file_smc</span><span class="p">)</span>

<span class="c1"># Extract data from the datasets</span>
<span class="n">times</span> <span class="o">=</span> <span class="n">ds_tower</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
<span class="n">heights_tower</span> <span class="o">=</span> <span class="n">ds_tower</span><span class="p">[</span><span class="s1">&#39;height&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
<span class="n">reflectivity_tower</span> <span class="o">=</span> <span class="n">ds_tower</span><span class="p">[</span><span class="s1">&#39;reflectivity&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>

<span class="n">heights_smc</span> <span class="o">=</span> <span class="n">ds_smc</span><span class="p">[</span><span class="s1">&#39;height&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
<span class="n">reflectivity_smc</span> <span class="o">=</span> <span class="n">ds_smc</span><span class="p">[</span><span class="s1">&#39;reflectivity&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>

<span class="c1"># Convert to numpy arrays</span>
<span class="n">padded_time_height_data_tower</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">reflectivity_tower</span><span class="p">)</span>
<span class="n">padded_time_height_data_smc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">reflectivity_smc</span><span class="p">)</span>

<span class="n">reflectivity_tower</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span><span class="n">padded_time_height_data_tower</span><span class="p">)</span>
<span class="n">reflectivity_smc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span><span class="n">padded_time_height_data_smc</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="calculation-of-z-r-relationship-for-derived-rainfall-rate-caluclations">
<h2>Calculation of Z-R relationship for derived rainfall rate caluclations<a class="headerlink" href="#calculation-of-z-r-relationship-for-derived-rainfall-rate-caluclations" title="Link to this heading"><i class="fas fa-link"></i></a></h2>
<p>The NAN values have to be filtered for this step, otherwise you will see gaps in your rainfall rate line.</p>
<p>For this example, since we are dealing with summertime convection, we will use the Z-R relationship for deep convection rather than the Marshall-Palmer stratiform formula. Although, feel free to change this if you’re analyzing a stratiform event.</p>
<p>The code succeeding the ZR calculation initializes the meshes and arrays for gradual data addition.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Z_tower</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">**</span> <span class="p">(</span><span class="n">reflectivity_tower</span> <span class="o">/</span> <span class="mi">10</span><span class="p">)</span>  <span class="c1"># Convert dBZ to Z</span>
<span class="n">R_tower</span> <span class="o">=</span> <span class="p">(</span><span class="n">Z_tower</span> <span class="o">/</span> <span class="mi">300</span><span class="p">)</span> <span class="o">**</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="mf">1.4</span><span class="p">)</span>  <span class="c1"># Calculate rainfall rate</span>

<span class="n">Z_smc</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">**</span> <span class="p">(</span><span class="n">reflectivity_smc</span> <span class="o">/</span> <span class="mi">10</span><span class="p">)</span>  <span class="c1"># Convert dBZ to Z</span>
<span class="n">R_smc</span> <span class="o">=</span> <span class="p">(</span><span class="n">Z_smc</span> <span class="o">/</span> <span class="mi">300</span><span class="p">)</span> <span class="o">**</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="mf">1.4</span><span class="p">)</span>  <span class="c1"># Calculate rainfall rate</span>

<span class="n">time_mesh_smc</span><span class="p">,</span> <span class="n">height_mesh_smc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">mdates</span><span class="o">.</span><span class="n">date2num</span><span class="p">(</span><span class="n">times</span><span class="p">),</span> <span class="n">heights_smc</span><span class="p">)</span>
<span class="n">time_mesh_tower</span><span class="p">,</span> <span class="n">height_mesh_tower</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">mdates</span><span class="o">.</span><span class="n">date2num</span><span class="p">(</span><span class="n">times</span><span class="p">),</span> <span class="n">heights_tower</span><span class="p">)</span>
<span class="c1"># Creation of a list to append the frames to as they are created. </span>
<span class="n">frames</span> <span class="o">=</span> <span class="p">[]</span>

<span class="c1"># Initialize empty arrays for the gradual addition of data</span>
<span class="n">incremental_data_smc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span><span class="n">padded_time_height_data_smc</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
<span class="n">incremental_data_tower</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span><span class="n">padded_time_height_data_tower</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="plotting">
<h2>Plotting<a class="headerlink" href="#plotting" title="Link to this heading"><i class="fas fa-link"></i></a></h2>
<p>Now we will plot the data onto the figure. This will be a 5 panel plot with one main radar plot, and 4 derived plots.</p>
<p>Each variable is properly annotated within the code for ease of modification.</p>
<section id="the-time-height-plots-visualize-the-reflectivity-column-over-each-location-specified-earlier-in-the-code-it-will-create-a-figure-that-shows-the-change-in-vertical-reflectivity-columns-with-respect-to-time-to-visualize-the-position-of-the-convective-precipitaton-core-should-one-exist-over-the-area">
<h3>The time height plots visualize the reflectivity column over each location specified earlier in the code. It will create a figure that shows the change in vertical reflectivity columns with respect to time to visualize the position of the convective precipitaton core (should one exist) over the area.<a class="headerlink" href="#the-time-height-plots-visualize-the-reflectivity-column-over-each-location-specified-earlier-in-the-code-it-will-create-a-figure-that-shows-the-change-in-vertical-reflectivity-columns-with-respect-to-time-to-visualize-the-position-of-the-convective-precipitaton-core-should-one-exist-over-the-area" title="Link to this heading"><i class="fas fa-link"></i></a></h3>
</section>
<section id="the-rainfall-rate-plots-will-visualize-the-change-in-rainfall-rate-as-calculated-by-the-z-r-relationship">
<h3>The rainfall rate plots will visualize the change in rainfall rate as calculated by the Z-R relationship.<a class="headerlink" href="#the-rainfall-rate-plots-will-visualize-the-change-in-rainfall-rate-as-calculated-by-the-z-r-relationship" title="Link to this heading"><i class="fas fa-link"></i></a></h3>
<p>Each frame created for the gif will be saved and appended to the frames list created earlier.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">files</span><span class="p">)):</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>

    <span class="c1"># Plot map with radar data</span>
    <span class="n">radar</span> <span class="o">=</span> <span class="n">read_radar_data</span><span class="p">(</span><span class="n">files</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">radar</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">continue</span>
    <span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">],</span> <span class="n">projection</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">())</span>
    <span class="n">display</span> <span class="o">=</span> <span class="n">pyart</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">RadarMapDisplay</span><span class="p">(</span><span class="n">radar</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">display</span><span class="o">.</span><span class="n">plot_ppi_map</span><span class="p">(</span><span class="s1">&#39;reflectivity&#39;</span><span class="p">,</span>
                             <span class="n">sweep</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                             <span class="n">vmin</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                             <span class="n">vmax</span><span class="o">=</span><span class="mi">65</span><span class="p">,</span>
                             <span class="n">ax</span><span class="o">=</span><span class="n">ax1</span><span class="p">,</span>
                             <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Reflectivity for </span><span class="si">{</span><span class="n">station</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">times</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
                             <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;pyart_ChaseSpectral&#39;</span><span class="p">,</span>
                             <span class="n">colorbar_flag</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>  <span class="c1"># Disable the built-in colorbar</span>
        <span class="n">mappable</span> <span class="o">=</span> <span class="n">display</span><span class="o">.</span><span class="n">plots</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error plotting radar data for file </span><span class="si">{</span><span class="n">file</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
        <span class="k">continue</span>

    <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="mf">88.2</span><span class="p">,</span> <span class="o">-</span><span class="mf">87.7</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mf">41.5</span><span class="p">,</span> <span class="mf">41.9</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">USCOUNTIES</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">lat</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">marker</span><span class="p">,</span> <span class="n">color</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">latitude</span><span class="p">,</span> <span class="n">longitude</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">markers</span><span class="p">,</span> <span class="n">colors</span><span class="p">):</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">marker</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper right&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="s1">&#39;large&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Locations&#39;</span><span class="p">)</span>
    <span class="n">cbar</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">mappable</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax1</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;horizontal&#39;</span><span class="p">,</span> <span class="n">fraction</span><span class="o">=</span><span class="mf">0.046</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.04</span><span class="p">)</span>
    <span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s1">&#39;Equivalent Reflectivity Factor (dBZ)&#39;</span><span class="p">)</span>

    <span class="c1"># Create a time-height profile plot for SMC</span>
    <span class="n">ax2</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="mf">0.55</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">])</span>
    <span class="n">c_smc</span> <span class="o">=</span> <span class="n">ax2</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">time_mesh_smc</span><span class="p">,</span> <span class="n">height_mesh_smc</span><span class="p">,</span> <span class="n">incremental_data_smc</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">shading</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;pyart_NWSRef&#39;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">65</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">c_smc</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Reflectivity (dBZ)&#39;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">time_mesh_smc</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">time_mesh_smc</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">height_mesh_smc</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">height_mesh_smc</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time&#39;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Height (ft)&#39;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">xaxis_date</span><span class="p">()</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">mdates</span><span class="o">.</span><span class="n">DateFormatter</span><span class="p">(</span><span class="s1">&#39;%H:%M&#39;</span><span class="p">))</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Reflectivity Profile Above SMC Site&#39;</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">autofmt_xdate</span><span class="p">()</span>

    <span class="c1"># Create a time-height profile plot for Tower</span>
    <span class="n">ax3</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="mf">0.55</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">])</span>
    <span class="n">c_tower</span> <span class="o">=</span> <span class="n">ax3</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">time_mesh_tower</span><span class="p">,</span> <span class="n">height_mesh_tower</span><span class="p">,</span> <span class="n">incremental_data_tower</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">shading</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;pyart_NWSRef&#39;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">65</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">c_tower</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax3</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Reflectivity (dBZ)&#39;</span><span class="p">)</span>
    <span class="n">ax3</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">time_mesh_tower</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">time_mesh_tower</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
    <span class="n">ax3</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">height_mesh_tower</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">height_mesh_tower</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
    <span class="n">ax3</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time&#39;</span><span class="p">)</span>
    <span class="n">ax3</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Height (ft)&#39;</span><span class="p">)</span>
    <span class="n">ax3</span><span class="o">.</span><span class="n">xaxis_date</span><span class="p">()</span>
    <span class="n">ax3</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">mdates</span><span class="o">.</span><span class="n">DateFormatter</span><span class="p">(</span><span class="s1">&#39;%H:%M&#39;</span><span class="p">))</span>
    <span class="n">ax3</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Reflectivity Profile Above Tower Site&#39;</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">autofmt_xdate</span><span class="p">()</span>

    <span class="c1"># Create a rainfall rate plot for SMC</span>
    <span class="n">ax4</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="mf">0.55</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">])</span>
    <span class="n">ax4</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">times</span><span class="p">[:</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span> <span class="n">R_smc</span><span class="p">[:</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>
    <span class="n">ax4</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">times</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">times</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">ax4</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">80</span><span class="p">)</span>
    <span class="n">ax4</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">81</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
    <span class="n">ax4</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">([</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">81</span><span class="p">,</span> <span class="mi">10</span><span class="p">)])</span>
    <span class="n">ax4</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time&#39;</span><span class="p">)</span>
    <span class="n">ax4</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Rainfall Rate (mm/hr)&#39;</span><span class="p">)</span>
    <span class="n">ax4</span><span class="o">.</span><span class="n">xaxis_date</span><span class="p">()</span>
    <span class="n">ax4</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">mdates</span><span class="o">.</span><span class="n">DateFormatter</span><span class="p">(</span><span class="s1">&#39;%H:%M&#39;</span><span class="p">))</span>
    <span class="n">ax4</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Rainfall Rate at Ground Level (SMC)&#39;</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">autofmt_xdate</span><span class="p">()</span>

    <span class="c1"># Create a rainfall rate plot for Tower</span>
    <span class="n">ax5</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="mf">0.55</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">])</span>
    <span class="n">ax5</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">times</span><span class="p">[:</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span> <span class="n">R_tower</span><span class="p">[:</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>
    <span class="n">ax5</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">times</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">times</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">ax5</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">80</span><span class="p">)</span>
    <span class="n">ax5</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">81</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
    <span class="n">ax5</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">([</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">81</span><span class="p">,</span> <span class="mi">10</span><span class="p">)])</span>
    <span class="n">ax5</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time&#39;</span><span class="p">)</span>
    <span class="n">ax5</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Rainfall Rate (mm/hr)&#39;</span><span class="p">)</span>
    <span class="n">ax5</span><span class="o">.</span><span class="n">xaxis_date</span><span class="p">()</span>
    <span class="n">ax5</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">mdates</span><span class="o">.</span><span class="n">DateFormatter</span><span class="p">(</span><span class="s1">&#39;%H:%M&#39;</span><span class="p">))</span>
    <span class="n">ax5</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Rainfall Rate at Ground Level (Tower)&#39;</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">autofmt_xdate</span><span class="p">()</span>

    <span class="c1"># Update data</span>
    <span class="n">incremental_data_smc</span><span class="p">[:</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">padded_time_height_data_smc</span><span class="p">[:</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span>
    <span class="n">incremental_data_tower</span><span class="p">[:</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">padded_time_height_data_tower</span><span class="p">[:</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span>

    <span class="n">c_smc</span><span class="o">.</span><span class="n">set_array</span><span class="p">(</span><span class="n">incremental_data_smc</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">flatten</span><span class="p">())</span>
    <span class="n">c_tower</span><span class="o">.</span><span class="n">set_array</span><span class="p">(</span><span class="n">incremental_data_tower</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">flatten</span><span class="p">())</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">frame_filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;combined_frame_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">.png&#39;</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">frame_filename</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
    <span class="n">frames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">frame_filename</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Saved frame </span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">files</span><span class="p">)</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">frame_filename</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="gif-creation-and-cleanup">
<h2>GIF creation and cleanup<a class="headerlink" href="#gif-creation-and-cleanup" title="Link to this heading"><i class="fas fa-link"></i></a></h2>
<p>Each frame will be temporarily saved to the current working directory (unless otherwise changed) and will remain until all frames have been created, and the GIF is generated, after which the frames will be deleted, the NETCDF files will be closed and deleted as well.</p>
<section id="if-you-want-to-keep-the-netcdf-files-for-whatever-purpose-feel-free-to-remove-or-comment-the-code-to-remove-them-out">
<h3>IF you want to keep the netCDF files for whatever purpose, feel free to remove or comment the code to remove them out.<a class="headerlink" href="#if-you-want-to-keep-the-netcdf-files-for-whatever-purpose-feel-free-to-remove-or-comment-the-code-to-remove-them-out" title="Link to this heading"><i class="fas fa-link"></i></a></h3>
</section>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="summary">
<h1>Summary<a class="headerlink" href="#summary" title="Link to this heading"><i class="fas fa-link"></i></a></h1>
<p>Within this example, we walked through how MetPy and PyART can be used to loop through NEXRAD level 2 data from a recent convective rainfall event and create an animated gif over a location.</p>
<section id="what-comes-next">
<h2>What comes next?<a class="headerlink" href="#what-comes-next" title="Link to this heading"><i class="fas fa-link"></i></a></h2>
<p>Following this will be some examples that allow us to create gifs with radar data visualized in less conventional forms, such as vertical columns. May be included on this page or a seperate one.</p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "crocusenv"
        },
        kernelOptions: {
            name: "crocusenv",
            path: "./notebooks/solutions"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'crocusenv'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Overview</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#within-this-notebook-we-will-cover">Within this notebook, we will cover:</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#accessing-nexrad-data-from-aws">1: Accessing NEXRAD data from AWS</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#how-to-read-the-data-into-py-art-and-create-plots">2: How to read the data into Py-ART and create plots</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#how-to-create-animated-gifs-with-acquired-radar-data-from-py-art">3: How to create animated gifs with acquired radar data from Py-ART</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#alternative-applications-of-gif-making-for-more-obscure-or-algorithmic-products-such-as-feature-detection-or-vertical-column-pulling">4: Alternative applications of GIF making for more obscure or algorithmic products such as feature detection, or vertical column pulling</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#prerequisites">Prerequisites</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#imports-for-animated-gif-making-in-pyart">Imports for animated gif making in PyArt</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#set-up-the-aws-s3-filysystem">Set up the AWS S3 filysystem</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#selecting-your-date-station-and-time-period">Selecting your date, station, and time period</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#optional-setting-up-individual-locations-to-be-plotted-on-your-map">OPTIONAL* setting up individual locations to be plotted on your map</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#checking-your-plottable-radar-products">Checking your plottable radar products</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#reading-the-data-into-pyart">Reading the data into PyART</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#looping-through-the-radar-data">Looping through the radar data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#plotting-code-with-added-features-and-plotted-points">Plotting code with added features and plotted points</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#customizing-the-range-of-plotted-data">Customizing the range of plotted data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#counties">Counties</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#location-plotting">Location plotting</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#zooming">Zooming</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#colorbar">Colorbar</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#note">NOTE</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#full-code-block-constructed-properly-within-the-for-loop">Full code block constructed properly within the for loop.</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#gif-creation">GIF creation</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#code-in-whole">Code in whole</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#making-gifs-of-other-analysis-products-such-as-feature-detection">Making GIFs of other analysis products such as feature detection</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#now-that-we-know-how-to-create-animated-gifs-through-use-of-basic-python-syntax-and-the-py-art-package-we-will-learn-how-to-create-gifs-of-more-obscure-products-such-as-feature-detection">Now that we know how to create animated gifs through use of basic python syntax and the Py-ART package, we will learn how to create GIFs of more obscure products such as feature detection.</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#if-you-would-like-to-know-more-about-how-feature-detection-in-py-art-works-and-what-exactly-it-does-in-detail-visit-https-arm-doe-github-io-pyart-examples-retrieve-plot-convective-stratiform-html">If you would like to know more about how feature detection in Py-ART works and what exactly it does in detail, visit https://arm-doe.github.io/pyart/examples/retrieve/plot_convective_stratiform.html</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#imports">Imports</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#we-will-use-most-of-the-same-code-for-setting-up-the-date-selection-file-grabbing-and-station-selection-stuff-so-it-will-just-be-posted-as-one-block-the-function-to-read-the-files-is-also-the-same">We will use most of the same code for setting up the date selection, file grabbing, and station selection stuff, so it will just be posted as one block. The function to read the files is also the same.</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-loop-made-to-parse-through-the-files-is-also-similar-but-we-will-instead-set-up-our-for-loop-to-extract-the-scanning-elevation-in-question-and-interpolate-it-into-a-grid-to-use-for-the-feature-detection-algorithm">The loop made to parse through the files is also similar, but we will instead set up our for loop to extract the scanning elevation in question, and interpolate it into a grid to use for the feature detection algorithm</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">GIF creation</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#vertical-radar-column-gif-making-and-complex-plotting">Vertical Radar Column GIF making and complex plotting</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#this-portion-will-demonstrate-how-to-make-a-complex-plot-including-vertical-reflectivity-columns-derived-rainfall-rate-and-reflectivity-for-analytical-purposes">This portion will demonstrate how to make a complex plot including vertical reflectivity columns, derived rainfall rate, and reflectivity for analytical purposes</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">Imports</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-initial-setup-for-this-product-will-be-similar-to-the-previous-products-although-there-will-be-some-notable-differences">The initial setup for this product will be similar to the previous products, although there will be some notable differences</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#netcdf-file-creation">netCDF file creation</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#to-create-the-netcdf-file-we-will-extract-the-radar-data-from-the-files-and-save-the-reflectivity-data-for-each-points-preserving-the-spatial-and-temporal-data-by-indexing-the-variable-by-time-and-height-this-is-essential-for-plotting-our-vertical-column-data">To create the netCDF file, we will extract the radar data from the files and save the reflectivity data for each points, preserving the spatial and temporal data by indexing the variable by time and height. This is essential for plotting our vertical column data</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#initializing-the-netcdf-files-for-use">Initializing the netcDF files for use</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#calculation-of-z-r-relationship-for-derived-rainfall-rate-caluclations">Calculation of Z-R relationship for derived rainfall rate caluclations</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#plotting">Plotting</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-time-height-plots-visualize-the-reflectivity-column-over-each-location-specified-earlier-in-the-code-it-will-create-a-figure-that-shows-the-change-in-vertical-reflectivity-columns-with-respect-to-time-to-visualize-the-position-of-the-convective-precipitaton-core-should-one-exist-over-the-area">The time height plots visualize the reflectivity column over each location specified earlier in the code. It will create a figure that shows the change in vertical reflectivity columns with respect to time to visualize the position of the convective precipitaton core (should one exist) over the area.</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-rainfall-rate-plots-will-visualize-the-change-in-rainfall-rate-as-calculated-by-the-z-r-relationship">The rainfall rate plots will visualize the change in rainfall rate as calculated by the Z-R relationship.</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#gif-creation-and-cleanup">GIF creation and cleanup</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#if-you-want-to-keep-the-netcdf-files-for-whatever-purpose-feel-free-to-remove-or-comment-the-code-to-remove-them-out">IF you want to keep the netCDF files for whatever purpose, feel free to remove or comment the code to remove them out.</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#summary">Summary</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#what-comes-next">What comes next?</a></li>
</ul>
</li>
</ul>

  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By the <a href="https://www.anl.gov/evs">Argonne National Laboratory </a> Environmental Sciences
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2024.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    <p class="last-updated">
  Last updated on 2 August 2024.
  <br/>
</p>
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>